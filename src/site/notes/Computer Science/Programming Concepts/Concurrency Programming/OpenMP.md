---
{"dateCreated":"2024-02-22 14:51","tags":["concurrency"],"pageDirection":"rtl","dg-publish":true,"permalink":"/computer-science/programming-concepts/concurrency-programming/open-mp/","dgPassFrontmatter":true}
---

# OpenMP
OpenMP API Χ”Χ•Χ ΧΧ•Χ΅Χ£ Χ›ΧΧ™Χ Χ©ΧΧΧ¤Χ©Χ¨Χ™Χ ΧΧ›Χ Χ•Χ ΧΧ§Χ‘Χ™ΧΧ™ Χ‘Χ©Χ¤Χ c Χ• cpp Χ•Χ©Χ¤Χ•Χ Χ Χ•Χ΅Χ¤Χ•Χ.
[[pthreads\|pthreads]] Χ”Χ•Χ ΧΆΧ“Χ™Χ™Χ Χ”Χ›ΧΧ™ Χ”ΧΆΧ“Χ™Χ£ ΧΧ‘Χ—Χ™Χ Χ Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ Χ•Χ’ΧΧ™Χ©Χ•Χ. ΧΆΧ Χ–ΧΧ, ΧΧ‘Χ—Χ™Χ Χ Χ¨ΧΧ Χ”ΧΧ‘Χ΅ΧΧ¨Χ§Χ¦Χ™Χ™Χ” Χ•Χ”Χ Χ•Χ—Χ•Χ ΧΧΧΧ›Χ Χ ΧΆΧ Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ ΧΧ•Χ‘Χ™Χ ΧΆΧ‘Χ•Χ¨ Χ”Χ¨Χ‘Χ” ΧΧ‘Χ Χ™Χ•Χ ΧΆΧ™Χ¦Χ•Χ‘ ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ. Χ‘Χ›Χ ΧΧ§Χ¨Χ”, Χ Χ™ΧΧ ΧΧ›ΧΧ•Χ‘ Χ§Χ•Χ“ Χ©ΧΧ©ΧΧ‘ Χ‘Χ™Χ Χ”Χ©Χ Χ™Χ™Χ. 

OpenMP ΧΧΧΧ‘Χ©Χ ΧΆΧ Χ›ΧΧ” Χ©Χ›Χ‘Χ•Χ Χ‘ software stack, ΧΧ¨Χ›Χ™Χ‘Χ™Χ Χ‘Χ΅Χ™Χ΅Χ™Χ™Χ Χ©Χ OpenMP Χ”Χ compiler directives, OpenMP library Χ•- environment variables.

![Pasted image 20240222150516.png|350](/img/user/Assets/Pasted%20image%2020240222150516.png)

Χ Χ΅ΧΧ›Χ ΧΆΧ Χ§Χ•Χ“ hello world ΧΧ“Χ•Χ’ΧΧ” Χ‘ OpenMP:

```C
#include <omp.h>
#include <stdio.h>

int main() {
	#pragma omp parallel
		{
			printf(" hello ");
			printf(" world\n ");
		}
	return 0;
}
```

Χ”Χ©Χ•Χ¨Χ” `pragma omp parallel` Χ”Χ™Χ Χ”Χ Χ—Χ™Χ•Χ ΧΧ§Χ•ΧΧ¤Χ™Χ™ΧΧ¨. 

Χ”Χ‘ΧΧ•Χ§ Χ‘Χ¤Χ Χ™Χ Χ—Χ™Χ™Χ‘ ΧΧ”Χ™Χ•Χ ΧΆΧ Χ©Χ•Χ¨Χ Χ›Χ Χ™Χ΅Χ” ΧΧ—Χ Χ•Χ©Χ•Χ¨Χ Χ™Χ¦Χ™ΧΧ” ΧΧ—Χ. Χ”Χ‘ΧΧ•Χ§ Χ©Χ‘Χ¤Χ Χ™Χ Χ Χ§Χ¨Χ parallel region.

Χ Χ‘Χ—Χ ΧΧ Χ¤ΧΧ Χ”ΧΧ•Χ›Χ Χ™Χ:
![Pasted image 20240222151243.png|200](/img/user/Assets/Pasted%20image%2020240222151243.png)Χ¨ΧΧ©Χ™Χ, Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ§Χ™ΧΧ¤ΧΧ Χ• ΧΆΧ Χ”Χ“Χ’Χ fopenmp.
Χ–Χ” Χ“Χ’Χ Χ©ΧΧ•ΧΧ¨ Χgcc ΧΧ”ΧΧ™Χ™Χ—Χ΅ Χdirectives Χ©Χ”Χ’Χ“Χ¨Χ Χ• Χ‘Χ§Χ•Χ“ (Χ‘ΧΧ§Χ¨Χ” Χ”Χ–Χ” Χ”Χ©Χ•Χ¨Χ” pragma omp parallel). 

Χ ΧΧ Χ• Χ”Χ•Χ¨ΧΧ” Χ- gcc ΧΧ”Χ¨Χ™Χ¥ ΧΧ Χ”Χ§Χ•Χ“ Χ©Χ‘- block Χ‘ΧΧ§Χ‘Χ™Χ ΧΆΧ ΧΧ΅Χ¤Χ¨ default Χ©Χ threads, Χ©Χ©Χ•Χ•Χ” (Χ‘Χ“Χ¨Χ Χ›ΧΧ) ΧΧΧ΅Χ¤Χ¨ cores Χ©Χ™Χ© Χ‘ΧΧ—Χ©Χ‘ Χ›Χ¤Χ•Χ ΧΧ΅Χ¤Χ¨ Χ” Hardware threads Χ©Χ™Χ© Χ‘Χ›Χ core. ΧΧ›Χ Χ”Χ§Χ•Χ“ Χ‘ΧΧ§Χ¨Χ” Χ”Χ–Χ”, ΧΧΧ‘Χ¦ΧΆ Χ‘ΧΧ§Χ‘Χ™Χ ΧΆ"Χ™ 4 threads Χ•ΧΧ Χ—Χ Χ• Χ¨Χ•ΧΧ™Χ 4 Χ”Χ“Χ¤Χ΅Χ•Χ Χ©Χ hello world.

* Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ‘Χ΅Χ•Χ£ Χ” pragma block Χ”Χ§Χ•ΧΧ¤Χ™Χ™ΧΧ¨ ΧΧ•Χ΅Χ™Χ£ wait ΧΧ•ΧΧ•ΧΧΧ™, Χ›ΧΧ•ΧΧ¨ Χ¨Χ§ ΧΧ—Χ¨Χ™ Χ©Χ›Χ Χ”threads ΧΧ΅Χ™Χ™ΧΧ™Χ ΧΧ Χ”Χ‘ΧΧ•Χ§, Χ”Χ§Χ•Χ“ Χ™ΧΧ©Χ™Χ ΧΧ¨Χ•Χ¥ ΧΧ›Χ Χ©ΧΧ¨ Χ”Χ§Χ•Χ“ Χ©ΧΧ—Χ•Χ¥ ΧΧ‘ΧΧ•Χ§.


>[!info] CPU Info
>Χ›Χ“Χ™ ΧΧ§Χ‘Χ ΧΧ™Χ“ΧΆ ΧΧ¤Χ•Χ¨Χ ΧΆΧ ΧΧ¨Χ›Χ™ΧΧ§ΧΧ•Χ¨Χ Χ”ΧΧ—Χ©Χ‘ Χ©Χ‘Χ¨Χ©Χ•ΧΧ Χ• Χ Χ•Χ›Χ ΧΧ”Χ©ΧΧΧ© Χ‘Χ¤Χ§Χ•Χ“Χ lscpu. ΧΧ Χ Χ¨Χ¦Χ” Χ¨Χ§ ΧΧ ΧΧ΅Χ¤Χ¨ Χ”ΧΧ™Χ‘Χ•Χ Χ Χ©ΧΧΧ© Χ‘Χ¤Χ§Χ•Χ“Χ nproc 
>![Pasted image 20240222172229.png](/img/user/Assets/Pasted%20image%2020240222172229.png)
>

__num of threads:__
Χ›Χ“Χ™ ΧΧ”Χ’Χ“Χ™Χ¨ Χ›ΧΧ” threads Χ Χ¨Χ¦Χ” Χ›Χ“Χ™ ΧΧ”Χ¨Χ™Χ¥ Χ§ΧΧΆ Χ§Χ•Χ“ ΧΧ§Χ‘Χ™ΧΧ™ Χ Χ©ΧΧΧ© Χ‘Χ¤Χ§Χ•Χ“Χ” omp_set_num_threads(n) ΧΧ¤Χ Χ™ Χ¤ΧΧ™Χ—Χ Χ”Χ‘ΧΧ•Χ§.

Χ›Χ“Χ™ ΧΧ§Χ‘Χ ΧΧ Χ”ΧΧ–Χ”Χ” Χ©Χ Χ›Χ thread Χ Χ¨Χ™Χ¥ ΧΧ Χ”Χ¤Χ§Χ•Χ“Χ” omp_get_thread_num .

Χ‘ΧΧ•Χ¤Χ Χ΅Χ›ΧΧΧ™ ΧΧ¤Χ©Χ¨ ΧΧΧΧ¨ ΧΧ•Χ›Χ Χ™Χ Χ”ΧΧ©ΧΧΧ©Χ Χ‘ pragma Χ‘ΧΧ•Χ¤Χ Χ”Χ‘Χ-
![Pasted image 20240308141508.png](/img/user/Assets/Pasted%20image%2020240308141508.png)

* Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ Χ©Χ Χ™ΧΧ ΧΧ”Χ›Χ Χ™Χ΅ parallel regions Χ‘ΧΧ•Χ parallel regions Χ‘ΧΆΧ Χ”Χ¦Χ•Χ¨Χ
* Χ›Χ ΧΧ”ΧΧ™Χ ΧΧ§Χ‘Χ™ΧΧ™ ΧΧ—Χ›Χ” Χ©Χ›Χ Χ”threads Χ‘ΧΧ•Χ›Χ• Χ™Χ΅Χ™Χ™ΧΧ• Χ›Χ“Χ™ ΧΧ”ΧΧ©Χ™Χ Χ‘Χ—ΧΧ§ Χ”Χ΅Χ“Χ¨ΧΧ™ Χ©Χ Χ” main thread .
* Χ›Χ“ΧΧ™ ΧΧ©Χ™Χ ΧΧ‘ Χ© omp ΧΆΧΧ•Χ ΧΧ™Χ™Χ¦Χ¨ Χ¤Χ—Χ•Χ threads ΧΧΧ” Χ©Χ¨Χ¦Χ™Χ Χ•.
* Χ”Χ΅Χ›ΧΧ” Χ”ΧΧΧ•ΧΧ¨Χ Χ Χ§Χ¨ΧΧ [Fork-Join parallelism](https://en.wikipedia.org/wiki/Fork%E2%80%93join_model)

__Fork-Join parallelism:__
Χ§ΧΧΆΧ™Χ ΧΧ΅Χ•Χ™ΧΧ™Χ ΧΧ”Χ§Χ•Χ“ ΧΧΧ•Χ§Χ‘ΧΧ™Χ, Χ§ΧΧΆ Χ§Χ•Χ“ ΧΧ§Χ‘Χ™ΧΧ™ Χ”Χ‘Χ ΧΧΧ—Χ™Χ Χ¨Χ§ Χ›ΧΧ©Χ¨ Χ§ΧΧΆ Χ§Χ•Χ“ ΧΧ§Χ‘Χ™ΧΧ™ Χ”Χ§Χ•Χ“Χ ΧΧ• ΧΧ΅ΧΧ™Χ™Χ. Χ”Χ”Χ Χ—Χ” Χ©Χ Χ©Χ™ΧΧ” Χ–Χ• Χ”Χ™Χ Χ©Χ”ΧΧ•Χ›Χ Χ™Χ ΧΧΧ—Χ™ΧΧ” Χthread Χ™Χ—Χ™Χ“ Χ©Χ Χ§Χ¨Χ master thread ΧΧ• main Χ•ΧΧΧ Χ• Χ™Χ•Χ¦ΧΧ™Χ Χ›Χ Χ”Χ§ΧΧΆΧ™Χ Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ™Χ.

![Pasted image 20240308220651.png](/img/user/Assets/Pasted%20image%2020240308220651.png)

## Χ—Χ™Χ©Χ•Χ‘ Euler Mascheroni constant
Χ Χ¨ΧΧ” ΧΧ™Χ ΧΧ—Χ©Χ‘Χ™Χ Χ‘ΧΧ•Χ¤Χ Χ΅Χ“Χ¨ΧΧ™ Χ•ΧΆΧ OMP ΧΧ Χ”Χ Χ•Χ΅Χ—Χ” Χ©Χ [Χ§Χ‘Χ•ΧΆ ΧΧ•Χ™ΧΧ¨](https://en.wikipedia.org/wiki/Euler%27s_constant) 

$$\lim_{ n \to \infty } \log(n) - \sum^{n}_{i=1} \frac{1}{i} \approx -0.577216 $$

Χ”Χ—Χ™Χ©Χ•Χ‘ Χ‘Χ¦Χ•Χ¨Χ” Χ΅Χ“Χ¨ΧΧ™Χ Χ”Χ•Χ Χ¤Χ©Χ•Χ 

```C 
double seq_euler_mascheroni() {
	double sum = 0;

	for( int i = 1; i < N; i ++){
		sum+= 1.0/i;
	}

	return log(N) - sum;
}
```

Χ›ΧΆΧ Χ Χ©Χ•Χ•Χ” ΧΧ’Χ¨Χ΅Χ” Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ 

```C
double sum = 0;

#pragma omp_parallel 
{
	const int num_threads = omp_get_num_threads();

	double thread_sum = 0;
	int tid = omp_get_thread_num + 1;

	for(int i= tid; i < N; i+= num_threads) {
		threads_sum += 1.0/i;
	}

	#pragma omp critical
		sum += thread_sum
}
```

* sum Χ”Χ•Χ ΧΧ©ΧΧ Χ” Χ’ΧΧ•Χ‘ΧΧ™
* Χ›Χ thread ΧΧ—Χ–Χ™Χ§ ΧΧ ΧΧ΅Χ¤Χ¨ Χ”threads Χ• thread sum ΧΆΧ ΧΆΧ¨Χ Χ”ΧΧ—ΧΧΧ™ 0
* Χ›Χ thread ΧΧ—Χ–Χ™Χ§ ΧΧ Χ” thread id Χ©ΧΧ• Χ›ΧΧ©Χ¨ Χ–Χ” ΧΧ΅Χ¤Χ¨ ΧΧ‘ΧΆΧ™ Χ©Χ’Χ“Χ Χ‘1 ΧΆΧ‘Χ•Χ¨ Χ›Χ thread ΧΧ¤Χ™ Χ΅Χ“Χ¨ Χ”Χ™Χ¦Χ™Χ¨Χ”
* Χ›Χ ΧΧ—Χ“ ΧΧ”threads ΧΧ—Χ©Χ‘ ΧΧ ΧΧ Χ”Χ΅Χ›Χ•Χ Χ©Χ”Χ•Χ ΧΧΧ—Χ™Χ ΧΧ”ΧΧ–Χ”Χ” Χ©Χ Χ”threads Χ•Χ§Χ•Χ¤Χ¥ Χ‘ num of threads ΧΆΧ“ Χ©ΧΧ’Χ™ΧΆ ΧΧΧ΅Χ¤Χ¨ Χ”Χ™ΧΆΧ“ N
* Χ›ΧΆΧ ΧΧ’Χ“Χ™Χ¨Χ™Χ ΧΧ§Χ•ΧΧ¤Χ™Χ™ΧΧ¨ Χ§ΧΧΆ Χ§Χ•Χ“ Χ§Χ¨Χ™ΧΧ™ Χ©Χ΅Χ•Χ›Χ ΧΧ Χ”ΧΧ™Χ“ΧΆ ΧΧΧ©ΧΧ Χ” Χ”Χ’ΧΧ•Χ‘ΧΧ™.


ΧΧ Χ Χ‘Χ¦ΧΆ benchmark Χ‘ΧΧΧ¦ΧΆΧ•Χ Χ”Χ¤Χ•Χ Χ§Χ¦Χ™Χ” `omp_get_wtime` Χ Χ§Χ‘Χ Χ–ΧΧ Χ¨Χ™Χ¦Χ” Χ©ΧΧ©ΧΧΆΧ•ΧΧ™Χ Χ™Χ•ΧΧ¨ ΧΧ”Χ™Χ¨ Χ‘ΧΧΧ’Χ•Χ¨Χ™ΧΧ Χ”ΧΧ§Χ‘Χ™ΧΧ™ 

![Pasted image 20240308150356.png](/img/user/Assets/Pasted%20image%2020240308150356.png)

## False sharing
Χ Χ΅ΧΧ›Χ ΧΆΧ Χ§Χ•Χ“ Χ΅Χ“Χ¨ΧΧ™ Χ•ΧΧ§Χ‘Χ™ΧΧ™ ΧΧ΅Χ›Χ™ΧΧ ΧΧΆΧ¨Χ 

![Pasted image 20240308151108.png|350](/img/user/Assets/Pasted%20image%2020240308151108.png)
![Pasted image 20240308151057.png|350](/img/user/Assets/Pasted%20image%2020240308151057.png)

Χ”ΧΧΧ’Χ•Χ¨Χ™ΧΧ Χ”ΧΧ§Χ‘Χ™ΧΧ™ ΧΧ—Χ©Χ‘ ΧΧ Χ”Χ΅Χ›Χ•ΧΧ™Χ Χ”Χ—ΧΧ§Χ™Χ™Χ Χ•ΧΧ‘Χ΅Χ•Χ£ ΧΧ—Χ‘Χ¨ ΧΧ Χ”Χ›Χ Χ‘Χ™Χ—Χ“. Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ”Χ•Χ ΧΧ©ΧΧΧ© Χ¤Χ” Χ‘Χ¤Χ§Χ•Χ“Χ omp single Χ©Χ–ΧΧ Χ¤Χ§Χ•Χ“Χ” Χ©ΧΧΧ¤Χ©Χ¨Χ Χ¨Χ§ Χthread ΧΧ—Χ“ ΧΧ”Χ›Χ Χ΅ ΧΧΧ™Χ• Χ•ΧΧΧ—Χ¨ ΧΧ›Χ ΧΧ ΧΧ›Χ Χ™Χ΅Χ” Χ™Χ•ΧΧ¨ threads ΧΧ§ΧΧΆ Χ”Χ§Χ•Χ“ Χ”Χ–Χ” (ΧΧ ΧΧ Χ”Χ™Χ™Χ Χ• ΧΧ©ΧΧΧ©Χ™Χ Χ‘ OpenMP ΧΧ›ΧΧ•Χ‘ Χ“Χ‘Χ¨ Χ›Χ–Χ” Χ”Χ™Χ” Χ“Χ•Χ¨Χ© ΧΧ Χ’Χ Χ•Χ ΧΧ©ΧΧ Χ•). Χ”Χ©Χ™ΧΧ•Χ© Χ‘Χ¤Χ§Χ•Χ“Χ” Χ–ΧΧ Χ”Χ™Χ ΧΧ•Χ‘Χ” Χ›ΧΧ©Χ¨ Χ Χ¨Χ¦Χ” ΧΧ”Χ–Χ™Χ Χ¤Χ¨ΧΧΧ¨ Χ¨Χ§ Χ¤ΧΆΧ ΧΧ—Χ Χ‘ΧΧ§Χ¨Χ” Χ”Χ–Χ” thread_num Χ”Χ•Χ Χ”Χ¤Χ¨ΧΧΧ¨ Χ”Χ–Χ”.

ΧΧ Χ Χ‘Χ“Χ•Χ§ ΧΧ ΧΧ•Χ¦ΧΧ•Χ Χ”Χ”Χ¨Χ¦ΧΧ” ΧΆΧ‘Χ•Χ¨ ΧΧΆΧ¨Χ›Χ™Χ Χ’Χ“Χ•ΧΧ™Χ Χ‘ΧΧ™Χ•Χ—Χ“ Χ Χ§Χ‘Χ
![Pasted image 20240308151300.png](/img/user/Assets/Pasted%20image%2020240308151300.png)
Χ›ΧΧ•ΧΧ¨ ΧΧ Χ—Χ Χ• Χ¨Χ•ΧΧ™Χ Χ©Χ–ΧΧ Χ™ Χ”Χ”Χ¨Χ¦Χ” Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ™Χ Χ’Χ¨Χ•ΧΆΧ™Χ Χ™Χ•ΧΧ¨ ΧΧ”Χ΅Χ“Χ¨ΧΧ™Χ™Χ.

Χ–Χ” Χ™Χ›Χ•Χ ΧΧ Χ‘Χ•ΧΆ ΧΧ›ΧΧ” Χ΅Χ™Χ‘Χ•Χ:
	1) overhead 
	2) [[Computer Science/Computer System/Computer System Cache Memory\|cache]]- ΧΧ›Χ thread Χ©Χ¨Χ¥ ΧΆΧ ΧΧΆΧ‘Χ“ ΧΧ—Χ¨ Χ™Χ© L1 cache ΧΧ©ΧΧ•. Χ Χ–Χ›Χ™Χ¨ Χ©Χ›ΧΧ©Χ¨ Χ§Χ•Χ¨ΧΧ™Χ ΧΧ™Χ“ΧΆ ΧΧ”Χ–Χ›Χ¨Χ•Χ Χ•Χ©ΧΧ™Χ Χ‘ cache Χ©ΧΧ™Χ Χ’Χ ΧΧ Χ”ΧΧ™Χ“ΧΆ ΧΧ΅Χ‘Χ™Χ‘ Χ‘ΧΧ•ΧΧ• cache line Χ›Χ“Χ™ ΧΧ©ΧΧ•Χ¨ ΧΆΧ ΧΧ•Χ§ΧΧ™Χ•Χ Χ’Χ‘Χ•Χ”Χ”. Χ‘ΧΧ›Χ Χ•Χ ΧΧ§Χ‘Χ™ΧΧ™ multicore Χ›ΧΧ©Χ¨ thread ΧΧ©Χ Χ” ΧΧ Χ”cache Χ‘ΧΧΆΧ‘Χ“ Χ©ΧΧ•, Χ”Χ—Χ•ΧΧ¨Χ” ΧΧ•Χ“Χ™ΧΆΧ” ΧΧ©ΧΧ¨ Χ”ΧΧΆΧ‘Χ“Χ™Χ Χ©Χ”cache Χ”Χ©ΧΧ Χ” Χ•ΧΧΧ¨Χ—Χ© cache invalidation ΧΧ” Χ©Χ’Χ•Χ¨Χ ΧΧ›Χ L1 cache Χ©Χ Χ”threads ΧΧ’Χ©Χ Χ©Χ•Χ‘ ΧRAM ΧΆΧ Χ›Χ Χ¤ΧΆΧ•ΧΧ Χ—Χ™Χ‘Χ•Χ¨ ΧΧ” Χ©Χ™Χ•Χ¦Χ¨ Χ—Χ•Χ΅Χ¨ Χ Χ™Χ¦Χ•Χ Χ©Χ Χ”cache .

__ΧΧ” Χ”Χ¤ΧΧ¨Χ•Χ?__
Χ Χ•Χ›Χ ΧΧ©Χ Χ•Χ ΧΧ Partial sum ΧΧΆΧ‘Χ•Χ¨ ΧΆΧ ΧΧΆΧ¨Χ Χ“Χ• ΧΧ™ΧΧ“Χ™ Χ•Χ›Χ threads Χ™Χ§Χ‘Χ Χ©Χ•Χ¨Χ” ΧΧ©ΧΧ• Χ•Χ›Χ›Χ” ΧΧ Χ™Χ”Χ™Χ” ΧΧ¦Χ‘ Χ©threads Χ“Χ•Χ¨Χ΅Χ™Χ ΧΧ Χ”lines ΧΧ—Χ“ Χ©Χ Χ”Χ©Χ Χ™.

![Pasted image 20240308152659.png](/img/user/Assets/Pasted%20image%2020240308152659.png)

Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ Χ©Χ–Χ” ΧΧ›Χ ΧΧ©Χ¤Χ¨ ΧΧ©ΧΧΆΧ•ΧΧ™Χ ΧΧ Χ”Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ Χ©Χ ΧΧ•Χ›Χ Χ™Χ ΧΧ§Χ‘Χ™ΧΧ™Χ
![Pasted image 20240308152712.png](/img/user/Assets/Pasted%20image%2020240308152712.png)

## PI Approximation 
ΧΧ Χ—Χ Χ• Χ™Χ•Χ“ΧΆΧ™Χ Χ©ΧΧΧ§Χ™Χ™Χ

$$\int_{0}^{1} \, \frac{4.0}{1+x^{2}}dx = \pi $$

Χ›ΧΧ•ΧΧ¨ Χ Χ•Χ›Χ ΧΧ§Χ‘Χ Χ§Χ™Χ¨Χ•Χ‘ Χ©Χ $\pi$ Χ‘ΧΧΧ¦ΧΆΧ•Χ Χ—Χ™Χ©Χ•Χ‘ Χ©Χ [[Computer Science/Calculus/The Integral\|Χ”ΧΧ™Χ ΧΧ’Χ¨Χ]] Χ›Χ΅Χ›Χ•Χ Χ©Χ N Χ©ΧΧ—Χ™ ΧΧΧ‘Χ Χ™Χ 

$$\sum_{i=0}^{n} F(x_{i})\cdot \Delta x\approx \pi$$

![Screenshot 2024-03-08 at 17.55.15.png|300](/img/user/Assets/Screenshot%202024-03-08%20at%2017.55.15.png)

Χ Χ›ΧΧ•Χ‘ Χ§Χ•Χ“ ΧΧ§Χ‘Χ™ΧΧ™ Χ©ΧΧΧ¤Χ©Χ¨ ΧΧ Χ• ΧΧ—Χ©Χ‘ ΧΧ Χ–Χ” Χ•Χ Χ‘Χ—Χ ΧΧ Χ”Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ Χ©ΧΧ• ΧΧΆΧ•ΧΧ Χ§Χ•Χ“ Χ΅Χ“Χ¨ΧΧ™

Χ”Χ—Χ™Χ©Χ•Χ‘ Χ”ΧΧ§Χ‘Χ™ΧΧ™ Χ™Χ”Χ™Χ” Χ“Χ•ΧΧ” ΧΧΧ” Χ©ΧΆΧ©Χ™Χ Χ• Χ‘Χ“Χ•Χ’ΧΧΧ•Χ Χ”Χ§Χ•Χ“ΧΧ•Χ, Χ›Χ thread Χ™Χ‘Χ¦ΧΆ Χ΅Χ›Χ•Χ Χ—ΧΧ§Χ™ Χ©Χ Χ©ΧΧ—Χ™ Χ”ΧΧΧ‘Χ Χ™Χ Χ•ΧΧ‘Χ΅Χ•Χ£ Χ‘Χ§ΧΧΆ Χ§Χ•Χ“ Χ΅Χ“Χ¨ΧΧ™ Χ™Χ΅Χ›Χ•Χ ΧΧ Χ›Χ Χ”Χ΅Χ›Χ•ΧΧ™Χ Χ”Χ—ΧΧ§Χ™Χ™Χ. ΧΧ Χ”Χ΅Χ›Χ•ΧΧ™Χ Χ Χ™ΧΧ ΧΧ©ΧΧ•Χ¨ Χ‘ΧΧΧ¦ΧΆΧ•Χ ΧΧΆΧ¨Χ Χ©Χ’Χ•Χ“ΧΧ• Χ›ΧΧ΅Χ¤Χ¨ Χ”threads Χ•Χ›Χ›Χ” Χ›Χ thread ΧΧ§Χ‘Χ ΧΧ©Χ‘Χ¦Χ ΧΧ—Χ Χ‘ΧΧΆΧ¨Χ ΧΧ‘ΧΧ™ ΧΧ“ΧΧ•Χ’ Χrace condition (Χ›Χ¤Χ™ Χ©Χ”Χ¨ΧΧ Χ•, Χ–Χ” Χ™Χ›Χ•Χ ΧΧ¤Χ’Χ•ΧΆ Χ‘Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ ΧΧ ΧΧ ΧΧ•Χ§Χ—Χ™Χ Χ‘Χ—Χ©Χ‘Χ•Χ ΧΧ Χ”ΧΧΧΧ•Χ).

![Pasted image 20240308180620.png|300](/img/user/Assets/Pasted%20image%2020240308180620.png)

Χ‘ΧΧ›Χ Χ•Χ ΧΧ§Χ‘Χ™ΧΧ™ Χ–Χ” Χ™Χ™Χ¨ΧΧ” Χ›Χ›Χ”
```C
#include <omp.h>
#include<stdio.h>

	#define N 2 // required number of threadsint main ()
	
    int N_actual; // actual number of threads
Β  Β  long num_steps = 100000;
Β  Β  double sum[N] = {0};
Β  Β  double step = 1.0/(double) num_steps;

    omp_set_num_threads(N);
    #pragma omp parallel
    {
        int id = omp_get_thread_num();
        double x;
        #pragma omp single
           N_actual = omp_get_num_threads();

Β  Β      for (int i=id; i< num_steps; i+= N_actual) {
Β  Β  Β  Β      x = (i+0.5)*step;
Β  Β  Β  Β      sum[id] += 4.0/(1.0+x*x);
Β  Β      }
    }
Β  Β  double pi = 0;
    for (int i=0; i < N_actual; i++)
        pi += step * sum[i];
Β  Β  printf("%f\n", pi);
Β  Β  return 0;
}
```

ΧΧ Χ ΧΧ“Χ•Χ“ Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ Χ Χ§Χ‘Χ 
![Pasted image 20240308181117.png|300](/img/user/Assets/Pasted%20image%2020240308181117.png)

Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ Χ©Χ”Χ—Χ Χ N=3 Χ™Χ© Χ™Χ¨Χ™Χ“Χ Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ. Χ”Χ΅Χ™Χ‘Χ” ΧΧ›Χ Χ”Χ™Χ ΧΧ›Χ™Χ•Χ•Χ Χ©Χ‘ΧΧΆΧ‘Χ“ ΧΧ—Χ“ Χ™Χ© Χ›ΧΧ” ΧΧ™Χ‘Χ•Χ Χ•Χ‘Χ›Χ ΧΧ™Χ‘Χ” Χ Χ™ΧΧ ΧΧ”Χ¨Χ™Χ¥ ΧΧ΅Χ¤Χ¨ HW threads (Χ‘Χ“Χ΄Χ› 2) Χ•ΧΧ—Χ“ Χ”Χ¤ΧΧ¨Χ•Χ Χ•Χ Χ”Χ—Χ•ΧΧ¨ΧΧ™Χ™Χ Χ©Χ™Χ© ΧΧΧΆΧ‘Χ“Χ™Χ __ΧΧ¨Χ•Χ‘Χ™ ΧΧ™Χ‘Χ•Χ__ Χ”Χ•Χ Χ©Χ‘Χ¨Χ’ΧΆ Χ©Χ™Χ© Χ©Χ Χ™ cores ΧΆΧ ΧΧ•ΧΧ” ΧΧ•Χ›Χ Χ™Χ Χ•Χ” L1 cache Χ©Χ ΧΧ—Χ“ ΧΧ”Χ ΧΧ©ΧΧ Χ” , Χ”Χ•Χ ΧΧ•Χ“Χ™ΧΆ ΧL1 cache Χ©Χ Χ”ΧΧ—Χ¨Χ™Χ Χ©Χ”Χ invalid Χ•ΧΆΧΧ™Χ”Χ ΧΧΆΧ“Χ›Χ ΧΧ Χ”ΧΧΧΧ•Χ Χ©ΧΧ”Χ.

Χ Χ™Χ§Χ— Χ‘Χ™Χ¦Χ•ΧΆ Χ©Χ ΧΧ¨Χ‘ΧΆΧ” threads . ΧΧ›Χ™Χ•Χ•Χ Χ©Χ›Χ core ΧΧ›Χ™Χ Χ©Χ Χ™ HR (Hardware threads), Χ”Χ•Χ Χ™Χ›Χ•Χ ΧΧ”Χ¨Χ™Χ¥ Χ©Χ Χ™ threads. ΧΧ¨Χ‘ΧΆΧ” threads Χ™Χ¨Χ•Χ¦Χ• ΧΆΧ Χ©Χ Χ™ cores Χ©Χ•Χ Χ™Χ. ΧΧ›Χ core Χ™Χ© L1 cache Χ¤Χ¨ΧΧ™ ΧΧ©ΧΧ•. Χ›ΧΧ©Χ¨ thread0 Χ¨Χ•Χ¦Χ” ΧΧΆΧ“Χ›Χ $sum[0]$, Χ—ΧΧ§ Χ©Χ RAM Χ‘Χ’Χ•Χ“Χ cache line (Χ‘Χ’Χ•Χ“Χ 64 bites ΧΆΧ‘Χ•Χ¨ 64-bit architecture) ΧΧ•Χ‘Χ Χ- L1 cache Χ©Χ core ΧΧ©Χ¨ ΧΧ¨Χ™Χ¥ ΧΧ thread1. 

![Pasted image 20240308182134.png|300](/img/user/Assets/Pasted%20image%2020240308182134.png)

Χ›ΧΧ©Χ¨ thread2 Χ¨Χ•Χ¦Χ” ΧΧΆΧ“Χ›Χ $sum[2]$, Χ—ΧΧ§ Χ©Χ RAM Χ‘Χ’Χ•Χ“Χ cache line ΧΧ•Χ‘Χ Χ- L1 cache Χ©Χ core ΧΧ©Χ¨ ΧΧ¨Χ™Χ¥ ΧΧ thread2. Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ©Χ Χ™ cache lines ΧΧ›Χ™ΧΧ•Χ ΧΧ Χ”ΧΧΆΧ¨Χ Χ©ΧΧ•. Χ‘Χ¨Χ’ΧΆ Χ©- thread2 ΧΧ‘Χ¦ΧΆ ΧΆΧ“Χ›Χ•Χ Χ©Χ $sum[2]$, Χ”- cache line Χ”Χ–Χ” Χ‘- L1 cache of Core1 ΧΧ΅Χ•ΧΧ Χ›- invalid, Χ›ΧΧ•ΧΧ¨, ΧΧ ΧΧ©Χ™ΧΧ•Χ©. Χ–Χ” ΧΧ›Χ™Χ•Χ•Χ Χ©Χ”Χ•Χ ΧΧ›Χ™Χ data ΧΧ ΧΆΧ“Χ›Χ Χ™. Χ›ΧΧ©Χ¨ thread0 Χ™Χ¨Χ¦Χ” ΧΧΆΧ“Χ›Χ Χ©Χ•Χ‘ Χ¤ΧΆΧ ΧΧ $sum[0]$, Χ”Χ•Χ Χ™Χ¦ΧΧ¨Χ ΧΧ‘Χ¦ΧΆ Χ’Χ™Χ©Χ” Χ- RAM Χ›Χ“Χ™ ΧΧ”Χ‘Χ™Χ ΧΧ Χ”- cache line ΧΧ—Χ“Χ©.

![Pasted image 20240308182644.png|300](/img/user/Assets/Pasted%20image%2020240308182644.png)

Χ”Χ¤ΧΧ¨Χ•Χ Χ”Χ•Χ Χ”Χ§Χ¦ΧΧ” Χ©Χ ΧΧΆΧ¨Χ Χ“Χ• ΧΧ™ΧΧ“Χ™ Χ©ΧΧΧ ΧΆ Χ—Χ¤Χ™Χ¤Χ” Χ‘Χ™Χ cache lines Χ©Χ threads Χ©Χ•Χ Χ™Χ. ΧΧ•ΧΧ Χ, Χ–Χ” Χ‘Χ–Χ‘Χ•Χ– Χ–Χ›Χ¨Χ•Χ RAM, ΧΧ‘Χ Χ–Χ›Χ¨Χ•Χ Χ”Χ•Χ ΧΧ“Χ“ ΧΧ©Χ Χ™ ΧΧΆΧ•ΧΧ Χ–ΧΧ Χ¨Χ™Χ¦Χ”.

```C
#include <omp.h>
#include<stdio.h>

#define N 2 // required number of threads
#define PAD 8 // assume 64-byte L1 cache line size
int main () { 
    int N_actual; // actual number of threads
Β  Β  long num_steps = 100000000;
Β  Β  double sum[N][PAD] = {{0}};
Β  Β  double step = 1.0/(double) num_steps;

    double tdata = omp_get_wtime();
    omp_set_num_threads(N);
    #pragma omp parallel
    {
        int id = omp_get_thread_num();
        double x;
        #pragma omp single
           N_actual = omp_get_num_threads();

Β  Β      for (int i=id; i< num_steps; i+= N_actual) {
Β  Β  Β  Β      x = (i+0.5)*step;
Β  Β  Β  Β      sum[id][0] += 4.0/(1.0+x*x);
Β  Β      }
    }
Β  Β  double pi = 0;
    for (int i=0; i < N_actual; i++)
        pi += step * sum[i][PAD];
    tdata = omp_get_wtime() - tdata;
    printf("pi = %f in %f secs\n", pi, tdata);
Β  Β  return 0;
}
```

Χ›Χ™Χ•Χ•Χ Χ©Χ›Χ thread ΧΆΧ•Χ‘Χ“ ΧΆΧ Χ©Χ•Χ¨Χ” Χ©ΧΧ• Χ‘ΧΧΆΧ¨Χ Χ‘Χ”ΧΧΧ Χ id, ΧΧ›Χ ΧΧ™Χ Χ©Χ•Χ¨Χ•Χ cache ΧΧ©Χ•ΧΧ¤Χ•Χ.

![Pasted image 20240308183013.png|300](/img/user/Assets/Pasted%20image%2020240308183013.png)

Χ”Χ–ΧΧ Χ¨Χ™Χ¦Χ” ΧΧ›Χ Χ”Χ©ΧΧ¤Χ¨ Χ’Χ ΧΆΧ‘Χ•Χ¨ N=3,4. Χ”ΧΧ—Χ™Χ¨ Χ©Χ§Χ™Χ‘ΧΧ Χ• Χ”Χ•Χ Χ§Χ•Χ“ ΧΧΧ•Χ“ ΧΧ΅Χ•Χ¨Χ‘Χ. Χ Χ Χ΅Χ” ΧΧ‘Χ—Χ•Χ Χ“Χ¨Χ›Χ™Χ Χ Χ•Χ΅Χ¤Χ•Χ.

Χ›ΧΧ™ Χ Χ•Χ΅Χ£ Χ”Χ•Χ Χ”Χ’Χ“Χ¨Χ critical section Χ‘ΧΧ•Χ Χ”Χ§Χ•Χ“ Χ”ΧΧ§Χ‘Χ™ΧΧ™ , Χ‘ΧΧ§Χ•Χ ΧΧ”Χ—Χ–Χ™Χ§ ΧΧΆΧ¨Χ Χ©Χ Χ΅Χ›Χ•ΧΧ™Χ Χ—ΧΧ§Χ™Χ™Χ Χ Χ•Χ›Χ ΧΧ“ΧΧ•Χ’ Χ©Χ›Χ thread Χ™Χ—Χ©Χ‘ ΧΧ Χ”Χ΅Χ›Χ•Χ Χ©ΧΧ• Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ•ΧΧ™Χ Χ•Χ‘Χ§ΧΧΆ Χ”Χ§Χ•Χ“ Χ”Χ§Χ¨Χ™ΧΧ™ Χ Χ΅Χ›Χ•Χ ΧΧ Χ”ΧΧ•Χ¦ΧΧ” Χ”Χ΅Χ•Χ¤Χ™Χ ΧΧΆΧ¨Χ Χ©Χ $\pi$ .

```C
#include <omp.h>
#include<stdio.h>

#define N 2 // required number of threadsint main () { 
Β  Β  long num_steps = 100000000;
Β  Β  double pi = 0;
Β  Β  double step = 1.0/(double) num_steps;

    double tdata = omp_get_wtime();
    omp_set_num_threads(N);
    #pragma omp parallel
    {
        int id = omp_get_thread_num();
        double x, sum = 0;
        #pragma omp single
           N_actual = omp_get_num_threads();

Β  Β      for (int i=id; i< num_steps; i+= N_actual) {
Β  Β  Β  Β      x = (i+0.5)*step;
            sum += 4.0/(1.0+x*x);
        }
Β  Β  Β  Β  #pragma omp critical
            pi += sum * step;
    }
    tdata = omp_get_wtime() - tdata;
    printf("pi = %f in %f secs\n", pi, tdata);
Β  Β  return 0;
}
```

Χ‘Χ©Χ™ΧΧ” Χ–Χ• Χ Χ§Χ‘Χ Χ‘Χ™Χ¦Χ•ΧΆΧ™Χ Χ“Χ•ΧΧ™Χ ΧΧ©Χ™ΧΧ” Χ”Χ§Χ•Χ“ΧΧ Χ‘Χ§Χ•Χ“ Χ™Χ•ΧΧ¨ ΧΧ΅Χ•Χ“Χ¨. 
## Loops 
Χ›ΧΧ” Χ›ΧΧΧ™ ΧΧ•ΧΧΧ•Χ Χ—Χ©Χ•Χ‘Χ™Χ Χ‘ OpenMP:
1) ΧΧ for loop ΧΧ•Χ¤Χ™ΧΆ Χ‘Χ§ΧΧΆ Χ§Χ•Χ“ ΧΧ§Χ‘Χ™ΧΧ™, ΧΧ– Χ›Χ ΧΧ—Χ“ ΧΧ” threads Χ™Χ‘Χ¦ΧΆ ΧΧ Χ”ΧΧ•ΧΧΧ” Χ‘ΧΧΧ•ΧΧ”.
```C
#include <omp.h>
#include<stdio.h>

int main () { 
    #pragma omp parallel
    {
        for(int i=0; i<2; i++)
            printf("i=%d, ID=%d\n", i, omp_get_thread_num());
    }
    return 0;
}

```
2) ΧΧ Χ¨Χ•Χ¦Χ™Χ ΧΧ‘Χ¦ΧΆ ΧΧ•ΧΧΧ” Χ¤ΧΆΧ ΧΧ—Χ Χ‘ΧΧ‘Χ“, ΧΧ‘Χ ΧΧ—ΧΧ§ ΧΧ•ΧΧ” ΧΧ—ΧΧ§Χ™Χ Χ›Χ Χ©Χ›Χ Χ—ΧΧ§ Χ™ΧΧ‘Χ¦ΧΆ ΧΆΧ Χ™Χ“Χ™ thread ΧΧ—Χ¨ ΧΧ– Χ Χ™ΧΧ ΧΧ”Χ©ΧΧΧ© Χ‘pragma omp for Χ‘ΧΧ•Χ parallel block ΧΧ•pragma omp parallel for. 

```C
#include <omp.h>
#include<stdio.h>

int main () { 
    #pragma omp parallel
    {
          #pragma omp for
            for(int i=0; i<2; i++)
                printf("i=%d, ID=%d\n", i, omp_get_thread_num());
    }
    return 0;
}

//or use:
int main () { 
    #pragma omp parallel for
     for(int i=0; i<2; i++)
        printf("i=%d, ID=%d\n", i, omp_get_thread_num());
  
    return 0;
}
```

Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ‘Χ“Χ•Χ’ΧΧ Χ”Χ§Χ•Χ“ Χ”ΧΧ—Χ¨Χ•Χ Χ Χ§Χ‘Χ 2 threads Χ•ΧΧ 4 Χ›ΧΧ• Χ‘Χ¨Χ•Χ‘ Χ”ΧΧ§Χ¨Χ™Χ Χ”Χ“Χ™Χ¤Χ•ΧΧΧ™Χ Χ‘Χ’ΧΧ Χ©Χ”Χ§Χ•ΧΧ¤Χ™Χ™ΧΧ¨ Χ‘Χ©Χ™ΧΧ•Χ£ ΧΆΧ ΧΧΆΧ¨Χ›Χ Χ”Χ”Χ¤ΧΆΧΧ” Χ”Χ—ΧΧ™ΧΧ• ΧΧ”Χ§Χ¦Χ•Χ Χ¤Χ—Χ•Χ ΧΧΧ” Χ©Χ”Χ•Χ Χ™Χ›Χ•Χ Χ›Χ™ ΧΧ΅Χ¤Χ¨ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ”Χ•Χ 2.
### Nested loops
Χ›ΧΧ©Χ¨ Χ™Χ© nested loop Χ©Χ›ΧΧ•Χ‘ Χ‘ΧΧ•Χ Χ‘ΧΧ•Χ§ ΧΧ§Χ‘Χ™ΧΧ™, Χ¨Χ§ Χ”ΧΧ•ΧΧΧ” Χ”Χ—Χ™Χ¦Χ•Χ Χ™Χ ΧΧΧΧ§Χ‘Χ. 

![Pasted image 20240308213755.png|350](/img/user/Assets/Pasted%20image%2020240308213755.png)

Χ–ΧΧ __Χ”Χ”ΧΧ Χ”Χ’Χ•Χ Χ”Χ“Χ™Χ¤Χ•ΧΧΧ™Χ‘Χ™Χ__ ΧΧ Χ Χ¨Χ¦Χ” ΧΧ©Χ Χ•Χ ΧΧ•ΧΧ” Χ Χ•Χ›Χ ΧΧ”Χ©ΧΧΧ© Χ‘ΧΧ™ΧΧ” Χ”Χ©ΧΧ•Χ¨Χ” collaps(#loops). Χ–Χ” ΧΧ•ΧΧ¨ ΧΧ§Χ•ΧΧ¤Χ™Χ™ΧΧ¨ Χ©ΧΧ Χ—Χ Χ• Χ¨Χ•Χ¦Χ™Χ ΧΧΧ§Χ‘Χ ΧΧ Χ›Χ Χ”ΧΧ•ΧΧΧ•Χ Χ”Χ¤Χ Χ™ΧΧ™Χ•Χ ΧΆΧ“ Χ”Χ¨ΧΧ” Χ©Χ”Χ™Χ Χ”ΧΧ΅Χ¤Χ¨ Χ©Χ”ΧΆΧ‘Χ¨Χ Χ• 

![Pasted image 20240308214014.png|350](/img/user/Assets/Pasted%20image%2020240308214014.png)

Χ‘ΧΧ§Χ¨Χ” Χ–Χ”, Χ›Χ thread Χ‘Χ™Χ¦ΧΆ ΧΧ™ΧΧ¨Χ¦Χ™Χ” ΧΧ—Χ. Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ‘Χ§Χ•Χ“ Χ–Χ” Χ‘Χ Χ™Χ’Χ•Χ“ ΧΧ§Χ•Χ“Χ ΧΧ Χ¤Χ’ΧΆΧ Χ• Χ‘Χ¨ΧΧ Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ Χ•Χ’Χ ΧΧ Χ‘Χ Χ›Χ•Χ Χ•Χ Χ©Χ Χ”Χ§Χ•Χ“. 

__End of loop barrier:__
Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ™Χ© barrier ΧΧ ΧΧ¤Χ•Χ¨Χ© Χ‘Χ΅Χ•Χ£ ΧΧ•ΧΧΧ for ΧΧ§Χ‘Χ™ΧΧ™Χ. Χ›ΧΧ•ΧΧ¨ threads Χ™Χ—Χ›Χ• Χ‘Χ΅Χ•Χ£ Χ”ΧΧ•ΧΧΧ” ΧΧ©ΧΧ¨ Χ”threads Χ©Χ¨Χ¦Χ™Χ Χ©Χ™Χ΅Χ™Χ™ΧΧ• ΧΧ Χ”ΧΧ•ΧΧΧ” Χ’Χ Χ›Χ. 

![Pasted image 20240308214542.png|350](/img/user/Assets/Pasted%20image%2020240308214542.png)

Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ ΧΧ¤Χ™ Χ”Χ”Χ“Χ¤Χ΅Χ” Χ©Χ›Χ Χ”threads Χ—Χ™Χ›Χ• ΧΆΧ“ Χ©Χ›Χ•ΧΧ Χ™Χ΅Χ™Χ™ΧΧ• ΧΧ Χ”ΧΧ•ΧΧΧ” Χ•Χ¨Χ§ ΧΧ– Χ”ΧΧ—Χ™ΧΧ• Χ‘Χ”Χ“Χ¤Χ΅Χ”.

ΧΧ Χ Χ¨Χ¦Χ” ΧΧ”Χ•Χ¨Χ™Χ“ ΧΧ Χ”ΧΧ•Χ’Χ™Χ§Χ” Χ”Χ–ΧΧ, Χ Χ•Χ›Χ ΧΧ”Χ•Χ΅Χ™Χ£ ΧΧ ΧΧ™ΧΧ Χ”ΧΧ¤ΧΧ— ΧΧ™Χ“ Χ”Χ¦Χ”Χ¨Χ Χ”parallel for Χ©Χ Χ§Χ¨Χ nowait. Χ‘Χ¨Χ’ΧΆ Χ©ΧΧ•Χ΅Χ™Χ¤Χ™Χ ΧΧ Χ”ΧΧ™ΧΧ” Χ”Χ–Χ• ΧΧ– Χ”Χ§Χ•ΧΧ¤Χ™ΧΧ¨ ΧΧ Χ™Χ¦Χ™Χ‘ ΧΧ—Χ΅Χ•Χ Χ΅ΧΧ•Χ™ Χ”Χ™Χ›Χ Χ©Χ”Χ¦Χ”Χ¨Χ Χ• (ΧΧ Χ™Χ© ΧΆΧ•Χ“ Χ”Χ¦Χ”Χ¨Χ•Χ Χ‘Χ”ΧΧ©Χ ΧΧ– Χ©Χ ΧΧ Χ™Χ‘Χ•ΧΧ Χ”ΧΧ—Χ΅Χ•Χ).

![Pasted image 20240308214759.png|350](/img/user/Assets/Pasted%20image%2020240308214759.png)

### Reduction 
Χ Χ΅ΧΧ›Χ ΧΆΧ Χ”Χ§Χ•Χ“ Χ”Χ‘Χ
```C
#include <omp.h>
#include<stdio.h>

int main () { 
    int sum = 0;
    #pragma omp parallel 
    {
          #pragma omp for reduction (+:sum)
               for(int i=0; i<10; i++) {
                    sum += i;
                    printf("thread%d sum = %d\n", 
                              omp_get_thread_num(), sum);
               }
    }
    printf("sum = %d\n", sum);
    return 0;
}
```

Χ Χ Χ΅Χ” ΧΧ”Χ‘Χ™Χ ΧΧ” Χ§Χ•Χ¨Χ” Χ›ΧΧ ΧΆΧ Χ™Χ“Χ™ Χ”ΧΧ‘Χ•Χ Χ Χ•Χ Χ‘Χ”Χ“Χ¤Χ΅Χ•Χ 

![Pasted image 20240308215107.png|250](/img/user/Assets/Pasted%20image%2020240308215107.png)

* Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ Χ©Χ—ΧΧ§ ΧΧ”threads Χ§Χ™Χ‘ΧΧ• Χ™Χ•ΧΧ¨ ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ ΧΧΧ—Χ¨Χ™Χ.
* Χ”Χ—ΧΧ•Χ§Χ” Χ©Χ ΧΧ΅Χ¤Χ¨ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ ΧΧ›Χ threads Χ”Χ™Χ Χ—ΧΧ•Χ§Χ” _Χ΅ΧΧΧ™Χ_ Χ›ΧΧ•ΧΧ¨ Χ›Χ Χ”threads ΧΧ§Χ‘ΧΧ™Χ ΧΧ¨ΧΧ© Χ‘Χ–ΧΧ Χ§Χ™ΧΧ¤Χ•Χ ΧΧ ΧΧ΅Χ¤Χ¨ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ©Χ›Χ ΧΧ—Χ“ ΧΧ”Χ Χ™Χ¨Χ™Χ¥. Χ–Χ” ΧΧΧ‘Χ¦ΧΆ ΧΆΧ Χ™Χ“Χ™ Χ—ΧΧ•Χ§Χ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ chunks Χ•Χ›Χ thread ΧΧ§Χ‘Χ chunk ΧΧΧΧ™Χ.
* Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ Χ¨ΧΧ” ΧΧ”Χ”Χ“Χ¤Χ΅Χ•Χ Χ©ΧΧΧ¨Χ•Χ Χ©Χ”ΧΆΧ‘Χ¨Χ Χ• Χ pragma ΧΧ sum Χ›Χ¤Χ¨ΧΧΧ¨ Χ”Χ•Χ Χ©Χ›Χ¤Χ ΧΧ•ΧΧ• ΧΧ›Χ ΧΧ—Χ“ ΧΧ”threads Χ•Χ”Χ¤Χ ΧΧ•ΧΧ• ΧΧΧ©ΧΧ Χ” ΧΧ§Χ•ΧΧ™ ΧΆΧ‘Χ•Χ¨ Χ›Χ thread. Χ›ΧΧ•ΧΧ¨, Χ›Χ ΧΧ—Χ“ ΧΧ”Χ Χ—Χ™Χ©Χ‘ ΧΧ Χ”Χ΅Χ›Χ•Χ Χ”Χ—ΧΧ§Χ™ ΧΧ¤Χ™ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ©Χ”Χ•Χ Χ§Χ™Χ‘Χ.
* Χ¨Χ§ ΧΧ‘Χ΅Χ•Χ£ Χ›ΧΧ©Χ¨ Χ™Χ•Χ¦ΧΧ™Χ ΧΧ”Χ‘ΧΧ•Χ§ sum Χ”Χ—Χ™Χ¦Χ•Χ Χ™ Χ§Χ™Χ‘Χ ΧΧ Χ”ΧΆΧ¨Χ Χ”ΧΧΧ§Χ‘Χ ΧΧ—Χ™Χ‘Χ•Χ¨ Χ›Χ Χ”Χ΅Χ›Χ•ΧΧ™Χ Χ”Χ—ΧΧ§Χ™Χ™Χ.

_ΧΧ Χ›Χ, ΧΧ”Χ• Χ”Χ›ΧΧ™ reduction?_
Χ”Χ›ΧΧ™ Χ”Χ–Χ” ΧΧ§Χ‘Χ Χ–Χ•Χ’ Χ΅Χ“Χ•Χ¨ ΧΧ”Χ¦Χ•Χ¨Χ” $\text{(op:var)}$, Χ›Χ ΧΧ—Χ“ ΧΧ”threads ΧΧ§Χ‘Χ ΧΆΧ•ΧΧ§ Χ¤Χ¨ΧΧ™ Χ©Χ ΧΧ©ΧΧ Χ” var Χ©ΧΧΧ•ΧΧ—ΧΧ™Χ ΧΧ¤Χ™ Χ΅Χ•Χ’ Χ¤ΧΆΧ•ΧΧ” op. ΧΧΧ—Χ¨ ΧΧ›Χ Χ”Χ¤ΧΆΧ•ΧΧ” ΧΧΧ‘Χ¦ΧΆΧ Χ‘Χ›Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ” ΧΧ§Χ•ΧΧ™Χ ΧΆΧ‘Χ•Χ¨ Χ”thread. Χ‘Χ΅Χ•Χ£ Χ›Χ Χ”ΧΧ©ΧΧ Χ™Χ Χ”Χ¤Χ¨ΧΧ™Χ™Χ var ΧΧ΅ΧΧΧ›Χ™Χ ΧΆΧ Χ™Χ“Χ™ Χ”Χ¤ΧΆΧ•ΧΧ” op ΧΧΧ•Χ Χ”ΧΧ©ΧΧ Χ” Χ”ΧΧ©Χ•ΧΧ£.

ΧΧΧ” Χ”Χ Χ”Χ¤ΧΆΧ•ΧΧ•Χ Χ”ΧΧ¤Χ©Χ¨Χ™Χ•Χ Χ•ΧΆΧ¨Χ Χ”ΧΧΧ—Χ•Χ ΧΆΧ‘Χ•Χ¨Χ-

![Pasted image 20240308220232.png|200](/img/user/Assets/Pasted%20image%2020240308220232.png)

Χ Χ¨ΧΧ” Χ›ΧΆΧ Χ›Χ™Χ¦Χ“ ΧΧΧ§Χ‘Χ ΧΧ Χ§Χ•Χ“ Χ” Pi Approximation ΧΧΧ§Χ•Χ“Χ Χ‘ΧΧΧ¦ΧΆΧ•Χ reduction 

![Pasted image 20240309003624.png](/img/user/Assets/Pasted%20image%2020240309003624.png)
Χ›ΧΆΧ Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ ΧΧ™Χ Χ‘ΧΧ™ΧΧ•Χ© ΧΧΧ•Χ“ Χ Χ§Χ™ Χ—Χ™Χ©Χ‘Χ Χ• ΧΧ Χ”Χ§Χ™Χ¨Χ•Χ‘ Χ©Χ $\pi$ Χ‘Χ Χ™Χ’Χ•Χ“ ΧΧ§Χ•Χ“ Χ”Χ§Χ•Χ“Χ Χ©Χ”Χ™Χ” ΧΧΧ•Χ“ ΧΧ΅Χ•Χ¨Χ‘Χ Χ•ΧΧ Χ Χ§Χ™.

__Reduction with Arrays:__
![Pasted image 20240309003806.png](/img/user/Assets/Pasted%20image%2020240309003806.png)
Χ Χ™ΧΧ ΧΧ‘Χ¦ΧΆ reductio Χ’Χ ΧΆΧ ΧΧΆΧ¨Χ›Χ™Χ Χ•ΧΧ™Χ™Χ¦Χ¨ Χ©Χ›Χ¤Χ•Χ Χ©ΧΧ”Χ ΧΧ›Χ thread. 
## Schedule 
Χ Χ΅ΧΧ›Χ ΧΆΧ Χ§ΧΧΆ Χ”Χ§Χ•Χ“ Χ”Χ‘Χ
![Pasted image 20240308222126.png](/img/user/Assets/Pasted%20image%2020240308222126.png)
Χ”ΧΧ•ΧΧΧ” Χ”Χ—Χ™Χ¦Χ•Χ Χ™Χ ΧΧΧ—ΧΧ§Χ Χ©Χ•Χ•Χ” (Χ‘Χ™Χ—Χ΅ ΧΧΧ΅Χ¤Χ¨ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ) Χ‘Χ™Χ ΧΧ¨Χ‘ΧΆΧ Χ”threads Χ©Χ Χ•Χ¦Χ¨Χ•. 

Χ”ΧΧ•ΧΧΧ” Χ”Χ¤Χ Χ™ΧΧ™Χ Χ”Χ™Χ ΧΧ§Χ•ΧΧ™Χ ΧΧ›Χ threads Χ›Χ¤Χ™ Χ©ΧΧΧ¨Χ Χ•.
Χ Χ©Χ™Χ ΧΧ‘ Χ©ΧΧ•ΧΧ Χ Χ”Χ—ΧΧ•Χ§Χ” Χ©Χ ΧΧ΅Χ¤Χ¨ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ©Χ•Χ•Χ”, ΧΧ‘Χ Χ›Χ ΧΧ—Χ“ ΧΧ”threads ΧΧ¨Χ™Χ¥ ΧΧ¨Χ™Χ¥ ΧΆΧ ΧΆΧ¨Χ›Χ™ i Χ©Χ•Χ Χ™Χ. ΧΧ›Χ ΧΧ”Χ™Χ” Χ¤Χ” Χ‘ΧΆΧ™Χ” Χ©threads Χ©ΧΧ§Χ‘ΧΧ™Χ ΧΧ 3 Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ”Χ’Χ‘Χ•Χ”Χ•Χ Χ™Χ•ΧΧ¨ Χ™Χ‘Χ¦ΧΆΧ• Χ™Χ•ΧΧ¨ Χ¤ΧΆΧ•ΧΧ•Χ Χ—Χ™Χ©Χ•Χ‘Χ™Χ•Χ ΧΧΧ•Χ¤Χ™ Χ”Χ’Χ“Χ¨Χ Χ”ΧΧ•ΧΧΧ” Χ”Χ¤Χ Χ™ΧΧ™Χ.

![Pasted image 20240308222745.png](/img/user/Assets/Pasted%20image%2020240308222745.png)
Χ”Χ”Χ™Χ’Χ™Χ•Χ Χ©Χ Χ”ΧΧ•ΧΧΧ” Χ”Χ–ΧΧ Χ¤Χ’ΧΆ Χ‘ load balance Χ©Χ›Χ Χ”ΧΆΧ‘Χ•Χ“Χ” ΧΧ ΧΧΧ—ΧΧ§Χ Χ©Χ•Χ•Χ” Χ‘Χ©Χ•Χ•Χ”. 
### Static Scheduling
Χ›Χ“Χ™ ΧΧΧ¤Χ Χ‘Χ–Χ” Χ Χ©ΧΧΧ© Χ‘key work Χ©Χ Χ§Χ¨Χ schedule. Χ”ΧΧ™ΧΧ” Χ”Χ©ΧΧ•Χ¨Χ” Χ”Χ–Χ• ΧΧ§Χ‘Χ Χ›Χ¤Χ¨ΧΧΧ¨ ΧΧ ΧΧ•Χ¤Χ™ Χ”Χ”Χ§Χ¦ΧΧ” (static ΧΧ• dynamic Χ•Χ™Χ© Χ’Χ Χ Χ•Χ΅Χ¤Χ™Χ) Χ•Χ¤Χ¨ΧΧΧ¨ Χ Χ•Χ΅Χ£ Χ©Χ”Χ•Χ ΧΧ΅Χ¤Χ¨ Χ©Χ§Χ•Χ‘ΧΆ Χ΄Χ›ΧΧ” ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ Χ¨Χ¦Χ” ΧΧ”Χ§Χ¦Χ•Χ ΧΧ›Χ thread ΧΆΧ‘Χ•Χ¨ Χ¨Χ™Χ¦Χ” ΧΧ—Χ ΧΧ¤Χ Χ™ Χ©Χ”Χ•Χ Χ΄ΧΧ—ΧΧ™Χ£Χ΄ Χthread Χ”Χ‘Χ. 
![Pasted image 20240308223157.png](/img/user/Assets/Pasted%20image%2020240308223157.png)
Χ›ΧΧ©Χ¨ Χ Χ©Χ™Χ 1 Χ‘Χ§Χ•Χ“ Χ”Χ Χ΄Χ Χ Χ§Χ‘Χ Χ”ΧΧ Χ”Χ’Χ•Χ Χ©ΧΧ–Χ›Χ™Χ¨Χ” [[Computer Science/Operating Systems/CPU Scheduling\|Round Robin]], Χ›Χ thread Χ™Χ¨Χ•Χ¥ ΧΧ™ΧΧ¨Χ¦Χ™Χ” ΧΧ—Χ Χ•ΧΧ– Χ”thread Χ”Χ‘Χ Χ™Χ¨Χ™Χ¥ ΧΧ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ” Χ”Χ‘ΧΧ” Χ‘ΧΧ•Χ¨ Χ•Χ›Χ Χ”ΧΧΧ”. 

![Pasted image 20240308223446.png](/img/user/Assets/Pasted%20image%2020240308223446.png)

ΧΧ Χ”Χ™Χ™Χ Χ• ΧΧ’Χ“Χ™ΧΧ™Χ ΧΧ Χ”Χ¤Χ¨ΧΧΧ¨ Χ 1 Χ 2 Χ”Χ™Χ™Χ Χ• ΧΧ§Χ‘ΧΧ™Χ load balance Χ¤Χ—Χ•Χ ΧΧ•Χ‘:

![Pasted image 20240308224048.png](/img/user/Assets/Pasted%20image%2020240308224048.png)

ΧΧ™Χ Χ‘ΧΧΧ ΧΧ©Χ•Χ‘Χ” Χ Χ›Χ•Χ Χ” ΧΧ§Χ‘Χ™ΧΆΧ Χ’Χ•Χ“Χ chunk ΧΧΧΧ™Χ ΧΧ Χ—Χ©Χ•Χ‘ ΧΧ¦Χ™Χ™Χ Χ©Χ©Χ™ΧΧ•Χ© Χ‘ static scheduling Χ”Χ•Χ ΧΧΧ•Χ“ Χ™ΧΆΧ™Χ Χ›Χ™ ΧΧ™Χ Χ¦Χ•Χ¨Χ Χ‘Χ›ΧΧ ΧΧΧ§Χ©Χ•Χ¨Χ Χ‘Χ™Χ Χ”threads Χ©Χ›Χ Χ‘Χ–ΧΧ Χ”Χ¨Χ™Χ¦Χ” Χ›Χ ΧΧ—Χ“ Χ™Χ•Χ“ΧΆ Χ‘Χ™Χ“Χ™Χ•Χ§ ΧΧ” ΧΆΧΧ™Χ• ΧΧ”Χ¨Χ™Χ¥ Χ•Χ›ΧΧ” ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ.

>[!caution] 
>Χ—ΧΧ•Χ§Χ” Χ΅ΧΧΧ™Χ Χ™Χ›Χ•ΧΧ” ΧΧ”Χ™Χ•Χ ΧΧ ΧΧ•Χ¦ΧΧ—Χ Χ›ΧΧ©Χ¨ ΧΧ Χ Χ™ΧΧ ΧΧ“ΧΆΧ ΧΧ¨ΧΧ© Χ›ΧΧ” Χ—Χ™Χ©Χ•Χ‘Χ™Χ Χ™Χ© Χ‘Χ›Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ” ΧΧΧ©Χ ΧΧ Χ‘Χ§Χ•Χ“ ΧΧΧΆΧΧ” Χ”Χ™Χ™Χ Χ• ΧΧ’Χ“Χ™Χ¨Χ™Χ Χ‘ΧΧ§Χ•Χ ΧΧ¨Χ•Χ¥ ΧΆΧ“ i ΧΧ¨Χ•Χ¥ ΧΆΧ“ rand Χ”Χ™Χ™Χ Χ• Χ™Χ›Χ•ΧΧ™Χ ΧΧ§Χ‘Χ Χ—ΧΧ•Χ§Χ” ΧΧ Χ©Χ™Χ•Χ•Χ™Χ•Χ Χ™Χ Χ©Χ¤Χ•Χ’ΧΆΧ Χ‘ balance.
>![Pasted image 20240308224623.png](/img/user/Assets/Pasted%20image%2020240308224623.png)
### Dynamic Scheduling
ΧΧΧ§Χ¨Χ™Χ Χ›ΧΧ• Χ”Χ Χ΄Χ Χ Χ™ΧΧ ΧΧ”Χ’Χ“Χ™Χ¨ Χ’Χ Χ©Χ”Χ—ΧΧ•Χ§Χ” ΧΧ”Χ™Χ” dynamic.
Χ‘ΧΧ¦Χ‘ Χ–Χ” Χ›Χ thread ΧΧ§Χ‘Χ chunk Χ©Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ ΧΧ¤Χ™ Χ”Χ¤Χ¨ΧΧΧ¨ Χ©Χ”Χ’Χ“Χ¨Χ Χ• Χ•ΧΧ΅Χ¤Χ¨ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ‘ΧΧ•ΧΧΧ” Χ”Χ—Χ™Χ¦Χ•Χ Χ™Χ Χ•ΧΧ‘Χ¦ΧΆ ΧΧ•ΧΧ ΧΧ‘Χ Χ”Χ•Χ ΧΧ—ΧΧ§ ΧΧ Χ”ΧΆΧ‘Χ•Χ“Χ” Χ‘Χ¦Χ•Χ¨Χ” Χ“Χ™Χ ΧΧ™Χ Χ‘ΧΧ™ Χ‘Χ”Χ›Χ¨Χ— Χ΅Χ“Χ¨ Χ΅Χ¤Χ¦Χ™Χ¤Χ™ ΧΧΧ ΧΆΧ ΧΧΧ’Χ•Χ¨Χ™ΧΧ Χ©ΧΧ–Χ›Χ™Χ¨ [[Computer Science/Programming Concepts/Concurrency Programming/Thread Pool\|Thread Pool]]. 

```C
int main()
{
#pragma omp parallel for schedule(dynamic, 1) 
for (int i = 0; i < 20; i++)
	{
		printf("Thread %d is running number %d\n",omp_get_thread_num(),i);
	}
	return 0;
}
```

Χ”Χ¤ΧΧ Χ™Χ”Χ™Χ” :

```CLI
Thread 1 is running number 2
Thread 1 is running number 7
Thread 1 is running number 9
Thread 1 is running number 10
Thread 1 is running number 11
Thread 1 is running number 13
Thread 1 is running number 14
Thread 1 is running number 15
Thread 1 is running number 17
Thread 1 is running number 19
Thread 3 is running number 0
Thread 0 is running number 4
Thread 8 is running number 12
Thread 4 is running number 3
Thread 6 is running number 6
Thread 9 is running number 16
Thread 5 is running number 1
Thread 7 is running number 8
Thread 10 is running number 18
Thread 2 is running number 5
```

Χ—Χ©Χ•Χ‘ ΧΧ¦Χ™Χ™Χ Χ©Χ”Χ”Χ§Χ¦ΧΧ” Χ”Χ™Χ [[Computer Science/Algorithms/greedy algorithms\|Χ—ΧΧ“Χ Χ™Χ]] Χ‘Χ©Χ™ΧΧ” Χ©ΧΧ¤Χ™Χ” ΧΆΧ•Χ‘Χ“ Χ”ΧΧ–ΧΧ•Χ Χ”Χ“Χ™Χ ΧΧ™ Χ”Χ•Χ First Come First Serve Χ›ΧΧ•ΧΧ¨, ΧΧ Χ™Χ©Χ Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ©Χ¦Χ¨Χ™Χ ΧΧ‘Χ¦ΧΆ Χ•Χ™Χ© thread Χ¤Χ Χ•Χ™ Χ©Χ™Χ›Χ•Χ ΧΧ§Χ—Χ ΧΧ•ΧΧ, Χ”Χ•Χ Χ™Χ™Χ§Χ— ΧΧ•ΧΧ.

Χ›ΧΧ• Χ›Χ, Χ”ΧΧ–ΧΧ•Χ Χ”Χ“Χ™Χ ΧΧ™ Χ‘ΧΧ•Χ¤Χ Χ“Χ™ ΧΧ™Χ ΧΧ•ΧΧ™ΧΧ™Χ‘Χ™, Χ”Χ¨Χ‘Χ” Χ™Χ•ΧΧ¨ Χ™Χ§Χ¨ ΧΧ”Χ΅ΧΧΧ™ Χ›Χ™ Χ Χ“Χ¨Χ© ΧΧ§Χ©Χ•Χ¨Χ Χ‘Χ™Χ Χ” threads ΧΧΧ—Χ¨ Χ›Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ”, Χ›ΧΧ• Χ›Χ ΧΧΆΧ™ΧΧ™Χ Χ¦Χ¨Χ™Χ ΧΧ”Χ’Χ“Χ™Χ¨ ΧΧ Χ”chunk size Χ©Χ thread Χ›ΧΧ©Χ”Χ• Χ•Χ’Χ Χ‘Χ’ΧΧ Χ©Χ”ΧΧ–ΧΧ•Χ Χ”Χ•Χ ΧΧΆΧ™Χ Χ§Χ•Χ¤Χ΅Χ Χ©Χ—Χ•Χ¨Χ” Χ©Χ Χ”Χ΅Χ¤Χ¨Χ™Χ™Χ” ΧΧ Χ‘Χ”Χ›Χ¨Χ— Χ©Χ Χ§Χ‘Χ ΧΧ–ΧΧ•Χ Χ©ΧΧΧΧ™Χ ΧΧ Χ•.
## Shared/Private variables
Χ›ΧΧΧ•Χ¨ ΧΧ©ΧΧ Χ™Χ Χ”ΧΧ•Χ’Χ“Χ¨Χ™Χ ΧΧ—Χ•Χ¥ ΧΧ§ΧΧΆ Χ”ΧΧ§Χ‘Χ™ΧΧ™ Χ”Χ shared.
ΧΧ©ΧΧ Χ™Χ Χ”ΧΧ•Χ’Χ“Χ¨Χ™Χ Χ‘ΧΧ•Χ Χ§ΧΧΆ ΧΧ§Χ‘Χ™ΧΧ™ Χ”Χ private, Χ›ΧΧ•ΧΧ¨ Χ›Χ thread ΧΧ§Χ‘Χ ΧΆΧ•ΧΧ§ Χ©Χ ΧΧ©ΧΧ Χ™Χ ΧΧΧ•. 

![Pasted image 20240308230822.png|250](/img/user/Assets/Pasted%20image%2020240308230822.png)

Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ’Χ ΧΧ©ΧΧ Χ™Χ Χ΅ΧΧΧ™Χ™Χ Χ‘ΧΧ•Χ Χ‘ΧΧ•Χ§ ΧΧ§Χ‘Χ™ΧΧ™, Χ”Χ shared.

Χ Χ™ΧΧ ΧΧ©Χ Χ•Χ ΧΧ Χ Χ¨ΧΧ•Χ Χ‘Χ¨Χ™Χ¨Χ ΧΧ—Χ“Χ Χ©Χ Χ”ΧΧ©ΧΧ Χ™Χ:
![Pasted image 20240308231021.png](/img/user/Assets/Pasted%20image%2020240308231021.png)
i Χ”Χ•Χ¤Χ ΧΧ•ΧΧ•ΧΧΧ™ ΧΧΧ©ΧΧ Χ” Χ¤Χ¨ΧΧ™ Χ‘Χ¨Χ’ΧΆ Χ©Χ©ΧΧ™Χ ΧΧ•ΧΧ• Χ‘ΧΧ•Χ parallel for Χ• j Χ”Χ¤Χ ΧΧ¤Χ¨ΧΧ™ Χ‘Χ’ΧΧ Χ©Χ”Χ©ΧΧΧ©Χ Χ• Χ‘Χ”Χ’Χ“Χ¨Χ” private(j). 

Χ”Χ΅Χ™Χ‘Χ” Χ©Χ”Χ’Χ“Χ¨Χ Χ• ΧΧ Χ”ΧΧΆΧ¨Χ›Χ™Χ Χ›static Χ›Χ“Χ™ Χ©Χ”Χ Χ™Χ©Χ‘Χ• Χ‘ global data segment Χ•ΧΧ Χ‘stack Χ•Χ›Χ Χ ΧΧ ΧΆ Χ seg fault (ΧΧΆΧ¨Χ›Χ Χ”Χ”Χ¤ΧΆΧΧ” ΧΧ’Χ“Χ™Χ¨Χ” Χ stack Χ’Χ•Χ“Χ Χ§Χ‘Χ•ΧΆ Χ•ΧΧ¤ΧΆΧΧ™Χ Χ”Χ™Χ ΧΧ ΧΧ§Χ¦Χ” ΧΆΧ•Χ“ ΧΆΧ‘Χ•Χ¨ Χ”stack , Χ Χ™ΧΧ ΧΧ‘Χ“Χ•Χ§ ΧΧ Χ’Χ•Χ“Χ Χ”stack Χ”Χ§Χ‘Χ•ΧΆ __ΧΧ›Χ ΧΧ•Χ›Χ Χ™Χ__ ΧΆΧ Χ™Χ“Χ™ Χ”Χ¨Χ¦Χ Χ”ΧΧ•Χ›Χ Χ™Χ ulimit -s).

![Screenshot 2024-03-08 at 23.17.22.png](/img/user/Assets/Screenshot%202024-03-08%20at%2023.17.22.png)

__Χ Χ©Χ™Χ ΧΧ‘:__ Χ”Χ”Χ¦Χ”Χ¨Χ” private ΧΧ™Χ™Χ¦Χ¨Χ ΧΆΧ•ΧΧ§ Χ©Χ Χ”ΧΧ©ΧΧ Χ” Χ•ΧΧ›Χ Χ Χ•Χ¦Χ¨ ΧΆΧ•ΧΧ§ Χ©Χ Χ”ΧΧ©ΧΧ Χ” Χ‘ΧΧ•Χ Χ”threads, Χ”ΧΆΧ¨Χ Χ©Χ Χ”ΧΆΧ•ΧΧ§Χ™Χ ΧΧ Χ‘Χ ΧΧ™Χ“Χ™ Χ‘Χ™ΧΧ•Χ™ Χ‘ΧΧ©ΧΧ Χ” Χ”ΧΧ§Χ•Χ¨Χ™ Χ›ΧΧ•ΧΧ¨ Χ›Χ Χ©Χ™Χ Χ•Χ™ Χ‘ΧΧ•Χ Χ”Χ§Χ•Χ“ Χ”ΧΧ§Χ‘Χ™ΧΧ™ ΧΧ ΧΧ©Χ¤Χ™ΧΆ ΧΆΧ Χ”ΧΧ©ΧΧ Χ” Χ”ΧΧ§Χ•Χ¨Χ™. Χ›ΧΧ• Χ›Χ ΧΧ™Χ Χ”Χ‘ΧΧ—Χ” Χ©Χ’Χ Χ”ΧΆΧ¨Χ Χ©Χ Χ”ΧΧ©ΧΧ Χ” Χ”ΧΧ§Χ•Χ¨Χ™ Χ™ΧΆΧ‘Χ•Χ¨ ΧΧΆΧ•ΧΧ§ ΧΧΧ©Χ:

![Pasted image 20240309005307.png](/img/user/Assets/Pasted%20image%2020240309005307.png)
ΧΧ•ΧΧ Χ Χ”ΧΆΧ¨Χ Χ”Χ™Χ” 1, ΧΧ‘Χ Χ›Χ ΧΧ—Χ“ ΧΧ”threads Χ§Χ™Χ‘Χ ΧΆΧ¨Χ Χ”ΧΧ—ΧΧΧ™ Χ©Χ 0 ΧΆΧ‘Χ•Χ¨ Χ”ΧΆΧ•ΧΧ§ Χ©Χ sum.

ΧΧ¤Χ©Χ¨ ΧΧ”Χ’Χ“Χ™Χ¨ ΧΧ©ΧΧ Χ” ΧΧ”Χ™Χ•Χ private Χ¨Χ§ ΧΧ—ΧΧ§ ΧΧ΅Χ•Χ™Χ™Χ ΧΧΧ•Χ Χ”Χ§Χ•Χ“ Χ”ΧΧ§Χ‘Χ™ΧΧ™. 
![Pasted image 20240309005450.png](/img/user/Assets/Pasted%20image%2020240309005450.png)

Χ‘ΧΧ§Χ¨Χ” Χ”Χ–Χ” Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ ΧΧ™Χ ΧΧΧ—Χ¨ Χ”Χ™Χ¦Χ™ΧΧ” ΧΧ”ΧΧ•ΧΧΧ” sum Χ Χ©ΧΧ¨ ΧΆΧ ΧΆΧ¨Χ 1.

* ΧΧ ΧΧ›Χ Χ—Χ©Χ•Χ‘ ΧΧ Χ• ΧΧ©ΧΧ•Χ¨ ΧΆΧ ΧΆΧ¨Χ Χ”ΧΧΧ—Χ•Χ Χ”ΧΧ§Χ•Χ¨Χ™ Χ©Χ Χ”ΧΧ©ΧΧ Χ”, Χ‘ΧΧ§Χ•Χ ΧΧ”Χ©ΧΧΧ© Χ‘Χ”Χ¦Χ”Χ¨Χ private , Χ Χ©ΧΧΧ© Χ‘Χ”Χ¦Χ”Χ¨Χ” firstprivate

![Pasted image 20240309005812.png](/img/user/Assets/Pasted%20image%2020240309005812.png)

* ΧΧ Χ Χ¨Χ¦Χ” Χ©Χ”sum Χ”Χ—Χ™Χ¦Χ•Χ Χ™ Χ™Χ§Χ‘Χ ΧΧ Χ”ΧΆΧ¨Χ Χ”Χ΅Χ•Χ¤Χ™ Χ©Χ§Χ™Χ‘Χ ΧΧ©ΧΧ Χ” Χ‘ΧΧ™ΧΧ¨Χ¦Χ™Χ” Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ __Χ”ΧΧ—Χ¨Χ•Χ Χ”__ Χ Χ©ΧΧΧ© Χ‘ΧΧ™ΧΧ Χ”ΧΧ¤ΧΧ— lastprivate.

![Pasted image 20240309005924.png](/img/user/Assets/Pasted%20image%2020240309005924.png)

__ΧΧ” Χ”ΧΆΧ¨Χ Χ©Χ™Χ•Χ“Χ¤Χ΅ Χ›ΧΧ?__
![Pasted image 20240309005949.png](/img/user/Assets/Pasted%20image%2020240309005949.png)
Χ”firstprivate ΧΧ•ΧΧ¨ Χ©Χ›Χ Χ”threads Χ™Χ§Χ‘ΧΧ• ΧΧ Χ”ΧΆΧ¨Χ Χ”Χ”ΧΧ—ΧΧΧ™ Χ‘ΧΆΧ•ΧΧ§ Χ©ΧΧ”Χ, Χ©Χ”Χ•Χ 0. Χ”lastprivate ΧΧ•ΧΧ¨ Χ©Χ Χ©Χ™Χ Χ‘sum Χ”Χ—Χ™Χ¦Χ•Χ Χ™ ΧΧ Χ”ΧΆΧ¨Χ Χ©Χ§Χ™Χ‘Χ Χ”Χ΅Χ›Χ•Χ Χ”Χ—ΧΧ§Χ™ Χ©Χ Χ”thread Χ”ΧΧ—Χ¨Χ•Χ. Χ›Χ™Χ•Χ•Χ Χ©Χ‘Χ“Χ™Χ¤Χ•ΧΧ ΧΧ“Χ•Χ‘Χ¨ Χ‘Χ Χ™Χ”Χ•Χ Χ΅ΧΧΧ™ ΧΧ‘Χ Χ”Χ—ΧΧ•Χ§Χ” Χ›ΧΧ ΧΧ Χ©Χ•Χ•Χ” (Χ™Χ© 9 ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ ΧΆΧ 4 threads) ΧΧ Χ Χ™ΧΧ ΧΧ—Χ–Χ•Χ ΧΧ Χ”ΧΧ•Χ¦ΧΧ” ΧΧ¨ΧΧ©. Χ Χ Χ™Χ— Χ© thread0 Χ™Χ§Χ‘Χ ΧΧ 3 Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ”Χ¨ΧΧ©Χ•Χ Χ•Χ Χ•Χ Χ‘Χ—Χ ΧΧ Χ”Χ”Χ“Χ¤Χ΅Χ•Χ

![Pasted image 20240309011145.png|200](/img/user/Assets/Pasted%20image%2020240309011145.png)

Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ Χ©Χ›Χ™Χ•Χ•Χ Χ© ID3 Χ§Χ™Χ‘Χ Χ¨Χ§ ΧΧ 2 Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ”ΧΧ—Χ¨Χ•Χ Χ•Χ ΧΧ– Χ”Χ•Χ Χ™Χ΅Χ›Χ•Χ ΧΧ Χ”Χ΅Χ›Χ•Χ Χ”Χ—ΧΧ§Χ™ Χ© i=8,9 Χ•ΧΧ›Χ Χ”Χ¤ΧΧ Χ™Χ”Χ™Χ” 17.
### default 
Χ”Χ¨Χ’Χ ΧΧ•ΧΧΧ¥ Χ”Χ•Χ ΧΧ”Χ©ΧΧΧ© Χ‘ΧΧ™ΧΧ Χ”ΧΧ¤ΧΧ— default(none) Χ›Χ“Χ™ ΧΧ§Χ‘Χ Χ‘Χ“Χ™Χ§Χ Χ§Χ•ΧΧ¤Χ™ΧΧ¦Χ™Χ” Χ©ΧΧ›Χ¨Χ™Χ—Χ” ΧΧ•ΧΧ Χ• ΧΧ¨Χ©Χ•Χ ΧΆΧ‘Χ•Χ¨ Χ›Χ ΧΧ©ΧΧ Χ”, ΧΧ”Χ™ Χ¨ΧΧ Χ”Χ©Χ™ΧΧ•Χ£ Χ©ΧΧ•. Χ’Χ•Χ¨Χ ΧΧ§Χ•Χ“ ΧΧ”Χ™Χ•Χ ΧΧ•Χ‘Χ Χ™Χ•ΧΧ¨. 

![Pasted image 20240309011436.png](/img/user/Assets/Pasted%20image%2020240309011436.png)

## Algorithms with OpenMP
### Χ—Χ™Χ©Χ•Χ‘ ΧΧ΅Χ¤Χ¨Χ™Χ Χ¨ΧΧ©Χ•Χ Χ™Χ™Χ
Χ§ΧΧ: ΧΧ΅Χ¤Χ¨ ΧΧ‘ΧΆΧ™ n
Χ¤ΧΧ: Χ›Χ Χ”ΧΧ΅Χ¤Χ¨Χ™Χ Χ”Χ¨ΧΧ©Χ•Χ Χ™Χ™Χ Χ 1 ΧΆΧ“ Χ n.
```C
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

void calcPrimes(int n) {
    bool *prime = (bool *)malloc((n + 1) * sizeof(bool));
    if (prime == NULL) {
        printf("Memory allocation failed.\n");
        return;
    }

    // Initialize all elements of prime[] as true
    #pragma omp parallel for 
    for (int i = 0; i <= n; i++)
        prime[i] = true;

    // Mark non-prime numbers
    #pragma omp parallel for schedule(dynamic, 1)
    for (int p = 2; p * p <= n; p++) { 
            for(int d = 2; d<p && prime[p]; d++)
                 if(p % d == 0)
                     prime[p] = false;
    }

    // Print prime numbers
    printf("Prime numbers in the range 2 to %d are:\n", n);
    for (int p = 2; p <= n; p++) {
        if (prime[p])
            printf("%d ", p);
    }
    printf("\n");

    free(prime);
}
```

1) Χ”ΧΧ•ΧΧΧ” Χ©ΧΧ‘Χ¦ΧΆΧ™Χ ΧΧΧ—Χ•Χ ΧΧΧΆΧ¨Χ Χ” prime ΧΧ”Χ™Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ
2) Χ”ΧΧ•ΧΧΧ” Χ”Χ›Χ¤Χ•ΧΧ” Χ©Χ¨Χ¦Χ” ΧΆΧ“ Χ”Χ©Χ•Χ¨Χ© Χ©Χ n Χ‘ΧΧ•ΧΧΧ” Χ”Χ—Χ™Χ¦Χ•Χ Χ™Χ Χ•Χ‘ΧΧ•ΧΧΧ” Χ”Χ¤Χ Χ™ΧΧ™Χ Χ¨Χ¦Χ™Χ ΧΆΧ Χ›Χ Χ”ΧΧ΅Χ¤Χ¨Χ™Χ ΧΆΧ“ Χ p Χ›ΧΧ©Χ¨ Χ”ΧΧΆΧ¨Χ Χ‘ΧΧ™Χ§Χ•Χ Χ” p Χ”Χ•Χ true Χ•Χ‘Χ•Χ“Χ§Χ™Χ Χ”ΧΧ p ΧΧΧ—ΧΧ§ Χ‘ d Χ•ΧΧ Χ›Χ ΧΧ©Χ Χ™Χ ΧΧ Χ”ΧΆΧ¨Χ Χ©Χ p Χ‘ΧΧΆΧ¨Χ Χ”Χ¨ΧΧ©Χ•Χ Χ™Χ™Χ ΧΧ”Χ™Χ•Χ false. ΧΧ Χ”ΧΧ•ΧΧΧ” Χ”Χ–ΧΧ Χ ΧΆΧ©Χ” Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ ΧΆΧ ΧΧ–ΧΧ•Χ Χ“Χ™Χ ΧΧ™. Χ”Χ΅Χ™Χ‘Χ” Χ©ΧΧ Χ”Χ©ΧΧΧ©Χ Χ• Χ‘ collapse Χ”Χ™Χ Χ‘Χ’ΧΧ Χ©Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ Χ©Χ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ” Χ”Χ¤Χ Χ™ΧΧ™Χ ΧΆΧΧ•Χ ΧΧ™Χ¦Χ•Χ¨ Χ¨Χ™Χ¦Χ•Χ Χ›Χ¤Χ™ΧΧ•Χ Χ›Χ™Χ•Χ•Χ Χ©Χ›Χ thread Χ‘Χ•Χ“Χ§ ΧΧ Χ”ΧΧΆΧ¨Χ Χ”Χ’ΧΧ•Χ‘ΧΧ™ Χ©Χ Χ”ΧΧ΅Χ¤Χ¨Χ™Χ Χ”Χ¨ΧΧ©Χ•Χ Χ™Χ™Χ Χ•ΧΧ›Χ Χ©Χ Χ™ threads Χ™Χ›Χ•ΧΧ™Χ ΧΧ§Χ‘Χ ΧΧ΅Χ¤Χ¨Χ™Χ Χ©Χ›Χ ΧΧ”Χ ΧΧ©Χ Χ” ΧΧ Χ”ΧΧΆΧ¨Χ prime Χ‘ΧΧ•ΧΧ• Χ”ΧΧ™Χ§Χ•Χ ΧΧ‘Χ Χ©Χ Χ™Χ”Χ Χ™Χ’Χ©Χ• ΧΧΆΧ¨Χ Χ”Χ–Χ” Χ‘Χ’ΧΧ Χ©Χ”Χ ΧΆΧ•Χ‘Χ“Χ™Χ Χ‘ΧΧ§Χ‘Χ™Χ Χ•ΧΧ ΧΧ΅Χ•Χ Χ›Χ¨Χ Χ™Χ.
3) Χ”Χ΅Χ™Χ‘Χ” ΧΧ©Χ™ΧΧ•Χ© Χ‘ dynamic Χ”Χ™Χ Χ©Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ”Χ¤Χ Χ™ΧΧ™Χ•Χ Χ”Χ ΧΧ Χ‘Χ’Χ•Χ“Χ Χ©Χ•Χ•Χ”, ΧΧ›Χ ΧΆΧ“Χ™Χ£ ΧΧ Χ• ΧΧΧ–ΧΧ ΧΧ¤Χ™ FCFS Χ•ΧΧΧ Χthreads Χ©ΧΧ΅Χ™Χ™ΧΧ™Χ Χ§Χ•Χ“Χ ΧΧ›Χ ΧΧ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ Χ”Χ§Χ¦Χ¨Χ•Χ Χ™Χ•ΧΧ¨ ΧΧ§Χ‘Χ ΧΆΧ‘Χ•Χ“Χ•Χ Χ—Χ“Χ©Χ•Χ.
4) ΧΧ™Χ Χ‘ΧΧΧ Χ΅Χ™Χ‘Χ” chunk size = 1 ΧΧ• ΧΧ©Χ™Χ ΧΧ΅Χ¤Χ¨ ΧΧ—Χ¨, Χ›Χ“Χ™ ΧΧ§Χ‘Χ•ΧΆ Χ‘Χ™Χ“Χ™Χ•Χ§ Χ¦Χ¨Χ™Χ ΧΧΆΧ©Χ•Χ Χ Χ™Χ΅Χ•Χ™ Χ•ΧΧ”Χ™Χ™Χ”.
### BFS 
Χ¨ΧΧ™Χ Χ• Χ›Χ‘Χ¨ Χ“Χ¨Χ ΧΧ—Χ©Χ‘ [[Computer Science/Algorithms/Parallel Algorithms/Parallel Graphs Algorithms#BFS\|bfs ΧΧ§Χ‘Χ™ΧΧ™]] ΧΆΧ pthreads. Χ›ΧΆΧ Χ Χ¨ΧΧ” Χ›Χ™Χ¦Χ“ Χ Χ™ΧΧ ΧΧ—Χ©Χ‘ ΧΧ Χ–Χ” Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ ΧΆΧ OpenMP.

```C
SEQUENTIAL_BFS(V, E, s)

   #pragma openmp parallel for
   for each π‘£βπ‘‰
         π‘π‘π‘™π‘π‘_π‘£β†π‘¤β„π‘–π‘΅π‘’
         π‘‘_π‘£β†β
         π‹_π‘£β†β…
   π‘π‘π‘™π‘π‘_π‘ β†π‘”π‘π‘’π‘¦
   π‘‘_π‘ β†0
   define queue π‘„β†{π‘ }

   while π‘„β‰ β…
          π‘£β†π‘„.π‘‘π‘’π‘π‘Άπ‘’π‘Άπ‘’( )
          π‘π‘π‘™π‘π‘_π‘£β†π‘π‘™π‘π‘π‘
          #pragma openmp parallel for
          for each π‘Ά adjacent to π‘£
                 if π‘π‘π‘™π‘π‘_π‘Ά is π‘¤β„π‘–π‘΅π‘’
                         #pragma omp critical
                                π‘„.π‘’π‘›π‘π‘Άπ‘’π‘Άπ‘’(π‘Ά)
                         π‘π‘π‘™π‘π‘_π‘Άβ†π‘”π‘π‘’π‘¦
                         π‹_π‘Άβ†π‘£
                         π‘‘_π‘Άβ†π‘‘_π‘£+1

```

* ΧΧ§Χ‘ΧΧ Χ• ΧΧ Χ”ΧΧΧ—Χ•Χ
* ΧΧ§Χ‘ΧΧ Χ• ΧΧ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ” ΧΆΧ Χ›Χ ΧΧ•ΧΧΧ” Χ©Χ¨Χ¦Χ” ΧΆΧ Χ”Χ©Χ›Χ Χ™Χ Χ©Χ Χ§Χ•Χ“Χ§Χ•Χ“ v Χ©Χ™Χ¦Χ ΧΧ”ΧΧ•Χ¨
* Χ”Χ’Χ“Χ¨Χ Χ• ΧΧ Χ”Χ”Χ©ΧΧ” ΧΧΧ•Χ Χ”ΧΧ•Χ¨ Χ›Χ§ΧΧΆ Χ§Χ•Χ“ Χ§Χ¨Χ™ΧΧ™.

Χ”Χ©Χ™ΧΧ” Χ”Χ–ΧΧ Χ”Χ™Χ Χ‘ΧΆΧ™Χ™ΧΧ™Χ Χ›Χ¤Χ™ Χ©ΧΧΧ¨Χ Χ• Χ™Χ© Χ¦Χ•Χ¨Χ ΧΧ”Χ’Χ“Χ™Χ¨ ΧΧ•Χ¨ ΧΧ›Χ Χ©Χ›Χ‘Χ” ΧΆΧ ΧΧ Χ ΧΧ”ΧΧ ΧΆ Χrace condition Χ©ΧΆΧΧ•Χ ΧΧ’Χ¨Χ•Χ ΧΧΧΧ’Χ•Χ¨Χ™ΧΧ ΧΧΧ¦Χ•Χ ΧΧ΅ΧΧ•Χ ΧΧ¨Χ•Χ Χ™Χ•ΧΧ¨ ΧΧ”ΧΧ΅ΧΧ•Χ Χ”Χ§Χ¦Χ¨ Χ‘Χ™Χ•ΧΧ¨ Χ΄Χ‘ΧΧΆΧ•ΧΧ΄.

Χ‘ OpenMP Χ Χ•Χ›Χ ΧΧ™Χ¦Χ•Χ¨ ΧΧ•Χ¨ ΧΧ›Χ Χ¨ΧΧ” ΧΆΧ Χ©Χ Χ™ ΧΧ•Χ¨Χ™Χ Χ‘ΧΧ‘Χ“. 
```C
SEQUENTIAL_BFS(V, E, s)

   #pragma openmp parallel for
   for each π‘£βπ‘‰
         π‘π‘π‘™π‘π‘_π‘£β†π‘¤β„π‘–π‘΅π‘’
         π‘‘_π‘£β†β
         π‹_π‘£β†β…
   π‘π‘π‘™π‘π‘_π‘ β†π‘”π‘π‘’π‘¦
   π‘‘_π‘ β†0
   define queue π‘„1β†{π‘ }
   define queue π‘„2β†{ }

   while π‘„1β‰ β…
      #pragma openmp parallel for
      for each v in Q1    
          π‘π‘π‘™π‘π‘_π‘£β†π‘π‘™π‘π‘π‘
          #pragma openmp parallel for
          for each π‘Ά adjacent to π‘£
                 if π‘π‘π‘™π‘π‘_π‘Ά is π‘¤β„π‘–π‘΅π‘’
                         #pragma omp critical
                                π‘„2.π‘’π‘›π‘π‘Άπ‘’π‘Άπ‘’(π‘Ά)
                         π‘π‘π‘™π‘π‘_π‘Άβ†π‘”π‘π‘’π‘¦
                         π‹_π‘Άβ†π‘£
                         π‘‘_π‘Άβ†π‘‘_π‘£+1
	    empty Q1
        swap Q1 and Q2
```

* Χ”Χ’Χ“Χ¨Χ Χ• Χ©Χ Χ™ ΧΧ•Χ¨Χ™Χ Χ›ΧΧ©Χ¨ Q2 ΧΧ•ΧΆΧ Χ›Χ Χ¤ΧΆΧ ΧΧ Χ”Χ§Χ•Χ“Χ§Χ•Χ“Χ™Χ Χ©Χ Χ”Χ¨ΧΧ” Χ”Χ‘ΧΧ” Χ•Χ΄ΧΧ–Χ™Χ ΧΧ•ΧΧΧ΄ Χ Q1. 
* Χ™Χ© Χ’Χ Χ©Χ Χ™ Χ΄Χ¨ΧΧ•ΧΧ΄ Χ©Χ ΧΧ™Χ§Χ‘Χ•Χ, Χ”Χ¨ΧΧ©Χ•Χ Χ” Χ”Χ™Χ Χ‘Χ¨Χ™Χ¦Χ” ΧΆΧ Χ›Χ Χ”Χ§Χ•Χ“Χ§Χ•Χ“Χ™Χ Χ‘Χ¨ΧΧ” Χ”Χ Χ•Χ›Χ—Χ™Χ Χ‘ Q1 Χ•Χ©Χ™Χ Χ•Χ™ Χ”Χ¦Χ‘ΧΆ ΧΧ©Χ—Χ•Χ¨, Χ”Χ¨ΧΧ” Χ”Χ©Χ Χ™Χ™Χ” Χ”Χ™Χ Χ‘ΧΧ•Χ¨ Χ”Χ¨ΧΧ” Χ”Χ§Χ•Χ“ΧΧ Χ©Χ‘Χ” Χ¨Χ¦Χ™Χ Χ‘ΧΧ§Χ‘Χ™Χ ΧΆΧ Χ›Χ u Χ©Χ›Χ Χ©Χ v Χ•ΧΧ–Χ™Χ Χ™Χ ΧΧ•ΧΧ• ΧQ2. 
* Χ Χ©Χ™Χ ΧΧ‘ Χ©ΧΧ Χ©Χ™Χ Χ™Χ Χ• ΧΧ Χ”end of loop barrier Χ©Χ›Χ Χ Χ¨Χ¦Χ” Χ©Χ›Χ Χ”threads Χ™Χ–Χ™Χ Χ• ΧΧ Χ”Χ©Χ›Χ Χ™Χ ΧΧΧ•Χ¨ Q2 ΧΧ¤Χ Χ™ Χ‘Χ™Χ¦Χ•ΧΆ Χ” swap.
* Χ›Χ Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ Χ¤Χ” Χ”Χ™Χ Χ΅ΧΧΧ™Χ Χ©Χ›Χ, ΧΧ™Χ Χ›ΧΧ Χ¦Χ•Χ¨Χ Χ‘ΧΧ–ΧΧ•Χ Χ“Χ™Χ ΧΧ™ Χ›ΧΧ.
#### Bottom-up BFS algorithm
Χ’Χ™Χ©Χ” Χ©Χ”Χ•Χ¦Χ’ Χ‘[Direction Optimizing BFS](https://parlab.eecs.berkeley.edu/sites/all/parlab/files/main.pdf) Χ”Χ¦Χ™Χ’Χ” Χ’Χ™Χ©Χ” Χ©ΧΧΧΧ™ΧΧ” Χ™Χ•ΧΧ¨ ΧΧΧ›Χ Χ•Χ ΧΧ§Χ‘Χ™ΧΧ™. Χ”Χ’Χ™Χ©Χ” Χ”Χ–ΧΧ ΧΧ•ΧΧ¨Χ Χ©Χ Χ—Χ–Χ™Χ§ ΧΧΆΧ¨Χ Χ©Χ frontier Χ•Χ‘Χ›Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ” bottom-up Χ‘ΧΧ§Χ•Χ ΧΧ¨Χ•Χ¥ ΧΆΧ Χ›Χ Χ”Χ©Χ›Χ Χ™Χ Χ©Χ Χ§Χ•Χ“Χ§Χ•Χ“ $v\in frontier$ , Χ Χ¨Χ•Χ¥ __ΧΆΧ Χ›Χ Χ”Χ§Χ•Χ“Χ§Χ•Χ“Χ™Χ__ Χ©ΧΧ Χ”Χ•Χ’Χ“Χ¨ ΧΧ”Χ parent Χ‘Χ¨Χ’ΧΆ Χ©ΧΧ¦ΧΧ Χ• Χ›Χ–Χ” Χ¨Χ¦Χ™Χ ΧΆΧ Χ›Χ Χ”Χ©Χ›Χ Χ™Χ Χ©ΧΧ• Χ©Χ ΧΧ¦ΧΧ™Χ Χ‘frontier Χ•ΧΧ‘Χ¦ΧΆΧ™Χ ΧΆΧΧ™Χ”Χ BFS. Χ‘ΧΧ™ΧΧ™Χ ΧΧ—Χ¨Χ•Χ, Χ Χ‘Χ“Χ•Χ§ ΧΆΧ‘Χ•Χ¨ Χ›Χ Χ”Χ§Χ•Χ“Χ§Χ•Χ“Χ™Χ Χ”ΧΧ Χ™Χ© ΧΧ”Χ Χ©Χ›Χ Χ©Χ”Χ•Χ Χ‘Χ¨ΧΧ” Χ”Χ Χ•Χ›Χ—Χ™Χ Χ©Χ¦Χ¨Χ™Χ ΧΧ΅Χ¨Χ•Χ§. 

Χ”Χ΅Χ™Χ‘Χ” Χ©Χ‘Χ¦Χ•Χ¨Χ” Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ Χ”Χ©Χ™ΧΧ” Χ”Χ–ΧΧ Χ™Χ•ΧΧ¨ Χ™ΧΆΧ™ΧΧ” Χ”Χ™Χ Χ‘Χ’ΧΧ Χ©ΧΧ Χ—Χ Χ• ΧΧ•Χ ΧΆΧ™Χ Race conditions Χ¨Χ‘Χ™Χ ΧΧΧ•Χ¨ Χ”ΧΆΧ•Χ‘Χ“Χ” Χ©Χ›Χ thread Χ Χ™Χ’Χ© ΧΧΧΆΧ¨Χ parent Χ‘ΧΧ™Χ Χ“Χ§Χ΅ Χ©ΧΧ–Χ•Χ”Χ” ΧΆΧ Χ”Χ§Χ•Χ“Χ§Χ•Χ“ Χ©ΧΆΧΧ™Χ• Χ”Χ•Χ ΧΆΧ•ΧΧ“. Χ Χ•Χ›Χ Χ’Χ ΧΧ”ΧΧ ΧΆ ΧΧ΅Χ Χ›Χ•Χ Χ©Χ Χ§Χ‘Χ•Χ¦Χ Χ” next Χ Χ•Χ›Χ ΧΧΧΧ© ΧΧ Χ–Χ” Χ‘ΧΧΧ¦ΧΆΧ•Χ ΧΧΆΧ¨Χ ΧΆΧ•ΧΧ§Χ™Χ Χ•Χ›Χ›Χ” Χ›Χ thread Χ Χ™Χ’Χ© Χ¨Χ§ ΧΧ›ΧΧ•Χ‘Χ Χ”ΧΧΧΧ™ΧΧ” ΧΧ§Χ“Χ•Χ§Χ•Χ“ Χ”ΧΧΧΧ™Χ ΧΆΧ‘Χ•Χ¨Χ•.

Χ”ΧΧΧ’Χ•Χ¨Χ™ΧΧ bottom-up Χ‘Χ¦Χ•Χ¨Χ” Χ΅Χ“Χ¨ΧΧ™Χ Χ”Χ¨Χ‘Χ” Χ¤Χ—Χ•Χ ΧΧ•Χ‘ ΧΧ”Χ’Χ™Χ©Χ” Χ”Χ¨Χ’Χ™ΧΧ” Χ©ΧΧ Χ—Χ Χ• ΧΧ›Χ™Χ¨Χ™Χ. 
Χ”ΧΧ™ΧΧ•Χ© Χ”Χ΅Χ“Χ¨ΧΧ™ Χ Χ¨ΧΧ” Χ›Χ:
![Pasted image 20240309184052.png|300](/img/user/Assets/Pasted%20image%2020240309184052.png)
![Pasted image 20240309184021.png|300](/img/user/Assets/Pasted%20image%2020240309184021.png)

Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ , Χ Χ•Χ›Χ ΧΧΧΧ—Χ ΧΧΆΧ¨Χ Χ”parents Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ Χ•Χ’Χ Χ‘Χ¦Χ•Χ¨Χ” Χ“Χ™Χ ΧΧ™Χ ΧΧ¨Χ•Χ¥ ΧΆΧ Χ›Χ Χ”Χ§Χ•Χ“Χ§Χ•Χ“Χ™Χ (Χ”Χ΅Χ™Χ‘Χ” Χ©Χ”Χ¦Χ•Χ¨Χ” Χ”Χ™Χ Χ“Χ™Χ ΧΧ™Χ Χ”Χ™Χ Χ‘Χ’ΧΧ Χ©ΧΧ Χ—Χ Χ• ΧΧ Χ™Χ•Χ“ΧΆΧ™Χ ΧΧ™Χ–Χ” Χ§Χ•Χ“Χ§Χ•Χ“Χ™Χ Χ”Χ ΧΆΧ Χ™Χ•ΧΧ¨ Χ©Χ›Χ Χ™Χ Χ•ΧΧ™Χ–Χ” ΧΆΧ Χ¤Χ—Χ•Χ). Χ”ΧΧ•ΧΧΧ” Χ”Χ©Χ Χ™Χ™Χ” Χ›Χ‘Χ¨ Χ™Χ›Χ•ΧΧ” ΧΧ”Χ™Χ•Χ Χ΅ΧΧΧ™Χ Χ©Χ›Χ Χ›ΧΧ•Χ Χ”ΧΆΧ‘Χ•Χ“Χ” Χ”Χ™Χ Χ©Χ•Χ•Χ” Χ‘Χ›Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ” Χ¤Χ Χ™ΧΧ™Χ. Χ›ΧΧ• Χ›Χ Χ Χ©Χ™Χ ΧΧ‘ Χ©ΧΧ™Χ Χ›ΧΧ ΧΧ™Χ–Χ” Χ΅Χ Χ›Χ¨Χ•Χ Χ¤Χ¨Χ ΧΧ΅Χ Χ›Χ¨Χ•Χ Χ”Χ“Χ™Χ¤Χ•ΧΧΧ™, Χ‘ΧΧ§Χ•Χ Χ©Χ ΧΆΧ‘Χ•Χ“ ΧΆΧ Χ©Χ Χ™ ΧΧ•Χ¨Χ™Χ ΧΆΧ counter Χ©Χ”Χ•Χ¤Χ ΧΧ”Χ™Χ•Χ 0 Χ¨Χ§ Χ›ΧΧ©Χ¨ Χ” bottom-up ΧΧ ΧΧ•Χ¦Χ Χ©Χ•Χ Χ§Χ•Χ“Χ§Χ•Χ“ Χ©Χ”Χ”Χ•Χ¨Χ” Χ©ΧΧ• Χ΄ΧΧ Χ§Χ™Χ™ΧΧ΄ Χ‘ΧΧΆΧ¨Χ Χ”parent.

![Pasted image 20240309183913.png](/img/user/Assets/Pasted%20image%2020240309183913.png)

### DFS 
Χ Χ¨ΧΧ” Χ§Χ•Χ“ c Χ©ΧΧΧ© [[Computer Science/Algorithms/DFS\|DFS]] ΧΧ§Χ‘Χ™ΧΧ™ Χ‘ΧΧΧ¦ΧΆΧ•Χ OMP:

```C
#include <stdio.h>
#include <stdlib.h>
#include <omp.h>

#define MAX_NODES 100

int graph[MAX_NODES][MAX_NODES];
int num_nodes;

enum colors {NOT_VISITED, VISIT_IS_IN_TASK_QUEUE, ALREADY_VISITED};
enum colors visited[MAX_NODES];

void parallel_dfs_visit(int node) {
    visited[node] = ALREADY_VISITED;
    printf("Node %d is visited by thread %d\n", node, omp_get_thread_num());

    for (int i = 0; i < num_nodes; i++) {
        if (graph[node][i]) {
            #pragma omp critical 
            {
                if (visited[i] == NOT_VISITED) {
                    printf("thread %d: create task for node %d\n", omp_get_thread_num(),i);
                    visited[i] = VISIT_IS_IN_TASK_QUEUE;
                    #pragma omp task
                        parallel_dfs_visit(i);
                }
            }
        }
    }
}

void dfs() {
    for (int i = 0; i < num_nodes; i++) {
        printf("thread %d: examine node %d\n", omp_get_thread_num(), i);
        if (visited[i] == NOT_VISITED) {
            printf("\nstarting DFS visit from %d\n", i);
            
            #pragma omp parallel
            {
                #pragma omp single
                {
                    parallel_dfs_visit(i);
                }
            }
            
        } else if (visited[i] == VISIT_IS_IN_TASK_QUEUE) {
            perror("error: VISIT_IS_IN_TASK_QUEUE shouldn't be possible here\n");
        }
    }
}

```

Χ”Χ§Χ•Χ“ ΧΧ›Χ Χ™Χ΅ thread ΧΧ—Χ“ ΧΧΧ•Χ Χ” dfs_visit Χ•Χ”Χ•Χ Χ›Χ Χ¤ΧΆΧ ΧΧ•Χ΅Χ™Χ£ task ΧΧ¤Χ•Χ Χ§Χ¦Χ™Χ™Χ Χ”visit Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ. Χ›Χ›Χ” Χ‘ΧΆΧ¦Χ ΧΧ Χ—Χ Χ• ΧΧ‘Χ¦ΧΆΧ™Χ Χ΅Χ¨Χ™Χ§Χ” ΧΆΧ•ΧΧ§ ΧΧ‘Χ Χ›Χ Χ”Χ©Χ›Χ Χ™Χ Χ©Χ Χ§Χ•Χ“Χ§Χ•Χ“ Χ›ΧΧ©Χ”Χ• ΧΆΧ•Χ©Χ™Χ ΧΧ Χ–Χ” ΧΧ§Χ‘Χ™ΧΧ™ (Χ§Χ¦Χ ΧΆΧ™Χ•Χ•Χ Χ©Χ DFS Χ©ΧΧ©ΧΧ‘ Χ‘ΧΧ•Χ›Χ• BFS). Χ¦Χ¨Χ™Χ ΧΧ©Χ™Χ ΧΧ‘ Χ©Χ’Χ ΧΆΧ Χ”ΧΆΧ™Χ•Χ•Χ Χ”Χ–Χ” ΧΧ–Χ›Χ™Χ¨ BFS , Χ›ΧΧ•ΧΧ¨ Χ”Χ™Χ™Χ Χ• Χ™Χ›Χ•ΧΧ™Χ ΧΧ•ΧΧ™ ΧΧ‘Χ Χ•Χ ΧΧ Χ’Χ Χ•Χ ΧΧ‘Χ•Χ΅Χ΅ priorities Χ©Χ Χ•ΧΧ Χ task ΧΧ Χ”ΧΆΧ“Χ™Χ¤Χ•Χ Χ©Χ Χ”Χ¨ΧΧ” Χ©Χ ΧΧ•ΧΧ• Χ§Χ•Χ“Χ§Χ•Χ“ Χ‘Χ’Χ¨Χ£. ΧΧ‘Χ ΧΆΧ“Χ™Χ™Χ Χ–Χ” ΧΧ Χ”Χ™Χ” BFS ΧΧ•Χ©ΧΧ Χ©Χ›Χ Χ™Χ›ΧΧ• ΧΧ”Χ™Χ•Χ ΧΧ¦Χ‘Χ™Χ Χ©Χ”task queue Χ™Χ§Χ¦Χ” ΧΧ©Χ™ΧΧ•Χ ΧΆΧ ΧΆΧ•ΧΧ§ Χ ΧΧ•Χ Χ™Χ•ΧΧ¨ Χ›Χ™ Χ™Χ© threads Χ‘ΧΧ•Χ•Χ™Χ¨, ΧΧ¤Χ Χ™ Χ©Χ›Χ Χ”Χ¨ΧΧ” Χ”Χ΅ΧΧ™Χ™ΧΧ”. 

>[!note] task priority
>ΧΧ¤Χ©Χ¨ ΧΧ”Χ‘Χ™Χ Χ task ΧΆΧ¨Χ Χ©Χ priority Χ‘ΧΆΧ Χ”Χ™Χ¦Χ™Χ¨Χ” Χ©ΧΧ• ΧΆΧ task priority(#p) Χ‘ pragma block.

>[!warning] 
>Χ”ΧΧ™ΧΧ•Χ© Χ”Χ Χ΄Χ ΧΧ™Χ Χ• ΧΧ•Χ©ΧΧ Χ©Χ›Χ Χ”Χ•Χ Χ Χ•ΧΆΧ ΧΧDFS visit ΧΆΧ critical block , Χ™Χ© ΧΧ›Χ Χ”Χ©Χ¤ΧΆΧ•Χ Χ©Χ Χ¤Χ’Χ™ΧΆΧ” Χ‘ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ ΧΆΧΧ™Χ”Χ Χ Χ“Χ‘Χ¨ Χ‘Χ”ΧΧ©Χ
## Sections
Χ‘ΧΆΧ™Χ™Χ producer/consumer ΧΧ•Χ’Χ“Χ¨Χ Χ‘ΧΧ•Χ¤Χ Χ”Χ‘Χ. Χ™Χ© ΧΧ Χ• bounded buffer Χ‘Χ’Χ•Χ“Χ N ΧΧΧ™Χ. producer ΧΧ™Χ™Χ¦Χ¨ items Χ•Χ©Χ ΧΧ•ΧΧ Χ‘- buffer Χ‘ΧΧ§Χ•Χ Χ¤Χ Χ•Χ™. consumer Χ¦Χ•Χ¨Χ items Χ•ΧΧ¤Χ Χ” ΧΧ§Χ•Χ Χ‘- buffer. ΧΆΧ consumer ΧΧ—Χ›Χ•Χ Χ›Χ“Χ™ Χ©- item Χ™Χ›Χ Χ΅ Χ- buffer ΧΧ¤Χ Χ™ Χ©Χ™Χ•Χ›Χ ΧΧ¦Χ¨Χ•Χ ΧΧ•ΧΧ•, Χ•ΧΆΧ producer ΧΧ—Χ›Χ•Χ ΧΆΧ“ Χ©Χ™Χ”Χ™Χ” ΧΧ§Χ•Χ Χ¤Χ Χ•Χ™ Χ‘- buffer Χ›Χ“Χ™ Χ©Χ™Χ•Χ›Χ ΧΧ©Χ™Χ Χ©Χ item Χ—Χ“Χ©.

Χ§Χ•Χ“ Χ΅Χ“Χ¨ΧΧ™ Χ™Χ¨ΧΧ” ΧΧ”Χ¦Χ•Χ¨Χ” Χ©Χ‘Χ” Χ‘Χ›Χ ΧΧ™ΧΧ¨Χ¦Χ™Χ” Χ Χ•Χ¦Χ¨ item ΧΧ—Χ“, Χ•Χ”Χ•Χ ΧΧ™Χ“ Χ Χ¦Χ¨Χ.
![Pasted image 20240309012234.png](/img/user/Assets/Pasted%20image%2020240309012234.png)

ΧΧ™Χ ΧΧ”Χ¤Χ•Χ ΧΧ•ΧΧ” ΧΧΧ•Χ›Χ Χ™Χ ΧΧ§Χ‘Χ™ΧΧ™Χ Χ›Χ“Χ™ Χ©- producer Χ•- consumer Χ™Χ•Χ›ΧΧ• ΧΧΆΧ‘Χ•Χ“ Χ›Χ ΧΧ—Χ“ Χ‘Χ Χ¤Χ¨Χ“ Χ•Χ‘ΧΧ§Χ‘Χ™Χ ? ΧΆΧ Χ”Χ›ΧΧ™Χ Χ©ΧΧΧ“Χ Χ• Χ‘ OpenMP ΧΆΧ“ Χ›Χ”, Χ Χ¨ΧΧ” Χ©ΧΧ Χ§Χ™Χ™Χ Χ›ΧΧ™ Χ©Χ™ΧΆΧ–Χ•Χ¨ ΧΧ Χ• Χ©Χ›Χ ΧΧ Χ—Χ Χ• ΧΧ Χ¨Χ•Χ¦Χ™Χ ΧΧ—ΧΧ§ ΧΧ©Χ™ΧΧ” ΧΧ—ΧΧ§Χ™Χ ΧΧΧ ΧΧ”Χ’Χ“Χ™Χ¨ Χ©ΧΧ™ ΧΧ©Χ™ΧΧ•Χ Χ©Χ•Χ Χ•Χ ΧΆΧ‘Χ•Χ¨ Χ›Χ thread. Χ–Χ” Χ‘ΧΆΧ™Χ” Χ©ΧΧ Χ ΧΧ§ΧΧ Χ• Χ‘Χ” ΧΆΧ“ Χ›Χ” Χ›Χ™ ΧΧ Χ—Χ Χ• Χ¨Χ•Χ¦Χ™Χ ΧΧ—ΧΧ§ __ΧΧ¤Χ§Χ™Χ“Χ™Χ__ Χ•ΧΧ __ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ__.

![Pasted image 20240309125402.png|300](/img/user/Assets/Pasted%20image%2020240309125402.png)

Χ”Χ›ΧΧ™ Χ”ΧΧ“Χ•Χ‘Χ¨ Χ Χ§Χ¨Χ __sections__:
![Pasted image 20240309013048.png](/img/user/Assets/Pasted%20image%2020240309013048.png)
1) Χ©Χ Χ™ keyword Χ—Χ“Χ©Χ™Χ - section Χ• sections. 
2) Χ›Χ Χ” sections Χ¨Χ¦Χ™Χ Χ‘ΧΧ§Χ‘Χ™Χ Χ‘thread Χ Χ¤Χ¨Χ“ ΧΧ›Χ section
3) Χ”ΧΧ•Χ›Χ Χ©Χ Χ›Χ section Χ”Χ•Χ Χ΅Χ“Χ¨ΧΧ™ ΧΧΧ ΧΧ Χ›Χ ΧΧ’Χ“Χ™Χ¨Χ™Χ ΧΧ—Χ¨Χ
4) Χ”Χ’Χ“Χ¨Χ Χ• section ΧΧ§Χ‘Χ™ΧΧ™ ΧΆΧ¦ΧΧΧ™ ΧΆΧ‘Χ•Χ¨ producer thread Χ•- consumer thread. ΧΆΧ‘Χ•Χ¨ Χ›Χ ΧΧ $A[i]$ Χ™Χ¦Χ¨Χ Χ• ΧΧ©ΧΧ Χ” $flags[i]$ ΧΆΧ‘Χ•Χ¨ Χ›Χ ΧΧ Χ‘ΧΧΆΧ¨Χ A Χ›Χ“Χ™ Χ©- producer Χ™Χ•Χ›Χ ΧΧ™Χ™Χ“ΧΆ ΧΧ consumer Χ©Χ”Χ•Χ ΧΧ™ΧΧ $A[i]$ Χ•ΧΧ Χ–Χ” ΧΧ•Χ›Χ ΧΧ¦Χ¨Χ™Χ›Χ”, Χ•- consumer Χ™Χ•Χ›Χ ΧΧ™Χ™Χ“ΧΆ ΧΧ producer Χ©Χ”Χ•Χ Χ¦Χ¨Χ $A[i]$ Χ•ΧΧ Χ–Χ” ΧΧ•Χ›Χ ΧΧΧ™ΧΧ•Χ™ Χ—Χ•Χ–Χ¨.

Χ‘Χ§Χ•Χ“ Χ”Χ Χ΄Χ Χ™Χ©Χ Χ” Χ‘ΧΆΧ™Χ”, Χ”Χ¤ΧΧ ΧΆΧΧ•Χ ΧΧ”Χ™Χ•Χ Χ©Χ•Χ Χ” Χ‘Χ›Χ Χ¨Χ™Χ¦Χ” ΧΧ›Χ™Χ•Χ•Χ Χ©Χ©Χ Χ™ threads ΧΆΧΧ•ΧΧ™Χ ΧΧΆΧ‘Χ•Χ“ ΧΆΧ __Χ©Χ Χ™ ΧΧΆΧ‘Χ“Χ™Χ Χ©Χ•Χ Χ™Χ__ Χ•ΧΧ›Χ Χ”ΧΆΧ“Χ›Χ•Χ Χ©Χ $A[i]$ ΧΆΧ Χ™Χ“Χ™ producer threads ΧΆΧΧ•Χ ΧΧ”Χ™Χ•Χ ΧΧ Χ Χ’Χ™Χ© ΧΆΧ‘Χ•Χ¨ consumer thread Χ•Χ›Χ Χ΄Χ ΧΧ’Χ‘Χ™ $FLAGS[i]$ . Χ–Χ” Χ›ΧΧ•Χ‘Χ ΧΧΧ•Χ™ Χ‘ΧΧ“Χ™Χ Χ™Χ•Χ Χ”Χ›ΧΧ™Χ‘Χ” Χ©Χ Χ”cache ΧΧ‘Χ Χ–Χ” ΧΆΧ“Χ™Χ™Χ Χ™Χ•Χ¦Χ¨ ΧΧ™ Χ“ΧΧ¨ΧΧ™Χ Χ™Χ–Χ.

Χ›Χ“Χ™ ΧΧΧ¤Χ Χ‘Χ‘ΧΆΧ™Χ” Χ”Χ–ΧΧ Χ Χ™ΧΧ ΧΧ”Χ©ΧΧΧ© Χ‘Χ¤Χ•Χ Χ§Χ¦Χ™Χ” flush 
![Pasted image 20240309130114.png](/img/user/Assets/Pasted%20image%2020240309130114.png)

Χ”Χ¤Χ•Χ Χ§Χ¦Χ™Χ” Χ”Χ–ΧΧ Χ‘ΧΆΧ¦Χ ΧΧ›Χ¨Χ™Χ—Χ” ΧΧ Χ”ΧΧ™Χ“ΧΆ ΧΧ”ΧΧΆΧ“Χ›Χ Χ’Χ Χ‘ram Χ•ΧΧ Χ¨Χ§ Χ‘ cache. Χ Χ©Χ™Χ ΧΧ‘ Χ©Χ–Χ” ΧΧ Χ”ΧΧ¦Χ‘ Χ©Χ cache invalidation Χ©Χ“Χ™Χ‘Χ¨Χ Χ• ΧΆΧΧ™Χ• Χ§Χ•Χ“Χ, ΧΧ¦Χ‘ Χ©Χ cache invalidation Χ’Χ•Χ¨Χ ΧΧΧΆΧ™Χ Χ” Χ©Χ Χ”ΧΧ™Χ“ΧΆ ΧΧ”RAM Χ•ΧΧ ΧΧΆΧ“Χ›Χ•Χ Χ”ΧΧ™Χ“ΧΆ Χ‘RAM. 

Χ›Χ›Χ” Χ Χ‘ΧΧ™Χ— ΧΧ ΧΧΧ™Χ Χ•Χ Χ”ΧΧ™Χ“ΧΆ Χ‘ cache, ΧΧ‘Χ ΧΆΧ“Χ™Χ™Χ Χ”Χ¤ΧΧ ΧΆΧΧ•Χ ΧΧ”Χ™Χ•Χ Χ©Χ•Χ Χ” Χ‘Χ›Χ Χ”Χ¨Χ¦Χ” Χ‘Χ’ΧΧ Χ©Χ™Χ›Χ•Χ ΧΧ”Χ™Χ•Χ ΧΧ¦Χ‘ Χ©ΧΧ¤Χ Χ™ Χ©Χ Χ’Χ™ΧΆ Χ flush Χ”Χ–Χ›Χ¨Χ•Χ ΧΆΧ‘Χ•Χ¨ flags Χ™ΧΧΆΧ“Χ›Χ ΧΧ‘Χ ΧΆΧ‘Χ•Χ¨ Χ”ΧΧΆΧ¨Χ ΧΧ, ΧΧ›Χ Χ”consumer Χ™Χ¦Χ ΧΧ”busy wait Χ©ΧΧ• (ΧΧ•ΧΧΧ Χ” while) Χ•Χ™Χ΅Χ›Χ•Χ ΧΆΧ¨Χ ΧΧ ΧΆΧ“Χ›Χ Χ™.

__Χ”Χ¤ΧΧ¨Χ•Χ Χ”Χ•Χ ΧΧ”Χ•Χ΅Χ™Χ£ ΧΆΧ•Χ“ flush__ Χ’Χ ΧΧ—Χ¨Χ™ ΧΆΧ“Χ›Χ•Χ Χ©Χ A Χ•Χ’Χ ΧΧ—Χ¨Χ™ ΧΆΧ“Χ›Χ•Χ Χ©Χ flags 

![Pasted image 20240309132141.png](/img/user/Assets/Pasted%20image%2020240309132141.png)

Χ¦Χ¨Χ™Χ ΧΧ©Χ™Χ ΧΧ‘ Χ©Χ‘ΧΧ™ΧΧ™Χ ΧΧ—Χ¨Χ•Χ Χ”Χ¤ΧΆΧ•ΧΧ” Χ”Χ–ΧΧ ΧΧ•ΧΧ¨Χ ΧΧΧ™Χ‘Χ•Χ ΧΧ ΧΧΆΧ‘Χ•Χ“ ΧΆΧ Χ”cache Χ‘Χ›ΧΧ ΧΧΧ Χ¨Χ§ ΧΆΧ RAM Χ•ΧΧ›Χ Χ–ΧΧ Χ¤ΧΆΧ•ΧΧ” __ΧΧΧ•Χ“ Χ™Χ§Χ¨Χ”__ Χ•ΧΧ•Χ§Χ—Χ Χ–ΧΧ Χ¨Χ‘.

### Nested Sections 
Χ Χ•Χ›Χ ΧΧ”Χ¦Χ”Χ™Χ¨ ΧΆΧ nested section Χ‘ΧΧ•Χ section Χ§Χ™Χ™Χ. Χ›ΧΧ• nested for , Χ” nested section Χ‘ΧΧ•Χ¤Χ Χ“Χ™Χ¤Χ•ΧΧΧ™ Χ¨Χ¦Χ™Χ Χ‘Χ¦Χ•Χ¨Χ” Χ΅Χ“Χ¨ΧΧ™Χ ΧΆΧ Χ™Χ“Χ™ Χ”thread Χ©ΧΧ¨Χ™Χ¥ ΧΧ Χ”section ΧΧ‘. 

![Pasted image 20240309170140.png](/img/user/Assets/Pasted%20image%2020240309170140.png)

ΧΧ Χ Χ¨Χ¦Χ” ΧΧ©Χ Χ•Χ ΧΧ Χ”Χ”ΧΧ Χ”Χ’Χ•Χ Χ”Χ–ΧΧ Χ Χ©ΧΧΧ© Χ‘ omp_set_nested(1) ΧΧ—Χ•Χ¥ Χ pragma block Χ›Χ“Χ™ ΧΧΧ¤Χ©Χ¨ ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ ΧΧ§Χ•Χ Χ Χ.

## Tasks
### Linked List 
Χ Χ¨Χ¦Χ” ΧΧ”Χ¨ΧΧ•Χ Χ›Χ™Χ¦Χ“ ΧΧ”Χ©ΧΧΧ© Χ‘ OpenMP Χ›Χ“Χ™ ΧΧΧ§Χ‘Χ ΧΧ Χ”Χ§Χ•Χ“ Χ”Χ‘Χ

![Pasted image 20240309170403.png|300](/img/user/Assets/Pasted%20image%2020240309170403.png)

Χ”Χ”Χ¦ΧΆΧ” Χ”ΧΧ™Χ ΧΧ•ΧΧ™ΧΧ™Χ‘Χ™Χ Χ›Χ“Χ™ ΧΧΧ§Χ‘Χ ΧΧ•ΧΧΧ while , Χ“Χ‘Χ¨ Χ©ΧΧ ΧΧΧΧ¤Χ©Χ¨ Χ‘ default Χ”Χ™Χ ΧΧ”ΧΧ™Χ¨ ΧΧ Χ”Χ¨Χ©Χ™ΧΧ” Χ”ΧΧ§Χ•Χ©Χ¨Χ ΧΧΧΆΧ¨Χ Χ•ΧΧ– ΧΆΧ Χ–Χ” ΧΧ¨Χ•Χ¥ Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ.

![Pasted image 20240309170532.png](/img/user/Assets/Pasted%20image%2020240309170532.png)
Χ™Χ© Χ¤Χ” overhead Χ©Χ Χ”ΧΆΧΧ§Χ”. ΧΧ”Χ©ΧΧΧ© Χ‘ sections Χ”Χ•Χ Χ’Χ Χ‘ΧΆΧ™Χ™ΧΧ™ Χ›Χ™ ΧΧ Χ—Χ Χ• ΧΧ Χ™Χ›Χ•ΧΧ™Χ ΧΧ“ΧΆΧ ΧΧ”Χ• ΧΧ΅Χ¤Χ¨ Χ”sections Χ©Χ Χ¨Χ¦Χ” ΧΧ™Χ™Χ¦Χ¨. Χ Χ¨Χ¦Χ” Χ›ΧΧ™ Χ©ΧΧΧΧ™Χ ΧΧΧ§Χ‘Χ•Χ Χ©Χ ΧΧ¦Χ‘ Χ›Χ–Χ” Χ©Χ‘Χ• ΧΧ Χ™Χ•Χ“ΧΆ Χ›ΧΧ” tasks Χ Χ¨Χ¦Χ” ΧΧ™Χ™Χ¦Χ¨, Χ”Χ›ΧΧ™ Χ”Χ–Χ” Χ Χ§Χ¨Χ Tasks.

Χ Χ΅ΧΧ›Χ ΧΆΧ Χ”Χ΅Χ™Χ ΧΧ§Χ΅:
![Pasted image 20240309170726.png|300](/img/user/Assets/Pasted%20image%2020240309170726.png)
Χ”Χ”Χ‘Χ“Χ Χ”ΧΧ”Χ•ΧΧ™ Χ‘Χ™Χ tasks Χ sections Χ”Χ•Χ Χ©Χ›ΧΧ Χ™Χ© task queue Χ©ΧΧ Χ”Χ ΧΧ Χ”ΧΧ©Χ™ΧΧ•Χ. Χ‘ΧΧ•Χ Χ”Χ§Χ•Χ“ Χ”ΧΧ§Χ‘Χ™ΧΧ™ ΧΆΧΧ¤Χ Χ• ΧΧ Χ”ΧΧ•Χ›Χ Χ™Χ Χ‘Χ§Χ•Χ“ single Χ›Χ“Χ™ Χ©Χ¨Χ§ thread ΧΧ—Χ“ Χ™Χ™Χ¦Χ¨ ΧΧ Χ”tasks Χ•Χ™Χ›Χ Χ™Χ΅ ΧΧ•ΧΧ Χ task pool. 

Χ›ΧΧ Χ™Χ© Χ¤Χ” ΧΧ™ΧΧ•Χ© Χ“Χ•ΧΧ” ΧΧΧ•Χ“ Χ[[Computer Science/Programming Concepts/Concurrency Programming/Thread Pool\|Thread Pool]] , Χ” threads Χ©Χ•ΧΧ¤Χ™Χ ΧΧ©Χ™ΧΧ•Χ ΧΧ”task queue Χ›Χ ΧΆΧ•Χ“ Χ”Χ Χ™Χ›Χ•ΧΧ™Χ.

![Pasted image 20240309171008.png](/img/user/Assets/Pasted%20image%2020240309171008.png)
ΧΆΧ‘Χ•Χ¨ Χ”ΧΧ•Χ›Χ Χ™Χ Χ”Χ Χ΄Χ Χ”Χ¤ΧΧ Χ™Χ”Χ™Χ”

![Pasted image 20240309171020.png](/img/user/Assets/Pasted%20image%2020240309171020.png)

Χ‘Χ”Χ¨Χ¦Χ” Χ”Χ–Χ• Χ¨Χ•ΧΧ™Χ Χ©- thread2 Χ”Χ΅Χ¤Χ™Χ§ ΧΧ‘Χ¦ΧΆ 3 tasks, Χ•Χ›Χ Χ©ΧΧ¨ Χ”- threads Χ¨Χ§ task ΧΧ—Χ“. Χ–Χ” ΧΧΧ•Χ™ Χ‘ΧΧ–ΧΧ•Χ Χ©Χ threads Χ•Χ‘ΧΧ¨Χ•Χ›Χ‘Χ•Χ Χ©Χ tasks ΧΧ Χ”Χ Χ©Χ•Χ Χ™Χ.

Χ Χ™ΧΧ Χ’Χ ΧΧ”Χ’Χ“Χ™Χ¨ explicit barriers Χ tasks Χ›ΧΧ•ΧΧ¨, Χ Χ™ΧΧ ΧΧ—Χ›Χ•Χ ΧΧΧ΅Χ¤Χ¨ tasks Χ©Χ™Χ΅ΧΧ™Χ™ΧΧ• ΧΧ¤Χ Χ™ Χ©ΧΧ›Χ Χ™Χ΅Χ™Χ tasks Χ—Χ“Χ©Χ™Χ:

![Pasted image 20240309171244.png|300](/img/user/Assets/Pasted%20image%2020240309171244.png)


ΧΧ Χ Χ¨Χ¦Χ” ΧΧΧΧ© ΧΧ Χ–Χ” ΧΆΧ Χ”linked list Χ©ΧΧ Χ• Χ Χ¨Χ¦Χ” ΧΧ”Χ‘Χ™Χ ΧΧ” Χ”ΧΧ’Χ‘ΧΧ•Χ Χ©ΧΧ Χ Χ™ΧΧ ΧΧ”ΧΧ ΧΆ ΧΧ”Χ Χ•ΧΧ” ΧΧ Χ—Χ Χ• Χ™Χ›Χ•ΧΧ™Χ ΧΧΆΧ©Χ•Χ.

1) Χ—Χ™Χ™Χ‘Χ™Χ ΧΧ¨Χ•Χ¥ ΧΆΧ Χ›Χ Χ”Χ¨Χ©Χ™ΧΧ” Χ‘ΧΧ•Χ¤Χ ΧΧ΅Χ•Χ Χ›Χ¨Χ Χ›ΧΧ•ΧΧ¨ thread 1 ΧΧ• ΧΆΧ Χ›ΧΧ™ Χ΅Χ Χ›Χ¨Χ•Χ.
2) Χ¦Χ¨Χ™Χ ΧΧ”Χ©ΧΧΧ© Χ‘ΧΧ•ΧΧΧ while Χ›Χ™ Χ’Χ•Χ“Χ Χ”Χ¨Χ©Χ™ΧΧ” ΧΧ Χ™Χ“Χ•ΧΆ.
3) Χ›Χ process Χ™Χ›Χ•Χ ΧΧ”Χ™Χ•Χ ΧΧ§Χ‘Χ™ΧΧ™.

ΧΧ Χ›Χ Χ”ΧΧ•Χ“Χ Χ™Χ™Χ¨ΧΧ” ΧΧ”Χ¦Χ•Χ¨Χ”

![Pasted image 20240309171705.png|300](/img/user/Assets/Pasted%20image%2020240309171705.png)

Χ”Χ§Χ•Χ“ ΧΧΧ•Χ“ Χ¤Χ©Χ•Χ Χ•Χ™Χ¨ΧΧ” Χ›Χ:
![Pasted image 20240309171223.png|300](/img/user/Assets/Pasted%20image%2020240309171223.png)

Χ‘ΧΧ™ΧΧ™Χ- thread ΧΧ—Χ“ ΧΧ›Χ Χ™Χ΅ ΧΧ Χ”tasks , Χ›Χ task Χ”Χ•Χ Χ”Χ¤ΧΆΧ•ΧΧ” process ΧΆΧ ΧΧ™Χ‘Χ¨ Χ›ΧΧ©Χ”Χ• Χ‘Χ¨Χ©Χ™ΧΧ”. Χ©ΧΧ¨ Χ” threads Χ©Χ•ΧΧ¤Χ™Χ ΧΧ Χ”tasks Χ•ΧΧ‘Χ¦ΧΆΧ™Χ ΧΧ•ΧΧ ΧΧ§Χ‘Χ™ΧΧ™.

### Fibonacci
[[Computer Science/Algorithms/Fibonacci algorithm\|Χ¤Χ™Χ‘Χ•Χ ΧΧ¦Χ³Χ™ Χ”Χ¤Χ¨Χ“ Χ•ΧΧ©Χ•Χ]] Χ”Χ•Χ ΧΧΧ’Χ•Χ¨Χ™ΧΧ Χ©Χ¤Χ•ΧΧ¨ ΧΧ Χ¤Χ™Χ‘Χ³ Χ‘Χ–ΧΧ $O(\log n)$.
ΧΧ Χ—Χ Χ• ΧΧ›Χ™Χ¨Χ™Χ Χ’Χ ΧΧΧ’Χ•Χ¨Χ™ΧΧ Χ¤Χ©Χ•Χ Χ™Χ•ΧΧ¨ Χ©Χ¤Χ•ΧΧ¨ Χ‘Χ¦Χ•Χ¨Χ” Χ¨Χ™Χ§Χ•Χ¨Χ΅Χ™Χ‘Χ™Χ Χ‘Χ–ΧΧ ΧΧΧ•Χ“ ΧΧ™ΧΧ™

![Pasted image 20240309172333.png|300](/img/user/Assets/Pasted%20image%2020240309172333.png)

ΧΧ Χ Χ¨Χ¦Χ” ΧΧΧ§Χ‘Χ ΧΧ Χ–Χ” Χ Χ•Χ›Χ ΧΧ—Χ©Χ•Χ‘ ΧΆΧ ΧΧ”Χ›Χ Χ™Χ΅ Χ›Χ Χ§Χ¨Χ™ΧΧ” Χ¨Χ§Χ•Χ¨Χ΅Χ™Χ‘Χ™Χ Χ task. 

![Pasted image 20240309172420.png|300](/img/user/Assets/Pasted%20image%2020240309172420.png)

Χ”ΧΧ•Χ›Χ Χ™Χ Χ”Χ–ΧΧ ΧΧΧ•Χ“ ΧΧ Χ™ΧΆΧ™ΧΧ” Χ©Χ›Χ ΧΧ Χ—Χ Χ• ΧΧ©Χ§Χ™ΧΆΧ™Χ Χ”ΧΧ•Χ Χ–ΧΧ Χ•ΧΧ§Χ•Χ Χ‘Χ™Χ¦Χ™Χ¨Χ $2^{n}$ tasks Χ‘ queue. 

![Pasted image 20240309172525.png](/img/user/Assets/Pasted%20image%2020240309172525.png)

Χ Χ•Χ›Χ ΧΧ”Χ’Χ“Χ™Χ¨ Χ§Χ•Χ“ Χ©ΧΧ‘Χ§Χ¨ ΧΧ Χ›ΧΧ•Χ Χ”tasks Χ•ΧΧ•Χ ΧΆ ΧΧ”task queue ΧΧ”Χ›Χ™Χ Χ›ΧΧ•Χ Χ’Χ“Χ•ΧΧ” Χ™Χ•ΧΧ¨ Χ©Χ ΧΧ©Χ™ΧΧ•Χ Χ capacity Χ©Χ Χ’Χ“Χ™Χ¨ ΧΧ¨ΧΧ©

![Pasted image 20240309172814.png|300](/img/user/Assets/Pasted%20image%2020240309172814.png)

![Pasted image 20240309172825.png](/img/user/Assets/Pasted%20image%2020240309172825.png)

Χ”Χ§Χ•Χ“ Χ”Χ–Χ” Χ‘ΧΆΧ¦Χ ΧΧ’Χ“Χ™Χ¨ Χ©ΧΧ—Χ¨Χ™ ΧΆΧ•ΧΧ§ ΧΆΧ¥ Χ¨Χ§Χ•Χ¨Χ΅Χ™Χ” Χ©Χ 5 Χ”Χ§Χ•Χ“ Χ™ΧΆΧ‘Χ•Χ¨ ΧΧ—Χ©Χ‘ ΧΧ Χ©ΧΧ¨ Χ”ΧΆΧ•ΧΧ§Χ™Χ Χ‘Χ¦Χ•Χ¨Χ” Χ΅Χ“Χ¨ΧΧ™Χ, Χ›Χ ΧΆΧ•ΧΧ§ ΧΆΧ¥ Χ ΧΧ•Χ ΧΧ–Χ” Χ™ΧΆΧ©Χ” Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ.
## Synchronization 
Χ›Χ›ΧΧ ΧΧ¦Χ‘ΧΆ Χ Χ¨Χ¦Χ” ΧΧ”ΧΧ ΧΆ Χ[[Synchronization\|Χ΅Χ Χ›Χ¨Χ•Χ]] Χ›Χ“Χ™ ΧΧ”ΧΆΧΧ•Χ Χ¨ΧΧ Χ”ΧΧ§Χ‘Χ™ΧΧ•Χ. 

![Pasted image 20240310162652.png](/img/user/Assets/Pasted%20image%2020240310162652.png)

__Χ™Χ© Χ©Χ Χ™ Χ΅Χ•Χ’Χ™ Χ΅Χ Χ›Χ¨Χ•Χ Χ‘ openMP:__

__High level synchronization__ 
1) critical 
2) barriers

__Advanced synchronization operations__
1) ordered
2) locks
3) atomic
4) flush

### Ordered 
Χ”Χ§Χ•Χ“ Χ©Χ›ΧΧ•Χ‘ Χ‘ΧΧ•Χ ordered block ΧΧ‘ΧΧ™Χ— Χ©Χ’Χ ΧΧ Χ”Χ¨Χ™Χ¦Χ” ΧΧ”Χ™Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ Χ”Χ΅Χ“Χ¨ Χ©Χ‘Χ• Χ”Χ§Χ•Χ“ Χ™Χ‘Χ•Χ¦ΧΆ Χ™Χ”Χ™Χ” ΧΧ¤Χ™ Χ”Χ΅Χ“Χ¨ Χ©Χ‘Χ•Χ Χ”Χ§Χ•Χ“ ΧΧ•Χ¤Χ™ΧΆ Χ‘ parallel region ΧΧΧ©Χ Χ‘Χ“Χ•Χ’ΧΧ” ΧΆΧ ΧΧ•ΧΧΧ” 

```C

do_some_work(i) {
     printf("work% in progressβ€¦\n", i)
     return i
}

main() {
   #pragma omp parallel
   {
           #pragma omp for ordered
           for i = 0 to 4
               result = do_some_work(i)
               #pragma omp ordered
                     printf("work%d: %d\n", result)
   }
}
```

Χ”Χ¤ΧΧ Χ™Χ”Χ™Χ”
![Pasted image 20240310163128.png|200](/img/user/Assets/Pasted%20image%2020240310163128.png)

Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ Χ©Χ›Χ Χ—Χ™Χ©Χ•Χ‘ Χ ΧΆΧ©Χ” Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ ΧΆΧ Χ™Χ“Χ™ Χ”threads ΧΧ‘Χ Χ”Χ—ΧΧ§ Χ©Χ Χ” ordered Χ ΧΆΧ©Χ” ΧΧ¤Χ™ Χ΅Χ™Χ“Χ•Χ¨ Χ΅Χ“Χ¨ΧΧ™ Χ©Χ Χ”ΧΧ™ΧΧ¨Χ¦Χ™Χ•Χ.

Χ“Χ•Χ’ΧΧ” Χ Χ•Χ΅Χ¤Χ Χ™Χ›Χ•ΧΧ” ΧΧ”Χ™Χ•Χ ΧΆΧ sections 

```C
#pragma omp parallel
{
    #pragma omp sections
    {
        #pragma omp section
        {
            #pragma omp ordered
            printf("Thread %d is executing section 1.\n", omp_get_thread_num());
        }
        #pragma omp section
        {
            #pragma omp ordered
            printf("Thread %d is executing section 2.\n", omp_get_thread_num());
        }
        #pragma omp section
        {
            #pragma omp ordered
            printf("Thread %d is executing section 3.\n", omp_get_thread_num());
        }
    }
}

```

Χ›ΧΧ Χ”sections Χ¨Χ¦Χ™Χ Χ‘ΧΧ§Χ‘Χ™Χ ΧΧ‘Χ Χ”Χ”Χ“Χ¤Χ΅Χ•Χ Χ™Χ”Χ™Χ• ΧΧ¤Χ™ Χ΅Χ“Χ¨ Χ”Χ•Χ¤ΧΆΧΧ Χ‘ΧΧ•Χ Χ” pragma block.

![Pasted image 20240310163445.png](/img/user/Assets/Pasted%20image%2020240310163445.png)

### Critical 
Χ“Χ™Χ‘Χ¨Χ Χ• ΧΆΧ critical Χ›Χ‘ΧΧ•Χ§ Χ”ΧΧΧ¤Χ©Χ¨ Χ¨Χ§ Χ thread ΧΧ—Χ“ ΧΧ’Χ©Χ ΧΧ§ΧΧΆ Χ§Χ•Χ“ Χ§Χ¨Χ™ΧΧ™. ΧΆΧ Χ–ΧΧ, Χ™Χ© Χ›ΧΧ” Χ“Χ’Χ©Χ™Χ Χ©ΧΧ Χ“Χ™Χ‘Χ¨Χ Χ• ΧΆΧΧ™Χ”Χ, ΧΧΧ©Χ, ΧΧ ΧΧ Χ™ ΧΧ Χ Χ•ΧΧ Χ©Χ Χcritical sections Χ©ΧΧ™ Χ‘ΧΧ•Χ Χ”Χ‘ΧΧ•Χ§ ΧΧ– __Χ™Χ© Χ¨Χ§ ΧΧ ΧΆΧ•Χ ΧΧ—Χ“ Χ©ΧΧ—Χ¨ΧΧ™ ΧΆΧΧ™Χ”Χ__ Χ›ΧΧ•ΧΧ¨ ΧΧ Χ ΧΆΧΧΧ™ Χ©ΧΧ™ ΧΧ–Χ•Χ¨Χ™ Χ§Χ•Χ“ Χ§Χ¨Χ™ΧΧ™Χ ΧΆΧ Χ”Χ§Χ•Χ“ pragma omp critical ΧΧ– Χ¨Χ§ thread ΧΧ—Χ“ Χ™Χ•Χ›Χ ΧΧ’Χ©Χ Χ‘Χ›Χ Χ¤ΧΆΧ ΧΧΧ—Χ“ ΧΧ§ΧΧΆ Χ”Χ‘ΧΧ•Χ§ Χ”ΧΧΧ•.

![Pasted image 20240310163820.png|250](/img/user/Assets/Pasted%20image%2020240310163820.png)

ΧΧ¤Χ©Χ¨ ΧΧΧ§Χ Χ–ΧΧ ΧΆΧ Χ™Χ“Χ™ ΧΧΧ Χ©ΧΧ•Χ Χ critical sections Χ›Χ“Χ™ ΧΧΧ ΧΧ›Χ ΧΧ—Χ“ ΧΧ ΧΆΧ•Χ Χ©Χ•Χ Χ” 

![Pasted image 20240310163901.png|250](/img/user/Assets/Pasted%20image%2020240310163901.png)

Χ Χ©Χ™Χ ΧΧ‘ Χ© Critical Χ”Χ•Χ ΧΧ Χ’Χ Χ•Χ Χ ΧΆΧ™ΧΧ” Χ—Χ–Χ§ ΧΧ“Χ™ Χ‘ΧΆΧ™Χ§Χ¨ ΧΧ›Χ™Χ•Χ•Χ Χ©Χ”Χ•Χ compiler directive Χ•ΧΧ›Χ Χ”Χ¨Χ‘Χ” Χ¤ΧΆΧΧ™Χ ΧΧ™Χ ΧΧ Χ• ΧΧ Χ”Χ™Χ›Χ•ΧΧ ΧΧ‘Χ¦ΧΆ Χ ΧΆΧ™ΧΧ•Χ Χ“Χ™Χ ΧΧ™Χ•Χ Χ‘Χ”ΧΧΧ ΧΧΧ¦Χ‘ Χ”ΧΧ•Χ›Χ Χ™Χ. Χ”Χ™Χ›Χ•ΧΧ Χ”Χ™Χ—Χ™Χ“Χ” Χ©ΧΧ™ Χ”Χ™Χ ΧΧΧ Χ©ΧΧ•Χ hardcoded ΧΧΧ ΧΆΧ•ΧΧ™Χ ΧΧ” Χ©ΧΆΧΧ•Χ ΧΧ™Χ¦Χ•Χ¨ ΧΧ¦Χ‘Χ™Χ Χ©Χ Χ ΧΆΧ™ΧΧ” Χ©ΧΧ ΧΧ¦Χ•Χ¨Χ.

![Pasted image 20240310164126.png|250](/img/user/Assets/Pasted%20image%2020240310164126.png)

ΧΧΧ©Χ ΧΧ Χ Χ΅ΧΧ›Χ ΧΆΧ Χ§ΧΧΆ Χ”Χ§Χ•Χ“ Χ”Χ–Χ” Χ©Χ Χ•ΧΆΧ dfs_visit Χ”Χ™Χ Χ©Χ§ΧΧΆ Χ”Χ§Χ•Χ“ Χ”Χ§Χ¨Χ™ΧΧ™ Χ Χ•ΧΆΧ ΧΧ Χ›Χ Χ”threads Χ‘Χ™Χ ΧΧ Χ΅Χ•Χ¨Χ§Χ™Χ Χ΄ΧΆΧ•ΧΧ§Χ™ΧΧ΄ Χ©Χ•Χ Χ™Χ ΧΧ’ΧΧ¨Χ™ Χ‘ΧΆΧ¥. ΧΧ™Χ Χ›ΧΧ Χ”Χ‘Χ—Χ Χ” Χ‘Χ™Χ Χ”ΧΧ Χ™Χ© Χ¦Χ•Χ¨Χ ΧΧ”Χ¦Χ”Χ¨Χ Χ§ΧΧΆ Χ§Χ•Χ“ Χ§Χ¨Χ™ΧΧ™ Χ›Χ™ ΧΧ Χ—Χ Χ• Χ Χ’Χ©Χ™Χ ΧΧΧ•ΧΧ• Χ§Χ•Χ“Χ§Χ•Χ“ ΧΧ• ΧΧ. Χ Χ¨Χ¦Χ” ΧΧ‘Χ Χ•Χ ΧΧ Χ’Χ Χ•Χ Χ©Χ Χ•ΧΧ ΧΧ ΧΆΧ•Χ ΧΧ›Χ Χ§Χ•Χ“Χ§Χ•Χ“.

### LOCKS
Χ™Χ©Χ Χ Χ›ΧΧ” Χ¤Χ•Χ Χ§Χ¦Χ™Χ•Χ Χ©Χ Χ™ΧΧ ΧΧ”Χ©ΧΧΧ© Χ‘Χ”Χ Χ‘ΧΆΧ‘Χ•Χ“Χ” ΧΆΧ ΧΧ ΧΆΧ•ΧΧ™Χ Χ‘ OpenMP

![Pasted image 20240310164907.png](/img/user/Assets/Pasted%20image%2020240310164907.png)

Χ Χ‘Χ—Χ ΧΧ™Χ Χ Χ™ΧΧ ΧΧ‘Χ¦ΧΆ Χ©Χ™Χ Χ•Χ™ ΧΧ§Χ•Χ“ Χ” DFS ΧΆΧ ΧΧ ΧΆΧ•ΧΧ™Χ Χ•ΧΧ§Χ‘Χ Χ¨ΧΧ ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ Χ’Χ‘Χ•Χ”Χ” Χ™Χ•ΧΧ¨ ΧΆΧ Χ™Χ“Χ™ Χ ΧΆΧ™ΧΧ” Χ¨Χ§ Χ‘ΧΆΧ Χ”Χ¦Χ•Χ¨Χ 

```C

global variables: omp_lock_t locks[|V|]
DFS(G=(V,E)) {
   #pragma omp parallel for
   for π‘£β V
        visited[v] β† WHITE
        omp_init_lock(&locks[v])

   for π‘£β V
        if visited[v] = WHITE
           #pragma omp parallel
               #pragma omp single
                    dfs_visit (v)
   for π‘£β V
       omp_destroy_lock(&locks[v])
}

dfs_visit (v) {
   visited[v] β† BLACK

   for π‘Άβ neighbors[v]
        omp_set_lock(&locks[u])
        if visited[u] = WHITE
            visited[u] β† GRAY
            #pragma omp task
                  dfs_visit(u)
            omp_unset_lock(&locks[u])
}

```

Χ Χ©Χ™Χ ΧΧ‘ Χ©ΧΧ Χ—Χ Χ• Χ Χ•ΧΆΧΧ™Χ Χ¨Χ§ ΧΧ Χ”ΧΧ ΧΆΧ•Χ Χ©Χ Χ§Χ•Χ“Χ§Χ•Χ“ Χ΅Χ¤Χ¦Χ™Χ¤Χ™ Χ©Χ Χ›Χ Χ΅ ΧΧΧ ΧΧ™ Χ” if visited(u) , Χ‘ΧΧ•Χ¤Χ Χ”Χ–Χ”, ΧΧ Χ—Χ Χ• ΧΧ•Χ ΧΆΧ™Χ ΧΧ©Χ Χ™ threads ΧΧ”Χ›Χ Χ΅ ΧΧ§Χ•Χ“ Χ”Χ¨Χ§Χ•Χ¨Χ΅Χ™Χ” Χ›Χ™ Χ‘Χ”Χ›Χ¨Χ— Χ”Χ¨ΧΧ©Χ•Χ Χ©Χ™Χ™Χ›Χ Χ΅ Χ™Χ©Χ Χ” ΧΧ Χ” flag Χ WHITE Χ GRAY. ΧΧ•Χ Χ›Χ“Χ™ ΧΧ Χ—Χ Χ• ΧΧΧ¤Χ©Χ¨Χ™Χ ΧΧ©Χ Χ™ threads Χ©Χ΅Χ•Χ¨Χ§Χ™Χ Χ§Χ•Χ“Χ§Χ•Χ“Χ™Χ Χ©Χ•Χ Χ™Χ, ΧΧ”ΧΧ©Χ™Χ Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ.

### Atomic 
Χ“Χ¨Χ Χ Χ•Χ΅Χ¤Χ ΧΧ”Χ©Χ™Χ’ ΧΧ ΧΧ•ΧΧ” ΧΧ•Χ¦ΧΧ” Χ¨Χ¦Χ•Χ™Χ” Χ”Χ™Χ Χ‘ΧΧΧ¦ΧΆΧ•Χ Atomic instruction. Χ Χ–Χ›Χ™Χ¨ Χ© Χ¤ΧΆΧ•ΧΧ•Χ ΧΧΧ•ΧΧ™Χ•Χ Χ”Χ Χ¤ΧΧ¨Χ•Χ Χ—Χ•ΧΧ¨ΧΧ™ ΧΧ‘ΧΆΧ™Χ Χ” mutual exclusion Χ©ΧΧ‘ΧΧ™Χ—Χ” Χ©Χ¨Χ§ thread ΧΧ—Χ“ Χ™Χ›Χ•Χ ΧΧ‘Χ¦ΧΆ ΧΧ Χ”Χ¤ΧΆΧ•ΧΧ” Χ”ΧΧΧ•ΧΧ™Χ Χ‘Χ›Χ Χ¨Χ’ΧΆ Χ ΧΧ•Χ Χ•Χ‘Χ›Χ ΧΧ”ΧΧ ΧΆ Χ race conditions.

Χ”Χ”Χ‘Χ“Χ Χ”ΧΧ”Χ•ΧΧ™ Χ‘Χ™Χ Χ¤ΧΆΧ•ΧΧ” ΧΧΧ•ΧΧ™Χ ΧΧ‘Χ™Χ ΧΧ ΧΆΧ•ΧΧ™Χ Χ”Χ™Χ Χ©Χ‘ΧΧΧ¦ΧΆΧ•Χ Χ©Χ™ΧΧ•Χ© Χ‘Χ¤ΧΆΧ•ΧΧ•Χ ΧΧΧ•ΧΧ™Χ•Χ , ΧΧ™Χ overhead Χ©Χ Χ”Χ§Χ¤ΧΧ Χ”Χ¤ΧΆΧ•ΧΧ” Χ©Χ threads Χ•Χ©ΧΧ™Χ¨Χ Χ”ΧΧ¦Χ‘ Χ©ΧΧ”Χ ΧΆΧ“ ΧΧ¨Χ’ΧΆ Χ©Χ”Χ Χ™Χ›Χ•ΧΧ™Χ ΧΧ¨Χ•Χ¥. 
Χ” mutual exclusion Χ‘ atomic Χ”Χ•Χ Χ‘Χ¨ΧΧ Χ”Χ—Χ•ΧΧ¨Χ”, ΧΧΆΧ•ΧΧ Locks ΧΧ‘Χ Χ”Χ•Χ Χ’Χ ΧΧ—Χ–Χ™Χ§ ΧΧ Χ” threads Χ‘ busy wait (ΧΧ¦Χ‘ Χ©Χ‘Χ• Χ” thread ΧΧ‘Χ–Χ‘Χ– Χ–ΧΧ ΧΧΆΧ‘Χ“ ΧΆΧ Χ”ΧΧΧ Χ”).

![Pasted image 20240310202839.png](/img/user/Assets/Pasted%20image%2020240310202839.png)

Χ”ΧΧΧ•ΧΧ™Χ•Χ Χ”Χ–Χ• ΧΧ΅Χ•Χ¤Χ§Χ ΧΆΧ Χ™Χ“Χ™ Χ—Χ•ΧΧ¨Χ”, ΧΧ©Χ¨ ΧΧ©Χ‘Χ™ΧΧ” ΧΧ Χ”Χ”Χ¤Χ¨ΧΆΧ•Χ Χ‘ΧΧΆΧ‘Χ“ Χ”ΧΧΧΧ™Χ Χ•ΧΧ©Χ‘Χ™ΧΧ” ΧΧ Χ”Χ’Χ™Χ©Χ” ΧΧΧΆΧ‘Χ“ -m (ΧΆΧ Χ™Χ“Χ™ Χ ΧΆΧ™ΧΧ data bus), ΧΆΧ“ ΧΧ‘Χ™Χ¦Χ•ΧΆ Χ”Χ•Χ¨ΧΧ” ΧΧΧ•ΧΧ™Χ Χ‘ΧΧΧ•ΧΧ”.

![Pasted image 20240310203017.png](/img/user/Assets/Pasted%20image%2020240310203017.png)
ΧΧ” Χ©ΧΧΧ•ΧΧ™ Χ‘ΧΧ•Χ Χ”Χ‘ΧΧ•Χ§ atomic Χ”Χ•Χ Χ”Χ¤ΧΆΧ•ΧΧ” + Χ‘Χ§Χ•Χ“ Χ”Χ Χ΄Χ. Χ”Χ¤Χ•Χ Χ§Χ¦Χ™Χ” do some work Χ”Χ™Χ ΧΧ™Χ Χ” ΧΧΧ•ΧΧ™Χ Χ•ΧΧ΅Χ¤Χ¨ threads Χ¨Χ¦Χ™Χ Χ‘ΧΧ§Χ‘Χ™Χ.

![Pasted image 20240310203222.png](/img/user/Assets/Pasted%20image%2020240310203222.png)
Χ Χ™ΧΧ ΧΧ¨ΧΧ•Χ Χ©Χ›Χ Χ”- threads ΧΆΧ•Χ‘Χ“Χ™Χ Χ‘ΧΧ§Χ‘Χ™Χ, Χ•Χ¨Χ§ Χ”Χ’Χ™Χ©Χ” Χ- x Χ”Χ™Χ Χ” ΧΧ΅Χ•Χ Χ›Χ¨Χ Χ.

Χ”Χ΅Χ™Χ ΧΧ§Χ΅ Χ”Χ•Χ ΧΧ”Χ¦Χ•Χ¨Χ”

$$\text{pragma omp atomic [read | write | update | capture]}$$

* Χ”Χ”ΧΧ Χ”Χ’Χ•Χ Χ”Χ“Χ™Χ¤Χ•ΧΧΧ™Χ Χ”Χ™Χ update. Χ•Χ‘ΧΧ¦Χ‘ Χ–Χ” Χ”ΧΧΧ•ΧΧ™Χ•Χ ΧΧ’Χ ΧΆΧ ΧΆΧ“Χ›Χ•Χ ΧΧΧ™Χ§Χ•Χ Χ‘Χ–Χ›Χ¨Χ•Χ Χ›ΧΧ•ΧΧ¨ Χ”Χ•Χ¤Χ ΧΧ Χ”Χ¤ΧΆΧ•ΧΧ•Χ Χ”Χ‘ΧΧ•Χ ΧΧΧΧ•ΧΧ™Χ•Χ x++ / ++x / x-- / --x / x = x op exp.
	![Pasted image 20240310204126.png](/img/user/Assets/Pasted%20image%2020240310204126.png)
* Χ‘ΧΧ¦Χ‘ Χ©Χ read Χ”Χ¤ΧΆΧ•ΧΧ” Χ”ΧΧΧ•ΧΧ™Χ•Χ Χ©ΧΧ‘Χ—Χ¨ ΧΧ”Χ™Χ” ΧΧΧΧ™ΧΧ” Χread, Χ•Χ–Χ” ΧΧ‘Χ¦ΧΆ ΧΧ Χ”Χ¤ΧΆΧ•ΧΧ” v=x ΧΧΧΧ•ΧΧ™Χ. Χ”ΧΧΧ•ΧΧ™Χ•Χ Χ”Χ™Χ ΧΆΧ x Χ›ΧΧ•ΧΧ¨ Χ§Χ¨Χ™ΧΧ Χ”ΧΆΧ¨Χ Χ©Χ x Χ”Χ™Χ ΧΧΧ•ΧΧ™Χ, Χ”Χ”Χ©ΧΧ” ΧΧΧ©ΧΧ Χ” v ΧΧ™Χ Χ” ΧΧΧ•ΧΧ™Χ.
![Pasted image 20240310204235.png|250](/img/user/Assets/Pasted%20image%2020240310204235.png)
* write Χ”Χ•Χ¤Χ ΧΧ Χ¤ΧΆΧ•ΧΧ Χ”Χ©ΧΧ” ΧΧΧΧ•ΧΧ™Χ x=expr
![Pasted image 20240310204302.png|250](/img/user/Assets/Pasted%20image%2020240310204302.png)
* compare - Χ¤ΧΆΧ•ΧΧ compare and swap ΧΧΧ•ΧΧ™Χ™Χ.
 ![Pasted image 20240310204325.png|250](/img/user/Assets/Pasted%20image%2020240310204325.png)
* capture - ΧΧΧ¤Χ©Χ¨ ΧΧΧ¤Χ•Χ΅ old values Χ©Χ ΧΧ©ΧΧ Χ” ΧΧ¤Χ Χ™ Χ©ΧΧ‘Χ¦ΧΆΧ™Χ Χ”Χ©ΧΧ” ΧΆΧΧ™Χ• ΧΧΆΧ¨Χ Χ—Χ“Χ© (ΧΧ‘ΧΧ™Χ— Χ©ΧΧ Χ™Χ”Χ™Χ” ΧΧ¦Χ‘ Χ©Χ Χ“Χ¨Χ•Χ΅ ΧΧ Χ”ΧΆΧ•ΧΧ§ Χ©Χ Χ”ΧΧ©ΧΧ Χ” Χ©ΧΧ™Χ™Χ¦Χ¨Χ™Χ)

![Pasted image 20240310204407.png|250](/img/user/Assets/Pasted%20image%2020240310204407.png)

* compare capture - 
![Pasted image 20240310230931.png|250](/img/user/Assets/Pasted%20image%2020240310230931.png)

>[!info] ΧΧΧ” Χ§Χ¨Χ™ΧΧ” ΧΧΧ•ΧΧ™Χ Χ–Χ” Χ—Χ©Χ•Χ‘?
>ΧΆΧ Χ¤Χ Χ™Χ• Χ Χ¨ΧΧ” Χ©Χ”Χ§Χ¨Χ™ΧΧ” Χ”ΧΧΧ•ΧΧ™Χ Χ”Χ™Χ ΧΧ™Χ•ΧΧ¨Χ Χ©Χ›Χ ΧΧ” Χ”Χ‘ΧΆΧ™Χ” Χ©ΧΧ΅Χ¤Χ¨ threads Χ™Χ§Χ¨ΧΧ• ΧΧΧ•ΧΧ• ΧΆΧ¨Χ Χ•Χ™Χ‘Χ¦ΧΆΧ• Χ”Χ©ΧΧ” Χ©ΧΧ• ΧΧΧ©ΧΧ Χ”? Χ”Χ‘ΧΆΧ™Χ” ΧΧΧ—Χ™ΧΧ” Χ›ΧΧ©Χ¨ ΧΧ—Χ™ΧΧ Χ”ΧΆΧ¨Χ Χ©Χ Χ”ΧΧ©ΧΧ Χ” Χ ΧΧ¦Χ Χ‘Χ›ΧΧ•Χ‘Χ Χ©Χ”Χ™Χ ΧΧ [[Memory Alignment\|align]]. Χ‘ΧΧ¦Χ‘ Χ–Χ” ΧΆΧΧ•Χ ΧΧ§Χ¨Χ•Χ ΧΧ¦Χ‘ Χ©Χ‘Χ• ΧΧ Χ—Χ Χ• ΧΧ‘Χ¦ΧΆΧ™Χ ΧΧ΅Χ¤Χ¨ Χ’Χ™Χ©Χ•Χ ΧRAM Χ¨Χ§ Χ›Χ“Χ™ ΧΧ”Χ‘Χ™Χ ΧΆΧ¨Χ Χ©Χ ΧΧ©ΧΧ Χ” Χ•Χ‘ΧΧ¦Χ‘ Χ›Χ–Χ” ΧΧ Χ Χ§Χ¨Χ ΧΧ Χ”ΧΆΧ¨Χ ΧΆΧΧ•Χ ΧΧ”Χ™Χ•Χ ΧΧ¦Χ‘ Χ©ΧΧ•Χ Χ›Χ“Χ™ Χ§Χ¨Χ™ΧΧ” Χ©Χ Χ‘Χ™Χ ΧΧ—Χ“ ΧΧ”ΧΧ©ΧΧ Χ” Χ”Χ‘Χ™Χ Χ”Χ©Χ Χ™ Χ™Χ©ΧΧ Χ” ΧΧ•Χ Χ›Χ“Χ™ ΧΧ ΧΧ Χ Χ’Χ“Χ™Χ¨ ΧΧ Χ”Χ¤ΧΆΧ•ΧΧ” Χ›ΧΧΧ•ΧΧ™Χ (ΧΧ• Χ ΧΆΧ‘Χ•Χ“ ΧΆΧaligned addresses).
>ΧΧ“Χ•Χ’ΧΧ” - Χ©Χ§Χ¨Χ™ΧΧ•Χ ΧΧ–Χ›Χ¨Χ•Χ ΧΧΧ‘Χ¦ΧΆΧ•Χ Χ‘- chunks Χ©Χ 64 bits, Χ”Χ—Χ ΧΧ›ΧΧ•Χ‘Χ Χ©ΧΧΧ—ΧΧ§Χ Χ‘- 8 . ΧΧ ΧΧ©ΧΧ Χ” short x Χ ΧΧ¦Χ ΧΆΧ Χ”ΧΧ¤Χ¨, Χ Χ¦ΧΧ¨Χ Χ©ΧΧ™ Χ’Χ™Χ©Χ•Χ ΧΧ–Χ›Χ¨Χ•Χ Χ›Χ“Χ™ ΧΧ”Χ‘Χ™Χ ΧΧ Χ©Χ Χ™ Χ”- bytes Χ©Χ x. Χ‘Χ™Χ Χ§Χ¨Χ™ΧΧ” Χ¨ΧΧ©Χ•Χ Χ” ΧΧ§Χ¨Χ™ΧΧ” Χ©Χ Χ™Χ™Χ” ΧΆΧΧ•Χ ΧΧ”Χ›Χ Χ΅ thread ΧΧ—Χ¨ Χ©ΧΆΧΧ•Χ ΧΧ”Χ¨Χ•Χ΅ ΧΧ Χ”Χ§Χ¨Χ™ΧΧ” Χ©Χ x.
>![Pasted image 20240310231106.png|300](/img/user/Assets/Pasted%20image%2020240310231106.png)
>![Pasted image 20240310231205.png|300](/img/user/Assets/Pasted%20image%2020240310231205.png)
>Χ“Χ•Χ’ΧΧ ΧΧΧ–ΧΧ•Χ ΧΧ ΧΧ•Χ¦ΧΧ— Χ©Χ Χ©Χ Χ™ threads, Χ›ΧΧ©Χ¨ thread ΧΧ—Χ“ ΧΧ Χ΅Χ” ΧΧ§Χ¨ΧΧ• ΧΧ Χ”ΧΆΧ¨Χ Χ©Χ x, Χ•- thread Χ©Χ Χ™ ΧΧ Χ΅Χ” ΧΧ›ΧΧ•Χ‘ ΧΆΧ¨Χ Χ—Χ“Χ© Χ- x. Χ‘Χ΅Χ•Χ£ Χ”Χ§Χ¨Χ™ΧΧ” v ΧΧ§Χ‘Χ junk value.


Χ Χ¨ΧΧ” Χ©Χ™ΧΧ•Χ© Χ‘Χ¤ΧΆΧ•ΧΧ•Χ ΧΧΧ•ΧΧ™Χ•Χ ΧΧΧ™ΧΧ•Χ© dfs 
![Pasted image 20240310232518.png](/img/user/Assets/Pasted%20image%2020240310232518.png)
Χ›ΧΧ Χ”Χ©ΧΧΧ©Χ Χ• Χ‘ compare and capture Χ¤ΧΆΧ ΧΧ—Χ Χ›Χ Χ¤ΧΆΧ Χ©Χ Χ›Χ Χ΅Χ™Χ Χ dfs visit. ΧΧ¦Χ‘ Χ–Χ” Χ’Χ•Χ¨Χ ΧΧ›Χ Χ©Χ›Χ Χ§Χ•Χ“Χ§Χ•Χ“ Χ‘Χ¦Χ•Χ¨Χ” ΧΧΧ•ΧΧ™Χ Χ©Χ•ΧΧ¨ ΧΧ Χ”old value Χ©Χ Χ§Χ•Χ“Χ§Χ•Χ“ Χ©Χ”Χ•Χ ΧΧ‘Χ§Χ¨ Χ‘Χ•Χ Χ•ΧΧ•ΧΆΧ Χ‘ΧΧ•Χ›Χ• ΧΆΧ¨Χ Χ—Χ“Χ©. ΧΧ Χ”ΧΆΧ¨Χ Χ”Χ™Χ©Χ Χ”Χ™Χ” white ΧΧ– ΧΧ‘Χ§Χ¨Χ™Χ Χ‘Χ•. Χ‘Χ’ΧΧ Χ©Χ¤ΧΆΧ•ΧΧ” Χ”capture Χ”Χ™Χ ΧΧΧ•ΧΧ™Χ, ΧΧ– ΧΧ™Χ Χ—Χ©Χ© Χ©Χ”ΧΧ ΧΧ™ Χ™ΧΧ§Χ™Χ™Χ ΧΆΧ‘Χ•Χ¨ Χ©Χ Χ™ threads Χ©ΧΧ‘Χ§Χ¨Χ™Χ Χ‘ΧΧ•ΧΧ• Χ§Χ•Χ“Χ§Χ•Χ“.
### Sorted insertion to a linkes list
Χ Χ¨Χ¦Χ” ΧΧ‘Χ Χ” Χ ΧΧ•Χ Χ™Χ Χ©Χ Χ¨Χ©Χ™ΧΧ” ΧΧ§Χ•Χ©Χ¨Χ Χ©ΧΧ•ΧΧ›Χ Χ‘ΧΧ™Χ§Χ‘Χ•Χ. 
Χ Χ¨Χ¦Χ” Χ‘ΧΧ§Χ•Χ Χ¤Χ•Χ Χ§Χ¦Χ™Χ™Χ Χ”insert Χ”Χ¨Χ’Χ™ΧΧ” ΧΧΧΧ•Χ Χ‘sorted_insert Χ©ΧΧ›Χ Χ™Χ΅ ΧΧ™Χ‘Χ¨Χ™Χ Χ‘Χ¦Χ•Χ¨Χ” ΧΧΧ•Χ™Χ™Χ Χ ΧΧ¨Χ©Χ™ΧΧ”. 

Χ‘Χ§Χ•Χ“ Χ΅Χ“Χ¨ΧΧ™ Χ–Χ” Χ™Χ¨ΧΧ” Χ›Χ 

```C
void sorted_insert(node_t *head, int val) {
    /* Find the right place to insert */
    node_t *ptr = head->next;
    node_t *prev = head;

    while (ptr != NULL && ptr->value < val) {
        prev = ptr;
        ptr = ptr->next;
    }

    /* Insert the new node */
    node_t *new_node = malloc(sizeof(node_t));
    new_node->value = val;
    new_node->next = ptr;
    prev->next = new_node;
}
```

ΧΧ Χ—Χ Χ• Χ Χ§Χ“Χ ΧΧ Χ”ΧΧ¦Χ‘Χ™ΧΆ Χ›Χ ΧΆΧ•Χ“ Χ”ΧΆΧ¨Χ Χ”Χ Χ•Χ›Χ—Χ™ Χ©Χ Χ”ΧΧ¦Χ‘Χ™ΧΆ ΧΧΧ™Χ‘Χ¨ Χ‘Χ¨Χ©Χ™ΧΧ” ΧΧ§Χ•Χ©Χ¨Χ Χ§ΧΧ ΧΧ”ΧΆΧ¨Χ Χ©Χ Χ¨Χ¦Χ” ΧΧ”Χ›Χ Χ™Χ΅. Χ‘Χ¨Χ’ΧΆ Χ©Χ”Χ’ΧΆΧ Χ• Χ Χ›Χ Χ™Χ΅ ΧΧ Χ” node Χ”Χ—Χ“Χ©.

Χ Χ Χ΅Χ” ΧΧ›ΧΧ•Χ‘ ΧΧ Χ”Χ§Χ•Χ“ Χ”Χ–Χ” Χ›Χ“Χ™ ΧΧΧΧ•Χ Χ‘ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ __Χ›ΧΧ” Χ©Χ™Χ•ΧΧ¨ ΧΧ”Χ™Χ¨Χ”__ Χ‘ΧΧΧ¦ΧΆΧ•Χ Χ›ΧΧ™ Χ”Χ΅Χ Χ›Χ¨Χ•Χ Χ”Χ©Χ•Χ Χ™Χ.

### V1 
Χ”ΧΧ™ΧΧ•Χ© Χ”Χ›Χ™ Χ ΧΧ™Χ‘Χ™ Χ™Χ”Χ™Χ” ΧΧ”Χ©ΧΧΧ© Χ‘ΧΧ ΧΆΧ•Χ ΧΧ—Χ“ Χ‘ΧΧ•Χ Χ”Χ¤Χ•Χ Χ§Χ¦Χ™Χ” Χ©Χ sorted_insert. Χ”Χ¨Χ‘Χ” Χ¤ΧΆΧΧ™Χ Χ‘Χ¤ΧΧ¨Χ•Χ Χ©Χ ΧΧΧ’Χ•Χ¨Χ™ΧΧΧ™Χ ΧΧ§Χ‘Χ™ΧΧ™Χ™Χ Χ Χ¨Χ¦Χ” ΧΧ”ΧΧ—Χ™Χ ΧΧΧ”Χ‘Χ™Χ Χ‘Χ›ΧΧ ΧΧ”Χ• Χ”Χ¤ΧΧ¨Χ•Χ Χ”Χ ΧΧ™Χ‘Χ™ Χ‘Χ™Χ•ΧΧ¨ Χ•ΧΧ¤ΧΧ— ΧΧ•ΧΧ•.

```C
void sorted_insert(node_t *head, int val) {
    /* Find the right place to insert */
    omp_set_lock(&lock);
    node_t *ptr = head->next;
    node_t *prev = head;

    while (ptr != NULL && ptr->value < val) {
        prev = ptr;
        ptr = ptr->next;
    }

    /* Insert the new node */
    node_t *new_node = malloc(sizeof(node_t));
    new_node->value = val;
    new_node->next = ptr;
    prev->next = new_node;
    omp_unset_lock(&lock);
}
```

Χ”ΧΧ™ΧΧ•Χ© Χ”Χ–Χ” Χ”Χ•Χ¤Χ ΧΧ Χ”Χ‘ΧΧ•Χ§ Χ”Χ–Χ” ΧΧ΅Χ“Χ¨ΧΧ™ Χ•ΧΧ›Χ Χ¨ΧΧ Χ”ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ Χ–Χ”Χ” ΧΧ΅Χ“Χ¨ΧΧ™ Χ•Χ‘ΧΧ•Χ΅Χ¤Χ Χ” overhead Χ©Χ Χ™Χ¦Χ™Χ¨Χ threads , Χ”Χ§Χ•Χ“ Χ©ΧΧ Χ• Χ™Χ”Χ™Χ” Χ’Χ¨Χ•ΧΆ Χ‘Χ”Χ¨Χ‘Χ” ΧΧ”Χ§Χ•Χ“ Χ”Χ΅Χ“Χ¨ΧΧ™.

### V2
Χ”Χ’Χ¨Χ΅Χ” Χ”Χ©Χ Χ™Χ™Χ” Χ©ΧΧ Χ• ΧΧ¦Χ™ΧΆ Χ¨ΧΆΧ™Χ•Χ ΧΆΧ ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ Χ™Χ•ΧΧ¨ Χ’Χ‘Χ•Χ”Χ”.
ΧΧ Χ—Χ Χ• Χ Χ¨Χ¦Χ” Χ©Χ›Χ thread Χ©Χ§Χ•Χ¨Χ ΧΧ¤Χ•Χ Χ§Χ¦Χ™Χ” sorted_insert ΧΧΧ¤Χ©Χ¨ Χ threads Χ©Χ™Χ‘Χ•Χ ΧΧ—Χ¨Χ™Χ• ΧΧΆΧ‘Χ•Χ“ Χ¨Χ§ ΧΆΧ Χ¨Χ™Χ©Χ Χ©Χ Χ”Χ¨Χ©Χ™ΧΧ”. ΧΧΆΧ™Χ ΧΧ Χ’Χ Χ•Χ pipeline Χ›Χ Χ©Χ‘ΧΧ§Χ•Χ Χ©Χ›Χ thread Χ™Χ¦ΧΧ¨Χ ΧΧΧ¦Χ•Χ Χ”Χ™Χ›Χ ΧΧΧ§Χ ΧΧ Χ”ΧΆΧ¨Χ Χ©ΧΧ• Χ‘Χ¨Χ©Χ™ΧΧ” Χ›Χ“Χ™ ΧΧΧ¤Χ©Χ¨ Χ thread Χ”Χ‘Χ ΧΧ¨Χ•Χ¥, Χ”Χ•Χ Χ—Χ•Χ΅Χ Χthreads ΧΧ—Χ¨Χ™Χ Χ¨Χ§ ΧΧ Χ¨Χ©Χ™ΧΧ” Χ™ΧΧ Χ™Χ Χ•ΧΧΧ¤Χ©Χ¨ ΧΧ”Χ ΧΧΆΧ‘Χ•Χ“ ΧΆΧ Χ”Χ©ΧΧΧΧ™Χ ΧΆΧ“ Χ©Χ”Χ•Χ ΧΧ΅Χ™Χ™Χ.

```C
void sorted_insert(node_t *head, int val) {
    /* Signal start of search */
    omp_set_lock(head->lock);

    /* Find the right place to insert */
    node_t *ptr = head->next;
    node_t *prev = head;

    while (ptr != NULL && ptr->value < val) {
        omp_set_lock(ptr->lock);
        omp_unset_lock(prev->lock);
        prev = ptr;
        ptr = ptr->next;
    }

    /* Insert the new node */
    node_t *new_node = malloc(sizeof(node_t));
    new_node->value = val;
    new_node->next = ptr;
    new_node->lock = malloc(sizeof(omp_lock_t));
    omp_init_lock(new_node->lock);
    prev->next = new_node;
    omp_unset_lock(prev->lock);
}
```

Χ›ΧΆΧ ΧΧ›Χ ΧΧ™Χ‘Χ¨ Χ‘Χ¨Χ©Χ™ΧΧ” Χ™Χ© ΧΧ ΧΆΧ•Χ ΧΧ©ΧΧ•. Χ›Χ thread Χ©Χ Χ›Χ Χ΅ Χ Χ•ΧΆΧ ΧΧ Χ”ptr Χ©ΧΆΧΧ™Χ• Χ”Χ•Χ Χ›Χ¨Χ’ΧΆ Χ ΧΧ¦Χ Χ‘Χ¨Χ©Χ™ΧΧ” Χ•ΧΧ©Χ—Χ¨Χ¨ ΧΧ Χ”Χ§Χ•Χ“Χ Χ•Χ›Χ›Χ” Χ”Χ•Χ ΧΧΧ©Χ™Χ.  

### V3 
Χ”Χ’Χ¨Χ΅Χ” Χ”Χ©ΧΧ™Χ©Χ™Χ Χ©Χ ΧΧΧ™Χ›Χ” Χ‘ΧΧ§Χ‘Χ™ΧΧ™Χ•Χ Χ©Χ sorted_insert ΧΧΆΧ‘Χ•Χ“ Χ‘ΧΧ•Χ¤Χ Χ”Χ‘Χ-

Χ ΧΧ¤Χ©Χ¨ Χthreads ΧΧΧ¦Χ•Χ ΧΧ ΧΧ™Χ§Χ•Χ Χ”ptr Χ©ΧΧ—Χ¨Χ™Χ• ΧΧΧ•Χ¨ ΧΧ”Χ›Χ Χ΅ Χ”Χ§Χ•Χ“Χ§Χ•Χ“ Χ”Χ—Χ“Χ© Χ‘Χ¦Χ•Χ¨Χ” ΧΧ§Χ‘Χ™ΧΧ™Χ Χ‘ΧΧ™ ΧΧ Χ’Χ Χ•Χ Χ΅Χ Χ›Χ¨Χ•Χ.
Χ‘Χ¨Χ’ΧΆ Χ©thread Χ›ΧΧ©Χ”Χ• ΧΧ¦Χ ΧΧ Χ”ptr Χ”Χ–Χ”, Χ”Χ•Χ ΧΧ Χ΅Χ” ΧΧ ΧΆΧ•Χ ΧΧ Χ”ΧΧ¦Χ‘Χ™ΧΆ prev , Χ–Χ” Χ©ΧΧ¦Χ‘Χ™ΧΆ Χptr. 

Χ”Χ΅Χ™Χ‘Χ” Χ©Χ”Χ•Χ ΧΧ Χ΅Χ” ΧΧ ΧΆΧ•Χ ΧΧ•ΧΧ• Χ”Χ™Χ Χ‘Χ’ΧΧ Χ©Χ™Χ›Χ•Χ ΧΧ”Χ™Χ•Χ Χ©ΧΧ•Χ Χ›Χ“Χ™ Χ”Χ—Χ™Χ¤Χ•Χ© Χ©Χ Χ”ptr Χ§Χ¨Χ” ΧΧ¦Χ‘ Χ© threads ΧΧ—Χ¨Χ™Χ Χ”Χ•Χ΅Χ™Χ¤Χ• ΧΆΧ¨Χ›Χ™Χ Χ‘Χ™Χ prev Χ ptr Χ•Χ›ΧΆΧ Χ”ΧΧ¦Χ‘ Χ›Χ‘Χ¨ ΧΧ ΧΆΧ“Χ›Χ Χ™. 

ΧΧ Χ–Χ” ΧΧ¤Χ©Χ¨ ΧΧΆΧ©Χ•Χ ΧΆΧ Χ™Χ“Χ™ Χ”Χ©Χ•Χ•ΧΧ” Χ‘Χ™Χ Χ”ptr ΧΧ‘Χ™Χ prev.next . ΧΧ thread ΧΧ—Χ¨ Χ”Χ•Χ΅Χ™Χ£ ΧΧ™Χ‘Χ¨ Χ‘Χ™Χ prev Χ ptr Χ”Χ”Χ©Χ•Χ•ΧΧ” Χ”Χ–ΧΧ ΧΧ’ΧΧ” ΧΧ Χ• ΧΧ Χ–Χ”. Χ‘ΧΧ¦Χ‘ Χ–Χ” ΧΧ Χ—Χ Χ• ΧΧ‘Χ¦ΧΆΧ™Χ Χ‘Χ™Χ“Χ™Χ•Χ§ ΧΧ ΧΧ•ΧΧ• Χ”Χ§Χ•Χ“ Χ‘Χ’Χ¨Χ΅Χ” v2 Χ¨Χ§ Χ©Χ”Χ¤ΧΆΧ Χ–Χ” Χ›Χ Χ¨ΧΧ” Χ™Χ”Χ™Χ” ΧΆΧ ΧΧ Χ¨Χ©Χ™ΧΧ” ΧΧ¦Χ•ΧΧ¦ΧΧ Χ‘Χ”Χ¨Χ‘Χ”. 

ΧΧ‘Χ΅Χ•Χ£ ΧΧ‘Χ¦ΧΆΧ™Χ Χ”Χ›Χ Χ΅Χ” Χ©Χ Χ”ΧΆΧ¨Χ Χ”Χ—Χ“Χ© ΧΧ¨Χ©Χ™ΧΧ”.

```C
void sorted_insert(node_t *head, int val) {
    /* Find the right place to insert */
    node_t *ptr = head->next;
    node_t *prev = head;

    while (ptr != NULL && ptr->value < val) {
        prev = ptr;
        ptr = ptr->next;
    }

    /* Lock the elment that may be modified */
    omp_set_lock(prev->lock);

    /* Confirm that the element is still in the right place */
    if (prev->next != ptr) {
        ptr = prev->next;
        while (ptr != NULL && ptr->value < val) {
            omp_set_lock(ptr->lock);
            omp_unset_lock(prev->lock);
            prev = ptr;
            ptr = ptr->next;
        }
    }

    /* Insert the new node */
    node_t *new_node = malloc(sizeof(node_t));
    new_node->value = val;
    new_node->next = ptr;
    new_node->lock = malloc(sizeof(omp_lock_t));
    omp_init_lock(new_node->lock);
    prev->next = new_node;
    omp_unset_lock(prev->lock);
}
```

