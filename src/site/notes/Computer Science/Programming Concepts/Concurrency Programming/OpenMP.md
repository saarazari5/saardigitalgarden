---
{"dateCreated":"2024-02-22 14:51","tags":["concurrency"],"pageDirection":"rtl","dg-publish":true,"permalink":"/computer-science/programming-concepts/concurrency-programming/open-mp/","dgPassFrontmatter":true}
---

# OpenMP
OpenMP API ×”×•× ××•×¡×£ ×›×œ×™× ×©×××¤×©×¨×™× ×ª×›× ×•×ª ××§×‘×™×œ×™ ×‘×©×¤×ª c ×• cpp ×•×©×¤×•×ª × ×•×¡×¤×•×ª.
[[pthreads\|pthreads]] ×”×•× ×¢×“×™×™×Ÿ ×”×›×œ×™ ×”×¢×“×™×£ ××‘×—×™× ×ª ×‘×™×¦×•×¢×™× ×•×’××™×©×•×ª. ×¢× ×–××ª, ××‘×—×™× ×ª ×¨××ª ×”××‘×¡×˜×¨×§×¦×™×™×” ×•×”× ×•×—×•×ª ×œ××ª×›× ×ª ×¢× ×‘×™×¦×•×¢×™× ×˜×•×‘×™× ×¢×‘×•×¨ ×”×¨×‘×” ×ª×‘× ×™×•×ª ×¢×™×¦×•×‘ ××§×‘×™×œ×™×•×ª. ×‘×›×œ ××§×¨×”, × ×™×ª×Ÿ ×œ×›×ª×•×‘ ×§×•×“ ×©××©×œ×‘ ×‘×™×Ÿ ×”×©× ×™×™×. 

OpenMP ××ª×œ×‘×©×ª ×¢×œ ×›××” ×©×›×‘×•×ª ×‘ software stack, ××¨×›×™×‘×™× ×‘×¡×™×¡×™×™× ×©×œ OpenMP ×”× compiler directives, OpenMP library ×•- environment variables.

![Pasted image 20240222150516.png|350](/img/user/Assets/Pasted%20image%2020240222150516.png)

× ×¡×ª×›×œ ×¢×œ ×§×•×“ hello world ×œ×“×•×’××” ×‘ OpenMP:

```C
#include <omp.h>
#include <stdio.h>

int main() {
	#pragma omp parallel
		{
			printf(" hello ");
			printf(" world\n ");
		}
	return 0;
}
```

×”×©×•×¨×” `pragma omp parallel` ×”×™× ×”× ×—×™×•×ª ×œ×§×•××¤×™×™×œ×¨. 

×”×‘×œ×•×§ ×‘×¤× ×™× ×—×™×™×‘ ×œ×”×™×•×ª ×¢× ×©×•×¨×ª ×›× ×™×¡×” ××—×ª ×•×©×•×¨×ª ×™×¦×™××” ××—×ª. ×”×‘×œ×•×§ ×©×‘×¤× ×™× × ×§×¨× parallel region.

× ×‘×—×Ÿ ××ª ×¤×œ×˜ ×”×ª×•×›× ×™×ª:
![Pasted image 20240222151243.png|200](/img/user/Assets/Pasted%20image%2020240222151243.png)×¨××©×™×ª, × ×©×™× ×œ×‘ ×©×§×™××¤×œ× ×• ×¢× ×”×“×’×œ fopenmp.
×–×” ×“×’×œ ×©××•××¨ ×œgcc ×œ×”×ª×™×™×—×¡ ×œdirectives ×©×”×’×“×¨× ×• ×‘×§×•×“ (×‘××§×¨×” ×”×–×” ×”×©×•×¨×” pragma omp parallel). 

× ×ª× ×• ×”×•×¨××” ×œ- gcc ×œ×”×¨×™×¥ ××ª ×”×§×•×“ ×©×‘- block ×‘××§×‘×™×œ ×¢× ××¡×¤×¨ default ×©×œ threads, ×©×©×•×•×” (×‘×“×¨×š ×›×œ×œ) ×œ××¡×¤×¨ cores ×©×™×© ×‘××—×©×‘. ×œ×›×Ÿ ×”×§×•×“ ××ª×‘×¦×¢ ×‘××§×‘×™×œ ×¢"×™ 4 threads ×•×× ×—× ×• ×¨×•××™× 4 ×”×“×¤×¡×•×ª ×©×œ hello world.

* × ×©×™× ×œ×‘ ×©×‘×¡×•×£ ×” pragma block ×”×§×•××¤×™×™×œ×¨ ××•×¡×™×£ wait ××•×˜×•××˜×™, ×›×œ×•××¨ ×¨×§ ××—×¨×™ ×©×›×œ ×”threads ××¡×™×™××™× ××ª ×”×‘×œ×•×§, ×”×§×•×“ ×™××©×™×š ×œ×¨×•×¥ ×œ×›×œ ×©××¨ ×”×§×•×“ ×©××—×•×¥ ×œ×‘×œ×•×§.


>[!info] CPU Info
>×›×“×™ ×œ×§×‘×œ ××™×“×¢ ××¤×•×¨×˜ ×¢×œ ××¨×›×™×˜×§×˜×•×¨×ª ×”××—×©×‘ ×©×‘×¨×©×•×ª× ×• × ×•×›×œ ×œ×”×©×ª××© ×‘×¤×§×•×“×ª lscpu. ×× × ×¨×¦×” ×¨×§ ××ª ××¡×¤×¨ ×”×œ×™×‘×•×ª × ×©×ª××© ×‘×¤×§×•×“×ª nproc 
>![Pasted image 20240222172229.png](/img/user/Assets/Pasted%20image%2020240222172229.png)
>

__num of threads:__
×›×“×™ ×œ×”×’×“×™×¨ ×›××” threads × ×¨×¦×” ×›×“×™ ×œ×”×¨×™×¥ ×§×˜×¢ ×§×•×“ ××§×‘×™×œ×™ × ×©×ª××© ×‘×¤×§×•×“×” omp_set_num_threads(n) ×œ×¤× ×™ ×¤×ª×™×—×ª ×”×‘×œ×•×§.

×›×“×™ ×œ×§×‘×œ ××ª ×”××–×”×” ×©×œ ×›×œ thread × ×¨×™×¥ ××ª ×”×¤×§×•×“×” omp_get_thread_num .

×‘××•×¤×Ÿ ×¡×›××ª×™ ××¤×©×¨ ×œ×ª××¨ ×ª×•×›× ×™×ª ×”××©×ª××©×ª ×‘ pragma ×‘××•×¤×Ÿ ×”×‘×-
![Pasted image 20240308141508.png](/img/user/Assets/Pasted%20image%2020240308141508.png)

* × ×™×ª×Ÿ ×œ×¨××•×ª ×©× ×™×ª×Ÿ ×œ×”×›× ×™×¡ parallel regions ×‘×ª×•×š parallel regions ×‘×¢×ª ×”×¦×•×¨×š
* ×›×œ ×ª×”×œ×™×š ××§×‘×™×œ×™ ××—×›×” ×©×›×œ ×”threads ×‘×ª×•×›×• ×™×¡×™×™××• ×›×“×™ ×œ×”××©×™×š ×‘×—×œ×§ ×”×¡×“×¨×ª×™ ×©×œ ×” main thread .
* ×›×“××™ ×œ×©×™× ×œ×‘ ×© omp ×¢×œ×•×œ ×œ×™×™×¦×¨ ×¤×—×•×ª threads ×××” ×©×¨×¦×™× ×•.
* ×”×¡×›××” ×”××ª×•××¨×ª × ×§×¨××ª [Fork-Join parallelism](https://en.wikipedia.org/wiki/Fork%E2%80%93join_model)

__Fork-Join parallelism:__
×§×˜×¢×™× ××¡×•×™××™× ××”×§×•×“ ×××•×§×‘×œ×™×, ×§×˜×¢ ×§×•×“ ××§×‘×™×œ×™ ×”×‘× ××ª×—×™×œ ×¨×§ ×›××©×¨ ×§×˜×¢ ×§×•×“ ××§×‘×™×œ×™ ×”×§×•×“× ×œ×• ××¡×ª×™×™×. ×”×”× ×—×” ×©×œ ×©×™×˜×” ×–×• ×”×™× ×©×”×ª×•×›× ×™×ª ××ª×—×™×œ×” ×thread ×™×—×™×“ ×©× ×§×¨× master thread ××• main ×•××× ×• ×™×•×¦××™× ×›×œ ×”×§×˜×¢×™× ×”××§×‘×™×œ×™×™×.

![Pasted image 20240308220651.png](/img/user/Assets/Pasted%20image%2020240308220651.png)

## ×—×™×©×•×‘ Euler Mascheroni constant
× ×¨××” ××™×š ××—×©×‘×™× ×‘××•×¤×Ÿ ×¡×“×¨×ª×™ ×•×¢× OMP ××ª ×”× ×•×¡×—×” ×©×œ [×§×‘×•×¢ ××•×™×œ×¨](https://en.wikipedia.org/wiki/Euler%27s_constant) 

$$\lim_{ n \to \infty } \log(n) - \sum^{n}_{i=1} \frac{1}{i} \approx -0.577216 $$

×”×—×™×©×•×‘ ×‘×¦×•×¨×” ×¡×“×¨×ª×™×ª ×”×•× ×¤×©×•×˜ 

```C 
double seq_euler_mascheroni() {
	double sum = 0;

	for( int i = 1; i < N; i ++){
		sum+= 1.0/i;
	}

	return log(N) - sum;
}
```

×›×¢×ª × ×©×•×•×” ×œ×’×¨×¡×” ×”××§×‘×™×œ×™×ª 

```C
double sum = 0;

#pragma omp_parallel 
{
	const int num_threads = omp_get_num_threads();

	double thread_sum = 0;
	int tid = omp_get_thread_num + 1;

	for(int i= tid; i < N; i+= num_threads) {
		threads_sum += 1.0/i;
	}

	#pragma omp critical
		sum += thread_sum
}
```

* sum ×”×•× ××©×ª× ×” ×’×œ×•×‘×œ×™
* ×›×œ thread ××—×–×™×§ ××ª ××¡×¤×¨ ×”threads ×• thread sum ×¢× ×¢×¨×š ×”×ª×—×œ×ª×™ 0
* ×›×œ thread ××—×–×™×§ ××ª ×” thread id ×©×œ×• ×›××©×¨ ×–×” ××¡×¤×¨ ×˜×‘×¢×™ ×©×’×“×œ ×‘1 ×¢×‘×•×¨ ×›×œ thread ×œ×¤×™ ×¡×“×¨ ×”×™×¦×™×¨×”
* ×›×œ ××—×“ ××”threads ××—×©×‘ ××ª ×ª×ª ×”×¡×›×•× ×©×”×•× ××ª×—×™×œ ××”××–×”×” ×©×œ ×”threads ×•×§×•×¤×¥ ×‘ num of threads ×¢×“ ×©××’×™×¢ ×œ××¡×¤×¨ ×”×™×¢×“ N
* ×›×¢×ª ××’×“×™×¨×™× ×œ×§×•××¤×™×™×œ×¨ ×§×˜×¢ ×§×•×“ ×§×¨×™×˜×™ ×©×¡×•×›× ××ª ×”××™×“×¢ ×œ××©×ª× ×” ×”×’×œ×•×‘×œ×™.


×× × ×‘×¦×¢ benchmark ×‘×××¦×¢×•×ª ×”×¤×•× ×§×¦×™×” `omp_get_wtime` × ×§×‘×œ ×–××Ÿ ×¨×™×¦×” ×©××©××¢×•×ª×™×ª ×™×•×ª×¨ ××”×™×¨ ×‘××œ×’×•×¨×™×ª× ×”××§×‘×™×œ×™ 

![Pasted image 20240308150356.png](/img/user/Assets/Pasted%20image%2020240308150356.png)

## False sharing
× ×¡×ª×›×œ ×¢×œ ×§×•×“ ×¡×“×¨×ª×™ ×•××§×‘×™×œ×™ ×œ×¡×›×™××ª ××¢×¨×š 

![Pasted image 20240308151108.png|350](/img/user/Assets/Pasted%20image%2020240308151108.png)
![Pasted image 20240308151057.png|350](/img/user/Assets/Pasted%20image%2020240308151057.png)

×”××œ×’×•×¨×™×ª× ×”××§×‘×™×œ×™ ××—×©×‘ ××ª ×”×¡×›×•××™× ×”×—×œ×§×™×™× ×•×œ×‘×¡×•×£ ××—×‘×¨ ××ª ×”×›×œ ×‘×™×—×“. × ×©×™× ×œ×‘ ×©×”×•× ××©×ª××© ×¤×” ×‘×¤×§×•×“×ª omp single ×©×–××ª ×¤×§×•×“×” ×©×××¤×©×¨×ª ×¨×§ ×œthread ××—×“ ×œ×”×›× ×¡ ××œ×™×• ×•×œ××—×¨ ××›×Ÿ ×œ× ××›× ×™×¡×” ×™×•×ª×¨ threads ×œ×§×˜×¢ ×”×§×•×“ ×”×–×” (×× ×œ× ×”×™×™× ×• ××©×ª××©×™× ×‘ OpenMP ×œ×›×ª×•×‘ ×“×‘×¨ ×›×–×” ×”×™×” ×“×•×¨×© ×× ×’× ×•×Ÿ ××©×œ× ×•). ×”×©×™××•×© ×‘×¤×§×•×“×” ×–××ª ×”×™× ×˜×•×‘×” ×›××©×¨ × ×¨×¦×” ×œ×”×–×™×Ÿ ×¤×¨××˜×¨ ×¨×§ ×¤×¢× ××—×ª ×‘××§×¨×” ×”×–×” thread_num ×”×•× ×”×¤×¨××˜×¨ ×”×–×”.

×× × ×‘×“×•×§ ××ª ×ª×•×¦××•×ª ×”×”×¨×¦××” ×¢×‘×•×¨ ××¢×¨×›×™× ×’×“×•×œ×™× ×‘××™×•×—×“ × ×§×‘×œ
![Pasted image 20240308151300.png](/img/user/Assets/Pasted%20image%2020240308151300.png)
×›×œ×•××¨ ×× ×—× ×• ×¨×•××™× ×©×–×× ×™ ×”×”×¨×¦×” ×”××§×‘×™×œ×™×™× ×’×¨×•×¢×™× ×™×•×ª×¨ ××”×¡×“×¨×ª×™×™×.

×–×” ×™×›×•×œ ×œ× ×‘×•×¢ ××›××” ×¡×™×‘×•×ª:
	1) overhead 
	2) [[Computer Science/Computer System/Computer System Cache Memory\|cache]]- ×œ×›×œ thread ×©×¨×¥ ×¢×œ ××¢×‘×“ ××—×¨ ×™×© L1 cache ××©×œ×•. × ×–×›×™×¨ ×©×›××©×¨ ×§×•×¨××™× ××™×“×¢ ××”×–×›×¨×•×Ÿ ×•×©××™× ×‘ cache ×©××™× ×’× ××ª ×”××™×“×¢ ××¡×‘×™×‘ ×‘××•×ª×• cache line ×›×“×™ ×œ×©××•×¨ ×¢×œ ×œ×•×§×œ×™×•×ª ×’×‘×•×”×”. ×‘×ª×›× ×•×ª ××§×‘×™×œ×™ multicore ×›××©×¨ thread ××©× ×” ××ª ×”cache ×‘××¢×‘×“ ×©×œ×•, ×”×—×•××¨×” ××•×“×™×¢×” ×œ×©××¨ ×”××¢×‘×“×™× ×©×”cache ×”×©×ª× ×” ×•××ª×¨×—×© cache invalidation ××” ×©×’×•×¨× ×œ×›×œ L1 cache ×©×œ ×”threads ×œ×’×©×ª ×©×•×‘ ×œRAM ×¢×œ ×›×œ ×¤×¢×•×œ×ª ×—×™×‘×•×¨ ××” ×©×™×•×¦×¨ ×—×•×¡×¨ × ×™×¦×•×œ ×©×œ ×”cache .


__××” ×”×¤×ª×¨×•×Ÿ?__
× ×•×›×œ ×œ×©× ×•×ª ××ª Partial sum ×œ×¢×‘×•×¨ ×¢× ××¢×¨×š ×“×• ××™××“×™ ×•×›×œ threads ×™×§×‘×œ ×©×•×¨×” ××©×œ×• ×•×›×›×” ×œ× ×™×”×™×” ××¦×‘ ×©threads ×“×•×¨×¡×™× ××ª ×”lines ××—×“ ×©×œ ×”×©× ×™.

![Pasted image 20240308152659.png](/img/user/Assets/Pasted%20image%2020240308152659.png)

× ×™×ª×Ÿ ×œ×¨××•×ª ×©×–×” ××›×Ÿ ××©×¤×¨ ××©××¢×•×ª×™×ª ××ª ×”×‘×™×¦×•×¢×™× ×©×œ ×ª×•×›× ×™×ª ××§×‘×™×œ×™×ª
![Pasted image 20240308152712.png](/img/user/Assets/Pasted%20image%2020240308152712.png)

## PI Approximation 
×× ×—× ×• ×™×•×“×¢×™× ×©××ª×§×™×™×

$$\int_{0}^{1} \, \frac{4.0}{1+x^{2}}dx = \pi $$

×›×œ×•××¨ × ×•×›×œ ×œ×§×‘×œ ×§×™×¨×•×‘ ×©×œ $\pi$ ×‘×××¦×¢×•×ª ×—×™×©×•×‘ ×©×œ [[Computer Science/Calculus/The Integral\|×”××™× ×˜×’×¨×œ]] ×›×¡×›×•× ×©×œ N ×©×˜×—×™ ××œ×‘× ×™× 

$$\sum_{i=0}^{n} F(x_{i})\cdot \Delta x\approx \pi$$

![Screenshot 2024-03-08 at 17.55.15.png|300](/img/user/Assets/Screenshot%202024-03-08%20at%2017.55.15.png)

× ×›×ª×•×‘ ×§×•×“ ××§×‘×™×œ×™ ×©×××¤×©×¨ ×œ× ×• ×œ×—×©×‘ ××ª ×–×” ×•× ×‘×—×Ÿ ××ª ×”×‘×™×¦×•×¢×™× ×©×œ×• ×œ×¢×•××ª ×§×•×“ ×¡×“×¨×ª×™

×”×—×™×©×•×‘ ×”××§×‘×™×œ×™ ×™×”×™×” ×“×•××” ×œ××” ×©×¢×©×™× ×• ×‘×“×•×’×××•×ª ×”×§×•×“××•×ª, ×›×œ thread ×™×‘×¦×¢ ×¡×›×•× ×—×œ×§×™ ×©×œ ×©×˜×—×™ ×”××œ×‘× ×™× ×•×œ×‘×¡×•×£ ×‘×§×˜×¢ ×§×•×“ ×¡×“×¨×ª×™ ×™×¡×›×•× ××ª ×›×œ ×”×¡×›×•××™× ×”×—×§×™×™×. ××ª ×”×¡×›×•××™× × ×™×ª×Ÿ ×œ×©××•×¨ ×‘×××¦×¢×•×ª ××¢×¨×š ×©×’×•×“×œ×• ×›××¡×¤×¨ ×”threads ×•×›×›×” ×›×œ thread ××§×‘×œ ××©×‘×¦×ª ××—×ª ×‘××¢×¨×š ××‘×œ×™ ×œ×“××•×’ ×œrace condition (×›×¤×™ ×©×”×¨×× ×•, ×–×” ×™×›×•×œ ×œ×¤×’×•×¢ ×‘×‘×™×¦×•×¢×™× ×× ×œ× ×œ×•×§×—×™× ×‘×—×©×‘×•×Ÿ ××ª ×”××˜××•×Ÿ).

![Pasted image 20240308180620.png|300](/img/user/Assets/Pasted%20image%2020240308180620.png)

×‘×ª×›× ×•×ª ××§×‘×™×œ×™ ×–×” ×™×™×¨××” ×›×›×”
```C
#include <omp.h>
#include<stdio.h>

#define N 2 // required number of threadsint main () { 
    int N_actual; // actual number of threads
Â  Â  long num_steps = 100000;
Â  Â  double sum[N] = {0};
Â  Â  double step = 1.0/(double) num_steps;

    omp_set_num_threads(N);
    #pragma omp parallel
    {
        int id = omp_get_thread_num();
        double x;
        #pragma omp single
           N_actual = omp_get_num_threads();

Â  Â      for (int i=id; i< num_steps; i+= N_actual) {
Â  Â  Â  Â      x = (i+0.5)*step;
Â  Â  Â  Â      sum[id] += 4.0/(1.0+x*x);
Â  Â      }
    }
Â  Â  double pi = 0;
    for (int i=0; i < N_actual; i++)
        pi += step * sum[i];
Â  Â  printf("%f\n", pi);
Â  Â  return 0;
}
```

×× × ××“×•×“ ×‘×™×¦×•×¢×™× × ×§×‘×œ 
![Pasted image 20240308181117.png|300](/img/user/Assets/Pasted%20image%2020240308181117.png)

× ×™×ª×Ÿ ×œ×¨××•×ª ×©×”×—×œ × N=3 ×™×© ×™×¨×™×“×ª ×‘×™×¦×•×¢×™×. ×”×¡×™×‘×” ×œ×›×š ×”×™× ××›×™×•×•×Ÿ ×©×‘××¢×‘×“ ××—×“ ×™×© ×›××” ×œ×™×‘×•×ª ×•×‘×›×œ ×œ×™×‘×” × ×™×ª×Ÿ ×œ×”×¨×™×¥ ××¡×¤×¨ HW threads (×‘×“×´×› 2) ×•××—×“ ×”×¤×ª×¨×•× ×•×ª ×”×—×•××¨×ª×™×™× ×©×™×© ×œ××¢×‘×“×™× __××¨×•×‘×™ ×œ×™×‘×•×ª__ ×”×•× ×©×‘×¨×’×¢ ×©×™×© ×©× ×™ cores ×¢×œ ××•×ª×” ×ª×•×›× ×™×ª ×•×” L1 cache ×©×œ ××—×“ ××”× ××©×ª× ×” , ×”×•× ××•×“×™×¢ ×œL1 cache ×©×œ ×”××—×¨×™× ×©×”× invalid ×•×¢×œ×™×”× ×œ×¢×“×›×Ÿ ××ª ×”××˜××•×Ÿ ×©×œ×”×.

× ×™×§×— ×‘×™×¦×•×¢ ×©×œ ××¨×‘×¢×” threads . ××›×™×•×•×Ÿ ×©×›×œ core ××›×™×œ ×©× ×™ HR (Hardware threads), ×”×•× ×™×›×•×œ ×œ×”×¨×™×¥ ×©× ×™ threads. ××¨×‘×¢×” threads ×™×¨×•×¦×• ×¢×œ ×©× ×™ cores ×©×•× ×™×. ×œ×›×œ core ×™×© L1 cache ×¤×¨×˜×™ ××©×œ×•. ×›××©×¨ thread0 ×¨×•×¦×” ×œ×¢×“×›×Ÿ $sum[0]$, ×—×œ×§ ×©×œ RAM ×‘×’×•×“×œ cache line (×‘×’×•×“×œ 64 bites ×¢×‘×•×¨ 64-bit architecture) ××•×‘× ×œ- L1 cache ×©×œ core ××©×¨ ××¨×™×¥ ××ª thread1. 

![Pasted image 20240308182134.png|300](/img/user/Assets/Pasted%20image%2020240308182134.png)

×›××©×¨ thread2 ×¨×•×¦×” ×œ×¢×“×›×Ÿ $sum[2]$, ×—×œ×§ ×©×œ RAM ×‘×’×•×“×œ cache line ××•×‘× ×œ- L1 cache ×©×œ core ××©×¨ ××¨×™×¥ ××ª thread2. × ×©×™× ×œ×‘ ×©×©× ×™ cache lines ××›×™×œ×•×ª ××ª ×”××¢×¨×š ×©×œ×•. ×‘×¨×’×¢ ×©- thread2 ××‘×¦×¢ ×¢×“×›×•×Ÿ ×©×œ $sum[2]$, ×”- cache line ×”×–×” ×‘- L1 cache of Core1 ××¡×•××Ÿ ×›- invalid, ×›×œ×•××¨, ×œ× ×œ×©×™××•×©. ×–×” ××›×™×•×•×Ÿ ×©×”×•× ××›×™×œ data ×œ× ×¢×“×›× ×™. ×›××©×¨ thread0 ×™×¨×¦×” ×œ×¢×“×›×Ÿ ×©×•×‘ ×¤×¢× ××ª $sum[0]$, ×”×•× ×™×¦×˜×¨×š ×œ×‘×¦×¢ ×’×™×©×” ×œ- RAM ×›×“×™ ×œ×”×‘×™× ××ª ×”- cache line ××—×“×©.

![Pasted image 20240308182644.png|300](/img/user/Assets/Pasted%20image%2020240308182644.png)

×”×¤×ª×¨×•×Ÿ ×”×•× ×”×§×¦××” ×©×œ ××¢×¨×š ×“×• ××™××“×™ ×©×ª×× ×¢ ×—×¤×™×¤×” ×‘×™×Ÿ cache lines ×©×œ threads ×©×•× ×™×. ××•×× ×, ×–×” ×‘×–×‘×•×– ×–×›×¨×•×Ÿ RAM, ××‘×œ ×–×›×¨×•×Ÿ ×”×•× ××“×“ ××©× ×™ ×œ×¢×•××ª ×–××Ÿ ×¨×™×¦×”.

```C
#include <omp.h>
#include<stdio.h>

#define N 2 // required number of threads
#define PAD 8 // assume 64-byte L1 cache line size
int main () { 
    int N_actual; // actual number of threads
Â  Â  long num_steps = 100000000;
Â  Â  double sum[N][PAD] = {{0}};
Â  Â  double step = 1.0/(double) num_steps;

    double tdata = omp_get_wtime();
    omp_set_num_threads(N);
    #pragma omp parallel
    {
        int id = omp_get_thread_num();
        double x;
        #pragma omp single
           N_actual = omp_get_num_threads();

Â  Â      for (int i=id; i< num_steps; i+= N_actual) {
Â  Â  Â  Â      x = (i+0.5)*step;
Â  Â  Â  Â      sum[id][0] += 4.0/(1.0+x*x);
Â  Â      }
    }
Â  Â  double pi = 0;
    for (int i=0; i < N_actual; i++)
        pi += step * sum[i][PAD];
    tdata = omp_get_wtime() - tdata;
    printf("pi = %f in %f secs\n", pi, tdata);
Â  Â  return 0;
}
```

×›×™×•×•×Ÿ ×©×›×œ thread ×¢×•×‘×“ ×¢×œ ×©×•×¨×” ×©×œ×• ×‘××¢×¨×š ×‘×”×ª×× ×œ id, ×œ×›×Ÿ ××™×Ÿ ×©×•×¨×•×ª cache ××©×•×ª×¤×•×ª.

![Pasted image 20240308183013.png|300](/img/user/Assets/Pasted%20image%2020240308183013.png)

×”×–××Ÿ ×¨×™×¦×” ××›×Ÿ ×”×©×ª×¤×¨ ×’× ×¢×‘×•×¨ N=3,4. ×”××—×™×¨ ×©×§×™×‘×œ× ×• ×”×•× ×§×•×“ ×××•×“ ××¡×•×¨×‘×œ. × × ×¡×” ×œ×‘×—×•×Ÿ ×“×¨×›×™× × ×•×¡×¤×•×ª.

×›×œ×™ × ×•×¡×£ ×”×•× ×”×’×“×¨×ª critical section ×‘×ª×•×š ×”×§×•×“ ×”××§×‘×™×œ×™ , ×‘××§×•× ×œ×”×—×–×™×§ ××¢×¨×š ×©×œ ×¡×›×•××™× ×—×œ×§×™×™× × ×•×›×œ ×œ×“××•×’ ×©×›×œ thread ×™×—×©×‘ ××ª ×”×¡×›×•× ×©×œ×• ×‘×¦×•×¨×” ××§×•××™×ª ×•×‘×§×˜×¢ ×”×§×•×“ ×”×§×¨×™×˜×™ × ×¡×›×•× ××ª ×”×ª×•×¦××” ×”×¡×•×¤×™×ª ×œ×¢×¨×š ×©×œ $\pi$ .

```C
#include <omp.h>
#include<stdio.h>

#define N 2 // required number of threadsint main () { 
Â  Â  long num_steps = 100000000;
Â  Â  double pi = 0;
Â  Â  double step = 1.0/(double) num_steps;

    double tdata = omp_get_wtime();
    omp_set_num_threads(N);
    #pragma omp parallel
    {
        int id = omp_get_thread_num();
        double x, sum = 0;
        #pragma omp single
           N_actual = omp_get_num_threads();

Â  Â      for (int i=id; i< num_steps; i+= N_actual) {
Â  Â  Â  Â      x = (i+0.5)*step;
            sum += 4.0/(1.0+x*x);
        }
Â  Â  Â  Â  #pragma omp critical
            pi += sum * step;
    }
    tdata = omp_get_wtime() - tdata;
    printf("pi = %f in %f secs\n", pi, tdata);
Â  Â  return 0;
}
```

×‘×©×™×˜×” ×–×• × ×§×‘×œ ×‘×™×¦×•×¢×™× ×“×•××™× ×œ×©×™×˜×” ×”×§×•×“××ª ×‘×§×•×“ ×™×•×ª×¨ ××¡×•×“×¨. 

## Loops 
×›××” ×›×œ×œ×™ ×œ×•×œ××•×ª ×—×©×•×‘×™× ×‘ OpenMP:
1) ×× for loop ××•×¤×™×¢ ×‘×§×˜×¢ ×§×•×“ ××§×‘×™×œ×™, ××– ×›×œ ××—×“ ××” threads ×™×‘×¦×¢ ××ª ×”×œ×•×œ××” ×‘××œ×•××”.
```C
#include <omp.h>
#include<stdio.h>

int main () { 
    #pragma omp parallel
    {
        for(int i=0; i<2; i++)
            printf("i=%d, ID=%d\n", i, omp_get_thread_num());
    }
    return 0;
}

```
2) ×× ×¨×•×¦×™× ×œ×‘×¦×¢ ×œ×•×œ××” ×¤×¢× ××—×ª ×‘×œ×‘×“, ××‘×œ ×œ×—×œ×§ ××•×ª×” ×œ×—×œ×§×™× ×›×š ×©×›×œ ×—×œ×§ ×™×ª×‘×¦×¢ ×¢×œ ×™×“×™ thread ××—×¨ ××– × ×™×ª×Ÿ ×œ×”×©×ª××© ×‘pragma omp for ×‘×ª×•×š parallel block ××• pragma omp parallel for. 

```C
#include <omp.h>
#include<stdio.h>

int main () { 
    #pragma omp parallel
    {
          #pragma omp for
            for(int i=0; i<2; i++)
                printf("i=%d, ID=%d\n", i, omp_get_thread_num());
    }
    return 0;
}

//or use:
int main () { 
    #pragma omp parallel for
     for(int i=0; i<2; i++)
        printf("i=%d, ID=%d\n", i, omp_get_thread_num());
  
    return 0;
}
```

× ×©×™× ×œ×‘ ×©×‘×“×•×’××ª ×”×§×•×“ ×”××—×¨×•×Ÿ × ×§×‘×œ 2 threads ×•×œ× 4 ×›××• ×‘×¨×•×‘ ×”××§×¨×™× ×”×“×™×¤×•×œ×˜×™× ×‘×’×œ×œ ×©×”×§×•××¤×™×™×œ×¨ + ××¢×¨×›×ª ×”×”×¤×¢×œ×” ×”×—×œ×™×˜×• ×œ×”×§×¦×•×ª ×¤×—×•×ª ×××” ×©×”×•× ×™×›×•×œ ×›×™ ××¡×¤×¨ ×”××™×˜×¨×¦×™×•×ª ×”×•× 2.

### Nested loops
×›××©×¨ ×™×© nested loop ×©×›×ª×•×‘ ×‘×ª×•×š ×‘×œ×•×§ ××§×‘×™×œ×™, ×¨×§ ×”×œ×•×œ××” ×”×—×™×¦×•× ×™×ª ×ª×ª××§×‘×œ. 

![Pasted image 20240308213755.png|350](/img/user/Assets/Pasted%20image%2020240308213755.png)

×–××ª __×”×”×ª× ×”×’×•×ª ×”×“×™×¤×•×œ×˜×™×‘×™×ª__ ×× × ×¨×¦×” ×œ×©× ×•×ª ××•×ª×” × ×•×›×œ ×œ×”×©×ª××© ×‘××™×œ×” ×”×©××•×¨×” collaps(#loops). ×–×” ××•××¨ ×œ×§×•××¤×™×™×œ×¨ ×©×× ×—× ×• ×¨×•×¦×™× ×œ××§×‘×œ ××ª ×›×œ ×”×œ×•×œ××•×ª ×”×¤× ×™××™×•×ª ×¢×“ ×”×¨××” ×©×”×™× ×”××¡×¤×¨ ×©×”×¢×‘×¨× ×• 

![Pasted image 20240308214014.png|350](/img/user/Assets/Pasted%20image%2020240308214014.png)

×‘××§×¨×” ×–×”, ×›×œ thread ×‘×™×¦×¢ ××™×˜×¨×¦×™×” ××—×ª. × ×©×™× ×œ×‘ ×©×‘×§×•×“ ×–×” ×‘× ×™×’×•×“ ×œ×§×•×“× ×œ× ×¤×’×¢× ×• ×‘×¨××ª ×”××§×‘×™×œ×™×•×ª ×•×’× ×œ× ×‘× ×›×•× ×•×ª ×©×œ ×”×§×•×“. 

__End of loop barrier:__
× ×©×™× ×œ×‘ ×©×™×© barrier ×œ× ××¤×•×¨×© ×‘×¡×•×£ ×œ×•×œ××ª for ××§×‘×™×œ×™×ª. ×›×œ×•××¨ threads ×™×—×›×• ×‘×¡×•×£ ×”×œ×•×œ××” ×œ×©××¨ ×”threads ×©×¨×¦×™× ×©×™×¡×™×™××• ××ª ×”×œ×•×œ××” ×’× ×›×Ÿ. 

![Pasted image 20240308214542.png|350](/img/user/Assets/Pasted%20image%2020240308214542.png)

× ×™×ª×Ÿ ×œ×¨××•×ª ×œ×¤×™ ×”×”×“×¤×¡×” ×©×›×œ ×”threads ×—×™×›×• ×¢×“ ×©×›×•×œ× ×™×¡×™×™××• ××ª ×”×œ×•×œ××” ×•×¨×§ ××– ×”×ª×—×™×œ×• ×‘×”×“×¤×¡×”.

×× × ×¨×¦×” ×œ×”×•×¨×™×“ ××ª ×”×œ×•×’×™×§×” ×”×–××ª, × ×•×›×œ ×œ×”×•×¡×™×£ ××ª ××™×œ×ª ×”××¤×ª×— ×œ×™×“ ×”×¦×”×¨×ª ×”parallel for ×©× ×§×¨× nowait. ×‘×¨×’×¢ ×©××•×¡×™×¤×™× ××ª ×”××™×œ×” ×”×–×• ××– ×”×§×•××¤×™×œ×¨ ×œ× ×™×¦×™×‘ ××—×¡×•× ×¡××•×™ ×”×™×›×Ÿ ×©×”×¦×”×¨× ×• (×× ×™×© ×¢×•×“ ×”×¦×”×¨×•×ª ×‘×”××©×š ××– ×©× ×œ× ×™×‘×•×˜×œ ×”××—×¡×•×).

![Pasted image 20240308214759.png|350](/img/user/Assets/Pasted%20image%2020240308214759.png)


### Reduction 
× ×¡×ª×›×œ ×¢×œ ×”×§×•×“ ×”×‘×
```C
#include <omp.h>
#include<stdio.h>

int main () { 
    int sum = 0;
    #pragma omp parallel 
    {
          #pragma omp for reduction (+:sum)
               for(int i=0; i<10; i++) {
                    sum += i;
                    printf("thread%d sum = %d\n", 
                              omp_get_thread_num(), sum);
               }
    }
    printf("sum = %d\n", sum);
    return 0;
}
```

× × ×¡×” ×œ×”×‘×™×Ÿ ××” ×§×•×¨×” ×›××Ÿ ×¢×œ ×™×“×™ ×”×ª×‘×•× × ×•×ª ×‘×”×“×¤×¡×•×ª 

![Pasted image 20240308215107.png|250](/img/user/Assets/Pasted%20image%2020240308215107.png)

* × ×™×ª×Ÿ ×œ×¨××•×ª ×©×—×œ×§ ××”threads ×§×™×‘×œ×• ×™×•×ª×¨ ××™×˜×¨×¦×™×•×ª ×××—×¨×™×.
* ×”×—×œ×•×§×” ×©×œ ××¡×¤×¨ ×”××™×˜×¨×¦×™×•×ª ×œ×›×œ threads ×”×™× ×—×œ×•×§×” _×¡×˜×˜×™×ª_ ×›×œ×•××¨ ×›×œ ×”threads ××§×‘×œ×™× ××¨××© ×‘×–××Ÿ ×§×™××¤×•×œ ××ª ××¡×¤×¨ ×”××™×˜×¨×¦×™×•×ª ×©×›×œ ××—×“ ××”× ×™×¨×™×¥. ×–×” ××ª×‘×¦×¢ ×¢×œ ×™×“×™ ×—×œ×•×§×ª ×”××™×˜×¨×¦×™×•×ª ×œ chunks ×•×›×œ thread ××§×‘×œ chunk ××ª××™×.
* × ×©×™× ×œ×‘ ×©× ×¨××” ××”×”×“×¤×¡×•×ª ×©×œ××¨×•×ª ×©×”×¢×‘×¨× ×• ×œ pragma ××ª sum ×›×¤×¨××˜×¨ ×”×•× ×©×›×¤×œ ××•×ª×• ×œ×›×œ ××—×“ ××”threads ×•×”×¤×š ××•×ª×• ×œ××©×ª× ×” ××§×•××™ ×¢×‘×•×¨ ×›×œ thread. ×›×œ×•××¨, ×›×œ ××—×“ ××”× ×—×™×©×‘ ××ª ×”×¡×›×•× ×”×—×œ×§×™ ×œ×¤×™ ×”××™×˜×¨×¦×™×•×ª ×©×”×•× ×§×™×‘×œ.
* ×¨×§ ×œ×‘×¡×•×£ ×›××©×¨ ×™×•×¦××™× ××”×‘×œ×•×§ sum ×”×—×™×¦×•× ×™ ×§×™×‘×œ ××ª ×”×¢×¨×š ×”××ª×§×‘×œ ××—×™×‘×•×¨ ×›×œ ×”×¡×›×•××™× ×”×—×œ×§×™×™×.

_×× ×›×Ÿ, ××”×• ×”×›×œ×™ reduction?_
×”×›×œ×™ ×”×–×” ××§×‘×œ ×–×•×’ ×¡×“×•×¨ ××”×¦×•×¨×” $\text{(op:var)}$, ×›×œ ××—×“ ××”threads ××§×‘×œ ×¢×•×ª×§ ×¤×¨×˜×™ ×©×œ ××©×ª× ×” var ×©×××•×ª×—×œ×™× ×œ×¤×™ ×¡×•×’ ×¤×¢×•×œ×” op. ×œ××—×¨ ××›×Ÿ ×”×¤×¢×•×œ×” ××ª×‘×¦×¢×ª ×‘×›×œ ××™×˜×¨×¦×™×” ××§×•××™×ª ×¢×‘×•×¨ ×”thread. ×‘×¡×•×£ ×›×œ ×”××©×ª× ×™× ×”×¤×¨×˜×™×™× var ××¡×ª××›×™× ×¢×œ ×™×“×™ ×”×¤×¢×•×œ×” op ×œ×ª×•×š ×”××©×ª× ×” ×”××©×•×ª×£.

××œ×” ×”×Ÿ ×”×¤×¢×•×œ×•×ª ×”××¤×©×¨×™×•×ª ×•×¢×¨×š ×”××ª×—×•×œ ×¢×‘×•×¨×Ÿ-

![Pasted image 20240308220232.png|200](/img/user/Assets/Pasted%20image%2020240308220232.png)

× ×¨××” ×›×¢×ª ×›×™×¦×“ ×œ××§×‘×œ ××ª ×§×•×“ ×” Pi Approximation ×××§×•×“× ×‘×××¦×¢×•×ª reduction 

![Pasted image 20240309003624.png](/img/user/Assets/Pasted%20image%2020240309003624.png)
×›×¢×ª × ×™×ª×Ÿ ×œ×¨××•×ª ××™×š ×‘××™××•×© ×××•×“ × ×§×™ ×—×™×©×‘× ×• ××ª ×”×§×™×¨×•×‘ ×©×œ $\pi$ ×‘× ×™×’×•×“ ×œ×§×•×“ ×”×§×•×“× ×©×”×™×” ×××•×“ ××¡×•×¨×‘×œ ×•×œ× × ×§×™.

__Reduce with Arrays:__
![Pasted image 20240309003806.png](/img/user/Assets/Pasted%20image%2020240309003806.png)
× ×™×ª×Ÿ ×œ×‘×¦×¢ reduce ×’× ×¢×œ ××¢×¨×›×™× ×•×œ×™×™×¦×¨ ×©×›×¤×•×ª ×©×œ×”× ×œ×›×œ thread. 
## Schedule 
× ×¡×ª×›×œ ×¢×œ ×§×˜×¢ ×”×§×•×“ ×”×‘×
![Pasted image 20240308222126.png](/img/user/Assets/Pasted%20image%2020240308222126.png)
×”×œ×•×œ××” ×”×—×™×¦×•× ×™×ª ××ª×—×œ×§×ª ×©×•×•×” (×‘×™×—×¡ ×œ××¡×¤×¨ ×”××™×˜×¨×¦×™×•×ª) ×‘×™×Ÿ ××¨×‘×¢×ª ×”threads ×©× ×•×¦×¨×•. 

×”×œ×•×œ××” ×”×¤× ×™××™×ª ×”×™× ××§×•××™×ª ×œ×›×œ threads ×›×¤×™ ×©×××¨× ×•.
× ×©×™× ×œ×‘ ×©××•×× × ×”×—×œ×•×§×” ×©×œ ××¡×¤×¨ ×”××™×˜×¨×¦×™×•×ª ×©×•×•×”, ××‘×œ ×›×œ ××—×“ ××”threads ××¨×™×¥ ××¨×™×¥ ×¢× ×¢×¨×›×™ i ×©×•× ×™×. ×œ×›×Ÿ ×ª×”×™×” ×¤×” ×‘×¢×™×” ×©threads ×©××§×‘×œ×™× ××ª 3 ×”××™×˜×¨×¦×™×•×ª ×”×’×‘×•×”×•×ª ×™×•×ª×¨ ×™×‘×¦×¢×• ×™×•×ª×¨ ×¤×¢×•×œ×•×ª ×—×™×©×•×‘×™×•×ª ×××•×¤×™ ×”×’×“×¨×ª ×”×œ×•×œ××” ×”×¤× ×™××™×ª.

![Pasted image 20240308222745.png](/img/user/Assets/Pasted%20image%2020240308222745.png)

×”×”×™×’×™×•×Ÿ ×©×œ ×”×œ×•×œ××” ×”×–××ª ×¤×’×¢ ×‘ load balance ×©×›×Ÿ ×”×¢×‘×•×“×” ×œ× ××ª×—×œ×§×ª ×©×•×•×” ×‘×©×•×•×”. 

### Static Scheduling
×›×“×™ ×œ×˜×¤×œ ×‘×–×” × ×©×ª××© ×‘key work ×©× ×§×¨× schedule. ×”××™×œ×” ×”×©××•×¨×” ×”×–×• ××§×‘×œ ×›×¤×¨××˜×¨ ××ª ××•×¤×™ ×”×”×§×¦××” (static ××• dynamic ×•×™×© ×’× × ×•×¡×¤×™×) ×•×¤×¨××˜×¨ × ×•×¡×£ ×©×”×•× ××¡×¤×¨ ×©×§×•×‘×¢ ×´×›××” ××™×˜×¨×¦×™×•×ª × ×¨×¦×” ×œ×”×§×¦×•×ª ×œ×›×œ thread ×¢×‘×•×¨ ×¨×™×¦×” ××—×ª ×œ×¤× ×™ ×©×”×•× ×´××—×œ×™×£×´ ×œthread ×”×‘×. 
![Pasted image 20240308223157.png](/img/user/Assets/Pasted%20image%2020240308223157.png)
×›××©×¨ × ×©×™× 1 ×‘×§×•×“ ×”× ×´×œ × ×§×‘×œ ×”×ª× ×”×’×•×ª ×©××–×›×™×¨×” [[Computer Science/Operating Systems/CPU Scheduling\|Round Robin]], ×›×œ thread ×™×¨×•×¥ ××™×˜×¨×¦×™×” ××—×ª ×•××– ×”thread ×”×‘× ×™×¨×™×¥ ××ª ×”××™×˜×¨×¦×™×” ×”×‘××” ×‘×ª×•×¨ ×•×›×Ÿ ×”×œ××”. 

![Pasted image 20240308223446.png](/img/user/Assets/Pasted%20image%2020240308223446.png)

×× ×”×™×™× ×• ××’×“×™×œ×™× ××ª ×”×¤×¨××˜×¨ × 1 ×œ 2 ×”×™×™× ×• ××§×‘×œ×™× load balance ×¤×—×•×ª ×˜×•×‘:

![Pasted image 20240308224048.png](/img/user/Assets/Pasted%20image%2020240308224048.png)

××™×Ÿ ×‘×××ª ×ª×©×•×‘×” × ×›×•× ×” ×œ×§×‘×™×¢×ª ×’×•×“×œ chunk ××ª××™× ××š ×—×©×•×‘ ×œ×¦×™×™×Ÿ ×©×©×™××•×© ×‘ static scheduling ×”×•× ×××•×“ ×™×¢×™×œ ×›×™ ××™×Ÿ ×¦×•×¨×š ×‘×›×œ×œ ×œ×ª×§×©×•×¨×ª ×‘×™×Ÿ ×”threads ×©×›×Ÿ ×‘×–××Ÿ ×”×¨×™×¦×” ×›×œ ××—×“ ×™×•×“×¢ ×‘×™×“×™×•×§ ××” ×¢×œ×™×• ×œ×”×¨×™×¥ ×•×›××” ××™×˜×¨×¦×™×•×ª.

>[!caution] 
>×—×œ×•×§×” ×¡×˜×˜×™×ª ×™×›×•×œ×” ×œ×”×™×•×ª ×œ× ××•×¦×œ×—×ª ×›××©×¨ ×œ× × ×™×ª×Ÿ ×œ×“×¢×ª ××¨××© ×›××” ×—×™×©×•×‘×™× ×™×© ×‘×›×œ ××™×˜×¨×¦×™×” ×œ××©×œ ×× ×‘×§×•×“ ×œ××¢×œ×” ×”×™×™× ×• ××’×“×™×¨×™× ×‘××§×•× ×œ×¨×•×¥ ×¢×“ i ×œ×¨×•×¥ ×¢×“ rand ×”×™×™× ×• ×™×›×•×œ×™× ×œ×§×‘×œ ×—×œ×•×§×” ×œ× ×©×™×•×•×™×•× ×™×ª ×©×¤×•×’×¢×ª ×‘ balance.
>![Pasted image 20240308224623.png](/img/user/Assets/Pasted%20image%2020240308224623.png)
### Dynamic Scheduling
×œ××§×¨×™× ×›××• ×”× ×´×œ × ×™×ª×Ÿ ×œ×”×’×“×™×¨ ×’× ×©×”×—×œ×•×§×” ×ª×”×™×” dynamic.
×‘××¦×‘ ×–×” ×›×œ thread ××§×‘×œ chunk ×©×œ ××™×˜×¨×¦×™×•×ª ×œ×¤×™ ×”×¤×¨××˜×¨ ×©×”×’×“×¨× ×• ×•××¡×¤×¨ ×”××™×˜×¨×¦×™×•×ª ×‘×œ×•×œ××” ×”×—×™×¦×•× ×™×ª ×•××‘×¦×¢ ××•×ª×Ÿ ××‘×œ ×”×•× ××—×œ×§ ××ª ×”×¢×‘×•×“×” ×‘×¦×•×¨×” ×“×™× ××™×ª ×‘×œ×™ ×‘×”×›×¨×— ×¡×“×¨ ×¡×¤×¦×™×¤×™ ××œ× ×¢× ××œ×’×•×¨×™×ª× ×©××–×›×™×¨ [[Computer Science/Programming Concepts/Concurrency Programming/Thread Pool\|Thread Pool]]. 

```C
int main()
{
#pragma omp parallel for schedule(dynamic, 1) 	for (int i = 0; i < 20; i++)
	{
		printf("Thread %d is running number %d\n", omp_get_thread_num(), i);
	}
	return 0;
}
```

×”×¤×œ×˜ ×™×”×™×” :

```CLI
Thread 1 is running number 2
Thread 1 is running number 7
Thread 1 is running number 9
Thread 1 is running number 10
Thread 1 is running number 11
Thread 1 is running number 13
Thread 1 is running number 14
Thread 1 is running number 15
Thread 1 is running number 17
Thread 1 is running number 19
Thread 3 is running number 0
Thread 0 is running number 4
Thread 8 is running number 12
Thread 4 is running number 3
Thread 6 is running number 6
Thread 9 is running number 16
Thread 5 is running number 1
Thread 7 is running number 8
Thread 10 is running number 18
Thread 2 is running number 5
```

×—×©×•×‘ ×œ×¦×™×™×Ÿ ×©×”×”×§×¦××” ×”×™× [[Computer Science/Algorithms/greedy algorithms\|×—××“× ×™×ª]] ×‘×©×™×˜×” ×©×œ×¤×™×” ×¢×•×‘×“ ×”×ª×–××•×Ÿ ×”×“×™× ××™ ×”×•× First Come First Serve ×›×œ×•××¨, ×× ×™×©× ×Ÿ ××™×˜×¨×¦×™×•×ª ×©×¦×¨×™×š ×œ×‘×¦×¢ ×•×™×© thread ×¤× ×•×™ ×©×™×›×•×œ ×œ×§×—×ª ××•×ª×Ÿ, ×”×•× ×™×™×§×— ××•×ª×Ÿ.

×›××• ×›×Ÿ, ×”×ª×–××•×Ÿ ×”×“×™× ××™ ×‘××•×¤×Ÿ ×“×™ ××™× ×˜×•××™×˜×™×‘×™, ×”×¨×‘×” ×™×•×ª×¨ ×™×§×¨ ××”×¡×˜×˜×™ ×›×™ × ×“×¨×© ×ª×§×©×•×¨×ª ×‘×™×Ÿ ×” threads ×œ××—×¨ ×›×œ ××™×˜×¨×¦×™×”, ×›××• ×›×Ÿ ×œ×¢×™×ª×™× ×¦×¨×™×š ×œ×”×’×“×™×¨ ××ª ×”chunk size ×©×œ thread ×›×œ×©×”×• ×•×’× ×‘×’×œ×œ ×©×”×ª×–××•×Ÿ ×”×•× ××¢×™×Ÿ ×§×•×¤×¡× ×©×—×•×¨×” ×©×œ ×”×¡×¤×¨×™×™×” ×œ× ×‘×”×›×¨×— ×©× ×§×‘×œ ×ª×–××•×Ÿ ×©××ª××™× ×œ× ×•.

## Shared/Private variables
×›×××•×¨ ××©×ª× ×™× ×”××•×’×“×¨×™× ××—×•×¥ ×œ×§×‘×¢ ×”××§×‘×™×œ×™ ×”× shared.
××©×ª× ×™× ×”××•×’×“×¨×™× ×‘×ª×•×š ×§×‘×¢ ××§×‘×™×œ×™ ×”× private, ×›×œ×•××¨ ×›×œ thread ××§×‘×œ ×¢×•×ª×¨ ×©×œ ××©×ª× ×™× ××œ×•. 

![Pasted image 20240308230822.png|250](/img/user/Assets/Pasted%20image%2020240308230822.png)

× ×™×ª×Ÿ ×œ×©× ×•×ª ××ª × ×¨××•×ª ×‘×¨×™×¨×ª ××—×“×œ ×©×œ ×”××©×ª× ×™×:

![Pasted image 20240308231021.png](/img/user/Assets/Pasted%20image%2020240308231021.png)
i ×”×•×¤×š ××•×˜×•××˜×™ ×œ××©×ª× ×” ×¤×¨×˜×™ ×• j ×”×¤×œ ×œ×¤×¨×˜×™ ×‘×’×œ×œ ×©×”×©×ª××©× ×• ×‘×”×’×“×¨×” private(j). 

×”×¡×™×‘×” ×©×”×’×“×¨× ×• ××ª ×”××¢×¨×›×™× ×›static ×›×“×™ ×©×”× ×™×©×‘×• ×‘ global data segment ×•×œ× ×‘stack ×•×›×š × ×× ×¢ × seg fault (××¢×¨×›×ª ×”×”×¤×¢×œ×” ××’×“×™×¨×” ×œ stack ×’×•×“×œ ×§×‘×•×¢ ×•×œ×¤×¢××™× ×”×™× ×œ× ×ª×§×¦×” ×¢×•×“ ×¢×‘×•×¨ ×”stack , × ×™×ª×Ÿ ×œ×‘×“×•×§ ××ª ×’×•×“×œ ×”stack ×”×§×‘×•×¢ __×œ×›×œ ×ª×•×›× ×™×ª__ ×¢×œ ×™×“×™ ×”×¨×¦×ª ×”×ª×•×›× ×™×ª ulimit -s).

![Screenshot 2024-03-08 at 23.17.22.png](/img/user/Assets/Screenshot%202024-03-08%20at%2023.17.22.png)

__× ×©×™× ×œ×‘:__ ×”×”×¦×”×¨×” private ××™×™×¦×¨×ª ×¢×•×ª×§ ×©×œ ×”××©×ª× ×” ×•×œ×›×Ÿ × ×•×¦×¨ ×¢×•×ª×§ ×©×œ ×”××©×ª× ×” ×‘×ª×•×š ×”threads, ×”×¢×¨×š ×©×œ ×”×¢×•×ª×§×™× ×œ× ×‘× ×œ×™×“×™ ×‘×™×˜×•×™ ×‘××©×ª× ×” ×”××§×•×¨×™ ×›×œ×•××¨ ×›×œ ×©×™× ×•×™ ×‘×ª×•×š ×”×§×•×“ ×”××§×‘×™×œ×™ ×œ× ××©×¤×™×¢ ×¢×œ ×”××©×ª× ×” ×”××§×•×¨×™. ×›××• ×›×Ÿ ××™×Ÿ ×”×‘×˜×—×” ×©×’× ×”×¢×¨×š ×©×œ ×”××©×ª× ×” ×”××§×•×¨×™ ×™×¢×‘×•×¨ ×œ×¢×•×ª×§ ×œ××©×œ:

![Pasted image 20240309005307.png](/img/user/Assets/Pasted%20image%2020240309005307.png)

××•×× × ×”×¢×¨×š ×”×™×” 1, ××‘×œ ×›×œ ××—×“ ××”threads ×§×™×‘×œ ×¢×¨×š ×”×ª×—×œ×ª×™ ×©×œ 0 ×¢×‘×•×¨ ×”×¢×•×ª×§ ×©×œ sum.

××¤×©×¨ ×œ×”×’×“×™×¨ ××©×ª× ×” ×œ×”×™×•×ª private ×¨×§ ×œ×—×œ×§ ××¡×•×™×™× ××ª×•×š ×”×§×•×“ ×”××§×‘×™×œ×™. 

![Pasted image 20240309005450.png](/img/user/Assets/Pasted%20image%2020240309005450.png)

×‘××§×¨×” ×”×–×” × ×™×ª×Ÿ ×œ×¨××•×ª ××™×š ×œ××—×¨ ×”×™×¦×™××” ××”×œ×•×œ××” sum × ×©××¨ ×¢× ×¢×¨×š 1.

* ×× ××›×Ÿ ×—×©×•×‘ ×œ× ×• ×œ×©××•×¨ ×¢×œ ×¢×¨×š ×”××ª×—×•×œ ×”××§×•×¨×™ ×©×œ ×”××©×ª× ×”, ×‘××§×•× ×œ×”×©×ª××© ×‘×”×¦×”×¨×ª private , × ×©×ª××© ×‘×”×¦×”×¨×” firstprivate

![Pasted image 20240309005812.png](/img/user/Assets/Pasted%20image%2020240309005812.png)

* ×× × ×¨×¦×” ×©×”sum ×”×—×™×¦×•× ×™ ×™×§×‘×œ ××ª ×”×¢×¨×š ×”×¡×•×¤×™ ×©×§×™×‘×œ ××©×ª× ×” ×‘××™×˜×¨×¦×™×” ×”××§×‘×™×œ×™×ª __×”××—×¨×•× ×”__ × ×©×ª××© ×‘××™×œ×ª ×”××¤×ª×— lastprivate.

![Pasted image 20240309005924.png](/img/user/Assets/Pasted%20image%2020240309005924.png)

__××” ×”×¢×¨×š ×©×™×•×“×¤×¡ ×›××Ÿ?__
![Pasted image 20240309005949.png](/img/user/Assets/Pasted%20image%2020240309005949.png)
×”firstprivate ××•××¨ ×©×›×œ ×”threads ×™×§×‘×œ×• ××ª ×”×¢×¨×š ×”×”×ª×—×œ×ª×™ ×‘×¢×•×ª×§ ×©×œ×”×, ×©×”×•× 0. ×”lastprivate ××•××¨ ×©× ×©×™× ×‘sum ×”×—×™×¦×•× ×™ ××ª ×”×¢×¨×š ×©×§×™×‘×œ ×”×¡×›×•× ×”×—×œ×§×™ ×©×œ ×”thread ×”××—×¨×•×Ÿ. ×›×™×•×•×Ÿ ×©×‘×“×™×¤×•×œ×˜ ××“×•×‘×¨ ×‘× ×™×”×•×œ ×¡×˜×˜×™ ××‘×œ ×”×—×œ×•×§×” ×›××Ÿ ×œ× ×©×•×•×” (×™×© 9 ××™×˜×¨×¦×™×•×ª ×¢×œ 4 threads) ×œ× × ×™×ª×Ÿ ×œ×—×–×•×ª ××ª ×”×ª×•×¦××” ××¨××©. × × ×™×— ×© thread0 ×™×§×‘×œ ××ª 3 ×”××™×˜×¨×¦×™×•×ª ×”×¨××©×•× ×•×ª ×•× ×‘×—×Ÿ ××ª ×”×”×“×¤×¡×•×ª

![Pasted image 20240309011145.png|200](/img/user/Assets/Pasted%20image%2020240309011145.png)

× ×™×ª×Ÿ ×œ×¨××•×ª ×©×›×™×•×•×Ÿ ×© ID3 ×§×™×‘×œ ×¨×§ ××ª 2 ×”××™×˜×¨×¦×™×•×ª ×”××—×¨×•× ×•×ª ××– ×”×•× ×™×¡×›×•× ××ª ×”×¡×›×•× ×”×—×œ×§×™ ×© i=8,9 ×•×œ×›×Ÿ ×”×¤×œ×˜ ×™×”×™×” 17.
### default 
×”×¨×’×œ ××•××œ×¥ ×”×•× ×œ×”×©×ª××© ×‘××™×œ×ª ×”××¤×ª×— default(none) ×›×“×™ ×œ×§×‘×œ ×‘×“×™×§×ª ×§×•××¤×™×œ×¦×™×” ×©××›×¨×™×—×” ××•×ª× ×• ×œ×¨×©×•× ×¢×‘×•×¨ ×›×œ ××©×ª× ×”, ××”×™ ×¨××ª ×”×©×™×ª×•×£ ×©×œ×•. ×’×•×¨× ×œ×§×•×“ ×œ×”×™×•×ª ××•×‘×Ÿ ×™×•×ª×¨. 

![Pasted image 20240309011436.png](/img/user/Assets/Pasted%20image%2020240309011436.png)

## Algorithms with OpenMP
### ×—×™×©×•×‘ ××¡×¤×¨×™× ×¨××©×•× ×™×™×
×§×œ×˜: ××¡×¤×¨ ×˜×‘×¢×™ n
×¤×œ×˜: ×›×œ ×”××¡×¤×¨×™× ×”×¨××©×•× ×™×™× × 1 ×¢×“ ×œ n.
```C
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

void calcPrimes(int n) {
    bool *prime = (bool *)malloc((n + 1) * sizeof(bool));
    if (prime == NULL) {
        printf("Memory allocation failed.\n");
        return;
    }

    // Initialize all elements of prime[] as true
    #pragma omp parallel for 
    for (int i = 0; i <= n; i++)
        prime[i] = true;

    // Mark non-prime numbers
    #pragma omp parallel for schedule(dynamic, 1)
    for (int p = 2; p * p <= n; p++) { 
            for(int d = 2; d<p && prime[p]; d++)
                 if(p % d == 0)
                     prime[p] = false;
    }

    // Print prime numbers
    printf("Prime numbers in the range 2 to %d are:\n", n);
    for (int p = 2; p <= n; p++) {
        if (prime[p])
            printf("%d ", p);
    }
    printf("\n");

    free(prime);
}
```

1) ×”×œ×•×œ××” ×©××‘×¦×¢×™× ××ª×—×•×œ ×œ××¢×¨×š ×” prime ×ª×”×™×” ××§×‘×™×œ×™×ª
2) ×”×œ×•×œ××” ×”×›×¤×•×œ×” ×©×¨×¦×” ×¢×“ ×”×©×•×¨×© ×©×œ n ×‘×œ×•×œ××” ×”×—×™×¦×•× ×™×ª ×•×‘×œ×•×œ××” ×”×¤× ×™××™×ª ×¨×¦×™× ×¢×œ ×›×œ ×”××¡×¤×¨×™× ×¢×“ ×œ p ×›××©×¨ ×”××¢×¨×š ×‘××™×§×•× ×” p ×”×•× true ×•×‘×•×“×§×™× ×”×× p ××ª×—×œ×§ ×‘ d ×•×× ×›×Ÿ ××©× ×™× ××ª ×”×¢×¨×š ×©×œ p ×‘××¢×¨×š ×”×¨××©×•× ×™×™× ×œ×”×™×•×ª false. ××ª ×”×œ×•×œ××” ×”×–××ª × ×¢×©×” ×‘×¦×•×¨×” ××§×‘×™×œ×™×ª ×¢× ×ª×–××•×Ÿ ×“×™× ××™. ×”×¡×™×‘×” ×©×œ× ×”×©×ª××©× ×• ×‘ collapse ×”×™× ×‘×’×œ×œ ×©×”××§×‘×™×œ×™×•×ª ×©×œ ×”××™×˜×¨×¦×™×” ×”×¤× ×™××™×ª ×¢×œ×•×œ ×œ×™×¦×•×¨ ×¨×™×¦×•×ª ×›×¤×™×œ×•×ª ×›×™×•×•×Ÿ ×©×›×œ thread ×‘×•×“×§ ××ª ×”××¢×¨×š ×”×’×œ×•×‘×œ×™ ×©×œ ×”××¡×¤×¨×™× ×”×¨××©×•× ×™×™× ×•×œ×›×Ÿ ×©× ×™ threads ×™×›×•×œ×™× ×œ×§×‘×œ ××¡×¤×¨×™× ×©×›×œ ××”× ××©× ×” ××ª ×”××¢×¨×š prime ×‘××•×ª×• ×”××™×§×•× ××‘×œ ×©× ×™×”× ×™×’×©×• ×œ×¢×¨×š ×”×–×” ×‘×’×œ×œ ×©×”× ×¢×•×‘×“×™× ×‘××§×‘×™×œ ×•×œ× ××¡×•× ×›×¨× ×™×.
3) ×”×¡×™×‘×” ×œ×©×™××•×© ×‘ dynamic ×”×™× ×©×”××™×˜×¨×¦×™×•×ª ×”×¤× ×™××™×•×ª ×”×Ÿ ×œ× ×‘×’×•×“×œ ×©×•×•×”, ×œ×›×Ÿ ×¢×“×™×£ ×œ× ×• ×œ×ª×–××Ÿ ×œ×¤×™ FCFS ×•×œ×ª×ª ×œthreads ×©××¡×™×™××™× ×§×•×“× ×œ×›×Ÿ ××ª ×”××™×˜×¨×¦×™×•×ª ×”×§×¦×¨×•×ª ×™×•×ª×¨ ×œ×§×‘×œ ×¢×‘×•×“×•×ª ×—×“×©×•×ª.
4) ××™×Ÿ ×‘×××ª ×¡×™×‘×” chunk size = 1 ××• ×œ×©×™× ××¡×¤×¨ ××—×¨, ×›×“×™ ×œ×§×‘×•×¢ ×‘×™×“×™×•×§ ×¦×¨×™×š ×œ×¢×©×•×ª × ×™×¡×•×™ ×•×ª×”×™×™×”.

### BFS 
×¨××™× ×• ×›×‘×¨ ×“×¨×š ×œ×—×©×‘ [[Computer Science/Algorithms/Parallel Algorithms/Parallel Graphs Algorithms#BFS\|bfs ××§×‘×™×œ×™]] ×¢× pthreads. ×›×¢×ª × ×¨××” ×›×™×¦×“ × ×™×ª×Ÿ ×œ×—×©×‘ ××ª ×–×” ×‘×¦×•×¨×” ××§×‘×™×œ×™×ª ×¢× OpenMP.

```C
SEQUENTIAL_BFS(V, E, s)

   #pragma openmp parallel for
   for each ğ‘£âˆˆğ‘‰
         ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘£â†ğ‘¤â„ğ‘–ğ‘¡ğ‘’
         ğ‘‘_ğ‘£â†âˆ
         ğœ‹_ğ‘£â†âˆ…
   ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘ â†ğ‘”ğ‘Ÿğ‘’ğ‘¦
   ğ‘‘_ğ‘ â†0
   define queue ğ‘„â†{ğ‘ }

   while ğ‘„â‰ âˆ…
          ğ‘£â†ğ‘„.ğ‘‘ğ‘’ğ‘ğ‘¢ğ‘’ğ‘¢ğ‘’( )
          ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘£â†ğ‘ğ‘™ğ‘ğ‘ğ‘˜
          #pragma openmp parallel for
          for each ğ‘¢ adjacent to ğ‘£
                 if ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘¢ is ğ‘¤â„ğ‘–ğ‘¡ğ‘’
                         #pragma omp critical
                                ğ‘„.ğ‘’ğ‘›ğ‘ğ‘¢ğ‘’ğ‘¢ğ‘’(ğ‘¢)
                         ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘¢â†ğ‘”ğ‘Ÿğ‘’ğ‘¦
                         ğœ‹_ğ‘¢â†ğ‘£
                         ğ‘‘_ğ‘¢â†ğ‘‘_ğ‘£+1

```

* ××§×‘×œ× ×• ××ª ×”××ª×—×•×œ
* ××§×‘×œ× ×• ××ª ×”××™×˜×¨×¦×™×” ×¢×œ ×›×œ ×œ×•×œ××” ×©×¨×¦×” ×¢×œ ×”×©×›× ×™× ×©×œ ×§×•×“×§×•×“ v ×©×™×¦× ××”×ª×•×¨
* ×”×’×“×¨× ×• ××ª ×”×”×©××” ×œ×ª×•×š ×”×ª×•×¨ ×›×§×˜×¢ ×§×•×“ ×§×¨×™×˜×™.

×”×©×™×˜×” ×”×–××ª ×”×™× ×‘×¢×™×™×ª×™×ª ×›×¤×™ ×©×××¨× ×• ×™×© ×¦×•×¨×š ×œ×”×’×“×™×¨ ×ª×•×¨ ×œ×›×œ ×©×›×‘×” ×¢×œ ×× ×ª ×œ×”×× ×¢ ×race condition ×©×¢×œ×•×œ ×œ×’×¨×•× ×œ××œ×’×•×¨×™×ª× ×œ××¦×•× ××¡×œ×•×œ ××¨×•×š ×™×•×ª×¨ ××”××¡×œ×•×œ ×”×§×¦×¨ ×‘×™×•×ª×¨ ×´×‘×˜×¢×•×ª×´.

×‘ OpenMP × ×•×›×œ ×œ×™×¦×•×¨ ×ª×•×¨ ×œ×›×œ ×¨××” ×¢× ×©× ×™ ×ª×•×¨×™× ×‘×œ×‘×“. 
```C
SEQUENTIAL_BFS(V, E, s)

   #pragma openmp parallel for
   for each ğ‘£âˆˆğ‘‰
         ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘£â†ğ‘¤â„ğ‘–ğ‘¡ğ‘’
         ğ‘‘_ğ‘£â†âˆ
         ğœ‹_ğ‘£â†âˆ…
   ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘ â†ğ‘”ğ‘Ÿğ‘’ğ‘¦
   ğ‘‘_ğ‘ â†0
   define queue ğ‘„1â†{ğ‘ }
   define queue ğ‘„2â†{ }

   while ğ‘„1â‰ âˆ…
      #pragma openmp parallel for
      for each v in Q1    
          ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘£â†ğ‘ğ‘™ğ‘ğ‘ğ‘˜
          #pragma openmp parallel for
          for each ğ‘¢ adjacent to ğ‘£
                 if ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘¢ is ğ‘¤â„ğ‘–ğ‘¡ğ‘’
                         #pragma omp critical
                                ğ‘„2.ğ‘’ğ‘›ğ‘ğ‘¢ğ‘’ğ‘¢ğ‘’(ğ‘¢)
                         ğ‘ğ‘œğ‘™ğ‘œğ‘Ÿ_ğ‘¢â†ğ‘”ğ‘Ÿğ‘’ğ‘¦
                         ğœ‹_ğ‘¢â†ğ‘£
                         ğ‘‘_ğ‘¢â†ğ‘‘_ğ‘£+1
	    empty Q1
        swap Q1 and Q2
```

* ×”×’×“×¨× ×• ×©× ×™ ×ª×•×¨×™× ×›××©×¨ Q2 ×˜×•×¢×Ÿ ×›×œ ×¤×¢× ××ª ×”×§×•×“×§×•×“×™× ×©×œ ×”×¨××” ×”×‘××” ×•×´××–×™×Ÿ ××•×ª××´ ×œ Q1. 
* ×™×© ×’× ×©× ×™ ×´×¨××•×ª×´ ×©×œ ××™×§×‘×•×œ, ×”×¨××©×•× ×” ×”×™× ×‘×¨×™×¦×” ×¢×œ ×›×œ ×”×§×•×“×§×•×“×™× ×‘×¨××” ×”× ×•×›×—×™×ª ×‘ Q1 ×•×©×™× ×•×™ ×”×¦×‘×¢ ×œ×©×—×•×¨, ×”×¨××” ×”×©× ×™×™×” ×”×™× ×‘×ª×•×¨ ×”×¨××” ×”×§×•×“××ª ×©×‘×” ×¨×¦×™× ×‘××§×‘×™×œ ×¢×œ ×›×œ u ×©×›×Ÿ ×©×œ v ×•××–×™× ×™× ××•×ª×• ×œQ2. 
* × ×©×™× ×œ×‘ ×©×œ× ×©×™× ×™× ×• ××ª ×”end of loop barrier ×©×›×Ÿ × ×¨×¦×” ×©×›×œ ×”threads ×™×–×™× ×• ××ª ×”×©×›× ×™× ×œ×ª×•×¨ Q2 ×œ×¤× ×™ ×‘×™×¦×•×¢ ×” swap.
* ×›×œ ×”××§×‘×™×œ×™×•×ª ×¤×” ×”×™× ×¡×˜×˜×™×ª ×©×›×Ÿ, ××™×Ÿ ×›××Ÿ ×¦×•×¨×š ×‘×ª×–××•×Ÿ ×“×™× ××™ ×›×œ×œ.
#### Bottom-up BFS algorithm
×’×™×©×” ×©×”×•×¦×’ ×‘[Direction Optimizing BFS](https://parlab.eecs.berkeley.edu/sites/all/parlab/files/main.pdf) ×”×¦×™×’×” ×’×™×©×” ×©××ª××™××” ×™×•×ª×¨ ×œ×ª×›× ×•×ª ××§×‘×™×œ×™. ×”×’×™×©×” ×”×–××ª ××•××¨×ª ×©× ×—×–×™×§ ××¢×¨×š ×©×œ frontier ×•×‘×›×œ ××™×˜×¨×¦×™×” bottom-up ×‘××§×•× ×œ×¨×•×¥ ×¢×œ ×›×œ ×”×©×›× ×™× ×©×œ ×§×•×“×§×•×“ $v\in frontier$ , × ×¨×•×¥ __×¢×œ ×›×œ ×”×§×•×“×§×•×“×™×__ ×©×œ× ×”×•×’×“×¨ ×œ×”× parent ×‘×¨×’×¢ ×©××¦×× ×• ×›×–×” ×¨×¦×™× ×¢×œ ×›×œ ×”×©×›× ×™× ×©×œ×• ×©× ××¦××™× ×‘frontier ×•××‘×¦×¢×™× ×¢×œ×™×”× BFS. ×”×¡×™×‘×” ×©×‘×¦×•×¨×” ×”××§×‘×™×œ×™×ª ×”×©×™×˜×” ×”×–××ª ×™×•×ª×¨ ×™×¢×™×œ×” ×”×™× ×‘×’×œ×œ ×©×× ×—× ×• ×™×›×•×œ×™× ×œ×”×©×™×’ ×›××Ÿ ××§×‘×•×œ ×’×‘×•×” ×™×•×ª×¨ ×‘×’×œ×œ ×©×”××™×˜×¨×¦×™×•×ª ×”×—×™×¦×•× ×™×ª ×¨×¦×” ×¢×œ ×›×œ ×”×§×•×“×§×•×“×™× ×•×‘×¦×•×¨×” ××§×‘×™×œ×™×ª ×× ×—× ×• ×’× ×’×•×¨××™× ×œ×›×š ×©×”×‘×“×™×§×” ×”××§×‘×™×œ×™×ª ×¢×œ frontier ×’×“×•×œ ×™×•×ª×¨. ×”××œ×’×•×¨×™×ª× bottom-up ×‘×¦×•×¨×” ×¡×“×¨×ª×™×ª ×”×¨×‘×” ×¤×—×•×ª ×˜×•×‘ ××”×’×™×©×” ×”×¨×’×™×œ×” ×©×× ×—× ×• ××›×™×¨×™×. 


×”××™××•×© ×”×¡×“×¨×ª×™ × ×¨××” ×›×š:
![Pasted image 20240309184052.png|300](/img/user/Assets/Pasted%20image%2020240309184052.png)
![Pasted image 20240309184021.png|300](/img/user/Assets/Pasted%20image%2020240309184021.png)

×‘×¦×•×¨×” ××§×‘×™×œ×™×ª , × ×•×›×œ ×œ××ª×—×œ ××¢×¨×š ×”parents ×‘×¦×•×¨×” ××§×‘×™×œ×™×ª ×•×’× ×‘×¦×•×¨×” ×“×™× ××™×ª ×œ×¨×•×¥ ×¢×œ ×›×œ ×”×§×•×“×§×•×“×™× (×”×¡×™×‘×” ×©×”×¦×•×¨×” ×”×™× ×“×™× ××™×ª ×”×™× ×‘×’×œ×œ ×©×× ×—× ×• ×œ× ×™×•×“×¢×™× ××™×–×” ×§×•×“×§×•×“×™× ×”× ×¢× ×™×•×ª×¨ ×©×›× ×™× ×•××™×–×” ×¢× ×¤×—×•×ª). ×”×œ×•×œ××” ×”×©× ×™×™×” ×›×‘×¨ ×™×›×•×œ×” ×œ×”×™×•×ª ×¡×˜×˜×™×ª ×©×›×Ÿ ×›××•×ª ×”×¢×‘×•×“×” ×”×™× ×©×•×•×” ×‘×›×œ ××™×˜×¨×¦×™×” ×¤× ×™××™×ª. ×›××• ×›×Ÿ × ×©×™× ×œ×‘ ×©××™×Ÿ ×›××Ÿ ××™×–×” ×¡× ×›×¨×•×Ÿ ×¤×¨×˜ ×œ×¡× ×›×¨×•×Ÿ ×”×“×™×¤×•×œ×˜×™, ×‘××§×•× ×©× ×¢×‘×•×“ ×¢× ×©× ×™ ×ª×•×¨×™× ×¢× counter ×©×”×•×¤×š ×œ×”×™×•×ª 0 ×¨×§ ×›××©×¨ ×” bottom-up ×œ× ××•×¦× ×©×•× ×§×•×“×§×•×“ ×©×”×”×•×¨×” ×©×œ×• ×´×œ× ×§×™×™××´ ×‘××¢×¨×š ×”parent.

![Pasted image 20240309183913.png](/img/user/Assets/Pasted%20image%2020240309183913.png)

### DFS 
× ×¨××” ×§×•×“ c ×©×××© [[Computer Science/Algorithms/DFS\|DFS]] ××§×‘×™×œ×™ ×‘×××¦×¢×•×ª OMP:

```C
#include <stdio.h>
#include <stdlib.h>
#include <omp.h>

#define MAX_NODES 100

int graph[MAX_NODES][MAX_NODES];
int num_nodes;

enum colors {NOT_VISITED, VISIT_IS_IN_TASK_QUEUE, ALREADY_VISITED};
enum colors visited[MAX_NODES];

void parallel_dfs_visit(int node) {
    visited[node] = ALREADY_VISITED;
    printf("Node %d is visited by thread %d\n", node, omp_get_thread_num());

    for (int i = 0; i < num_nodes; i++) {
        if (graph[node][i]) {
            #pragma omp critical 
            {
                if (visited[i] == NOT_VISITED) {
                    printf("thread %d: create task for node %d\n", omp_get_thread_num(),i);
                    visited[i] = VISIT_IS_IN_TASK_QUEUE;
                    #pragma omp task
                        parallel_dfs_visit(i);
                }
            }
        }
    }
}

void dfs() {
    for (int i = 0; i < num_nodes; i++) {
        printf("thread %d: examine node %d\n", omp_get_thread_num(), i);
        if (visited[i] == NOT_VISITED) {
            printf("\nstarting DFS visit from %d\n", i);
            
            #pragma omp parallel
            {
                #pragma omp single
                {
                    parallel_dfs_visit(i);
                }
            }
            
        } else if (visited[i] == VISIT_IS_IN_TASK_QUEUE) {
            perror("error: VISIT_IS_IN_TASK_QUEUE shouldn't be possible here\n");
        }
    }
}

```

×”×§×•×“ ××›× ×™×¡ thread ××—×“ ×œ×ª×•×š ×” dfs_visit ×•×”×•× ×›×œ ×¤×¢× ××•×¡×™×£ task ×œ×¤×•× ×§×¦×™×™×ª ×”visit ×”××§×‘×™×œ×™×ª. ×›×›×” ×‘×¢×¦× ×× ×—× ×• ××‘×¦×¢×™× ×¡×¨×™×§×” ×¢×•××§ ××‘×œ ×›×œ ×”×©×›× ×™× ×©×œ ×§×•×“×§×•×“ ×›×œ×©×”×• ×¢×•×©×™× ××ª ×–×” ××§×‘×™×œ×™ (×§×¦×ª ×¢×™×•×•×ª ×©×œ DFS ×©××©×œ×‘ ×‘×ª×•×›×• BFS). ×¦×¨×™×š ×œ×©×™× ×œ×‘ ×©×’× ×¢× ×”×¢×™×•×•×ª ×”×–×” ××–×›×™×¨ BFS , ×›×œ×•××¨ ×”×™×™× ×• ×™×›×•×œ×™× ××•×œ×™ ×œ×‘× ×•×ª ×× ×’× ×•×Ÿ ××‘×•×¡×¡ priorities ×©× ×•×ª×Ÿ ×œ task ××ª ×”×¢×“×™×¤×•×ª ×©×œ ×”×¨××” ×©×œ ××•×ª×• ×§×•×“×§×•×“ ×‘×’×¨×£. ××‘×œ ×¢×“×™×™×Ÿ ×–×” ×œ× ×”×™×” BFS ××•×©×œ× ×©×›×Ÿ ×™×›×œ×• ×œ×”×™×•×ª ××¦×‘×™× ×©×”task queue ×™×§×¦×” ××©×™××•×ª ×¢× ×¢×•××§ × ××•×š ×™×•×ª×¨ ×›×™ ×™×© threads ×‘××•×•×™×¨, ×œ×¤× ×™ ×©×›×œ ×”×¨××” ×”×¡×ª×™×™××”. 

>[!note] task priority
>××¤×©×¨ ×œ×”×‘×™× ×œ task ×¢×¨×š ×©×œ priority ×‘×¢×ª ×”×™×¦×™×¨×” ×©×œ×• ×¢× task priority(#p) ×‘ pragma block.

## Sections
×‘×¢×™×™×ª producer/consumer ××•×’×“×¨×ª ×‘××•×¤×Ÿ ×”×‘×. ×™×© ×œ× ×• bounded buffer ×‘×’×•×“×œ N ×ª××™×. producer ××™×™×¦×¨ items ×•×©× ××•×ª× ×‘- buffer ×‘××§×•× ×¤× ×•×™. consumer ×¦×•×¨×š items ×•××¤× ×” ××§×•× ×‘- buffer. ×¢×œ consumer ×œ×—×›×•×ª ×›×“×™ ×©- item ×™×›× ×¡ ×œ- buffer ×œ×¤× ×™ ×©×™×•×›×œ ×œ×¦×¨×•×š ××•×ª×•, ×•×¢×œ producer ×œ×—×›×•×ª ×¢×“ ×©×™×”×™×” ××§×•× ×¤× ×•×™ ×‘- buffer ×›×“×™ ×©×™×•×›×œ ×œ×©×™× ×©× item ×—×“×©.

×§×•×“ ×¡×“×¨×ª×™ ×™×¨××” ××”×¦×•×¨×” ×©×‘×” ×‘×›×œ ××™×˜×¨×¦×™×” × ×•×¦×¨ item ××—×“, ×•×”×•× ××™×“ × ×¦×¨×š.
![Pasted image 20240309012234.png](/img/user/Assets/Pasted%20image%2020240309012234.png)

××™×š ×œ×”×¤×•×š ××•×ª×” ×œ×ª×•×›× ×™×ª ××§×‘×™×œ×™×ª ×›×“×™ ×©- producer ×•- consumer ×™×•×›×œ×• ×œ×¢×‘×•×“ ×›×œ ××—×“ ×‘× ×¤×¨×“ ×•×‘××§×‘×™×œ ? ×¢× ×”×›×œ×™× ×©×œ××“× ×• ×‘ OpenMP ×¢×“ ×›×”, × ×¨××” ×©×œ× ×§×™×™× ×›×œ×™ ×©×™×¢×–×•×¨ ×œ× ×• ×©×›×Ÿ ×× ×—× ×• ×œ× ×¨×•×¦×™× ×œ×—×œ×§ ××©×™××” ×œ×—×œ×§×™× ××œ× ×œ×”×’×“×™×¨ ×©×ª×™ ××©×™××•×ª ×©×•× ×•×ª ×¢×‘×•×¨ ×›×œ thread. ×–×” ×‘×¢×™×” ×©×œ× × ×ª×§×œ× ×• ×‘×” ×¢×“ ×›×” ×›×™ ×× ×—× ×• ×¨×•×¦×™× ×œ×—×œ×§ __×ª×¤×§×™×“×™×__ ×•×œ× __××™×˜×¨×¦×™×•×ª__.

![Pasted image 20240309125402.png|300](/img/user/Assets/Pasted%20image%2020240309125402.png)

×”×›×œ×™ ×”××“×•×‘×¨ × ×§×¨× __sections__:
![Pasted image 20240309013048.png](/img/user/Assets/Pasted%20image%2020240309013048.png)

1) ×©× ×™ keyword ×—×“×©×™× - section ×• sections. 
2) ×›×œ ×” sections ×¨×¦×™× ×‘××§×‘×™×œ ×‘thread × ×¤×¨×“ ×œ×›×œ section
3) ×”×ª×•×›×Ÿ ×©×œ ×›×œ section ×”×•× ×¡×“×¨×ª×™ ××œ× ×× ×›×Ÿ ××’×“×™×¨×™× ××—×¨×ª
4) ×”×’×“×¨× ×• section ××§×‘×™×œ×™ ×¢×¦×××™ ×¢×‘×•×¨ producer thread ×•- consumer thread. ×¢×‘×•×¨ ×›×œ ×ª× $A[i]$ ×™×¦×¨× ×• ××©×ª× ×” $flags[i]$ ×¢×‘×•×¨ ×›×œ ×ª× ×‘××¢×¨×š A ×›×“×™ ×©- producer ×™×•×›×œ ×œ×™×™×“×¢ ××ª consumer ×©×”×•× ××™×œ× $A[i]$ ×•×ª× ×–×” ××•×›×Ÿ ×œ×¦×¨×™×›×”, ×•- consumer ×™×•×›×œ ×œ×™×™×“×¢ ××ª producer ×©×”×•× ×¦×¨×š $A[i]$ ×•×ª× ×–×” ××•×›×Ÿ ×œ××™×œ×•×™ ×—×•×–×¨.


×‘×§×•×“ ×”× ×´×œ ×™×©× ×” ×‘×¢×™×”, ×”×¤×œ×˜ ×¢×œ×•×œ ×œ×”×™×•×ª ×©×•× ×” ×‘×›×œ ×¨×™×¦×” ××›×™×•×•×Ÿ ×©×©× ×™ threads ×¢×œ×•×œ×™× ×œ×¢×‘×•×“ ×¢×œ __×©× ×™ ××¢×‘×“×™× ×©×•× ×™×__ ×•×œ×›×Ÿ ×”×¢×“×›×•×Ÿ ×©×œ $A[i]$ ×¢×œ ×™×“×™ producer threads ×¢×œ×•×œ ×œ×”×™×•×ª ×œ× × ×’×™×© ×¢×‘×•×¨ consumer thread ×•×›× ×´×œ ×œ×’×‘×™ $FLAGS[i]$ . ×–×” ×›××•×‘×Ÿ ×ª×œ×•×™ ×‘××“×™× ×™×•×ª ×”×›×ª×™×‘×” ×©×œ ×”cache ××‘×œ ×–×” ×¢×“×™×™×Ÿ ×™×•×¦×¨ ××™ ×“×˜×¨××™× ×™×–×.

×›×“×™ ×œ×˜×¤×œ ×‘×‘×¢×™×” ×”×–××ª × ×™×ª×Ÿ ×œ×”×©×ª××© ×‘×¤×•× ×§×¦×™×” flush 
![Pasted image 20240309130114.png](/img/user/Assets/Pasted%20image%2020240309130114.png)

×”×¤×•× ×§×¦×™×” ×”×–××ª ×‘×¢×¦× ××›×¨×™×—×” ××ª ×”××™×“×¢ ×œ×”×ª×¢×“×›×Ÿ ×’× ×‘ram ×•×œ× ×¨×§ ×‘ cache. × ×©×™× ×œ×‘ ×©×–×” ×œ× ×”××¦×‘ ×©×œ cache invalidation ×©×“×™×‘×¨× ×• ×¢×œ×™×• ×§×•×“×, ××¦×‘ ×©×œ cache invalidation ×’×•×¨× ×œ×˜×¢×™× ×” ×©×œ ×”××™×“×¢ ××”RAM ×•×œ× ×œ×¢×“×›×•×Ÿ ×”××™×“×¢ ×‘RAM. 

×›×›×” × ×‘×˜×™×— ××ª ×××™× ×•×ª ×”××™×“×¢ ×‘ cache, ××‘×œ ×¢×“×™×™×Ÿ ×”×¤×œ×˜ ×¢×œ×•×œ ×œ×”×™×•×ª ×©×•× ×” ×‘×›×œ ×”×¨×¦×” ×‘×’×œ×œ ×©×™×›×•×œ ×œ×”×™×•×ª ××¦×‘ ×©×œ×¤× ×™ ×©× ×’×™×¢ ×œ flush ×”×–×›×¨×•×Ÿ ×¢×‘×•×¨ flags ×™×ª×¢×“×›×Ÿ ××‘×œ ×¢×‘×•×¨ ×”××¢×¨×š ×œ×, ×œ×›×Ÿ ×”consumer ×™×¦× ××”busy wait ×©×œ×• (×œ×•×œ××ª ×” while) ×•×™×¡×›×•× ×¢×¨×š ×œ× ×¢×“×›× ×™.

__×”×¤×ª×¨×•×Ÿ ×”×•× ×œ×”×•×¡×™×£ ×¢×•×“ flush__ ×’× ××—×¨×™ ×¢×“×›×•×Ÿ ×©×œ A ×•×’× ××—×¨×™ ×¢×“×›×•×Ÿ ×©×œ flags 

![Pasted image 20240309132141.png](/img/user/Assets/Pasted%20image%2020240309132141.png)

×¦×¨×™×š ×œ×©×™× ×œ×‘ ×©×‘××™×œ×™× ××—×¨×•×ª ×”×¤×¢×•×œ×” ×”×–××ª ××•××¨×ª ×œ×œ×™×‘×•×ª ×œ× ×œ×¢×‘×•×“ ×¢× ×”cache ×‘×›×œ×œ ××œ× ×¨×§ ×¢× RAM ×•×œ×›×Ÿ ×–××ª ×¤×¢×•×œ×” __×××•×“ ×™×§×¨×”__ ×•×œ×•×§×—×ª ×–××Ÿ ×¨×‘.

### Nested Sections 
× ×•×›×œ ×œ×”×¦×”×™×¨ ×¢×œ nested section ×‘×ª×•×š section ×§×™×™×. ×›××• nested for , ×” nested section ×‘××•×¤×Ÿ ×“×™×¤×•×œ×˜×™ ×¨×¦×™× ×‘×¦×•×¨×” ×¡×“×¨×ª×™×ª ×¢×œ ×™×“×™ ×”thread ×©××¨×™×¥ ××ª ×”section ××‘. 

![Pasted image 20240309170140.png](/img/user/Assets/Pasted%20image%2020240309170140.png)

×× × ×¨×¦×” ×œ×©× ×•×ª ××ª ×”×”×ª× ×”×’×•×ª ×”×–××ª × ×©×ª××© ×‘ omp_set_nested(1) ××—×•×¥ ×œ pragma block ×›×“×™ ×œ××¤×©×¨ ××§×‘×™×œ×™×•×ª ××§×•× × ×ª.

## Tasks
### Linked List 
× ×¨×¦×” ×œ×”×¨××•×ª ×›×™×¦×“ ×œ×”×©×ª××© ×‘ OpenMP ×›×“×™ ×œ××§×‘×œ ××ª ×”×§×•×“ ×”×‘×

![Pasted image 20240309170403.png|300](/img/user/Assets/Pasted%20image%2020240309170403.png)

×”×”×¦×¢×” ×”××™× ×˜×•××™×˜×™×‘×™×ª ×›×“×™ ×œ××§×‘×œ ×œ×•×œ××ª while , ×“×‘×¨ ×©×œ× ××ª××¤×©×¨ ×‘ default ×”×™× ×œ×”××™×¨ ××ª ×”×¨×©×™××” ×”××§×•×©×¨×ª ×œ××¢×¨×š ×•××– ×¢×œ ×–×” ×œ×¨×•×¥ ×‘×¦×•×¨×” ××§×‘×™×œ×™×ª.

![Pasted image 20240309170532.png](/img/user/Assets/Pasted%20image%2020240309170532.png)
×™×© ×¤×” overhead ×©×œ ×”×¢×ª×§×”. ×œ×”×©×ª××© ×‘ sections ×”×•× ×’× ×‘×¢×™×™×ª×™ ×›×™ ×× ×—× ×• ×œ× ×™×›×•×œ×™× ×œ×“×¢×ª ××”×• ××¡×¤×¨ ×”sections ×©× ×¨×¦×” ×œ×™×™×¦×¨. × ×¨×¦×” ×›×œ×™ ×©××ª××™× ×œ××§×‘×•×œ ×©×œ ××¦×‘ ×›×–×” ×©×‘×• ×œ× ×™×•×“×¢ ×›××” tasks × ×¨×¦×” ×œ×™×™×¦×¨, ×”×›×œ×™ ×”×–×” × ×§×¨× Tasks.

× ×¡×ª×›×œ ×¢×œ ×”×¡×™× ×ª×§×¡:
![Pasted image 20240309170726.png|300](/img/user/Assets/Pasted%20image%2020240309170726.png)
×”×”×‘×“×œ ×”××”×•×ª×™ ×‘×™×Ÿ tasks ×œ sections ×”×•× ×©×›××Ÿ ×™×© task queue ×©×× ×”×œ ××ª ×”××©×™××•×ª. ×‘×ª×•×š ×”×§×•×“ ×”××§×‘×™×œ×™ ×¢×˜×¤× ×• ××ª ×”×ª×•×›× ×™×ª ×‘×§×•×“ single ×›×“×™ ×©×¨×§ thread ××—×“ ×™×™×¦×¨ ××ª ×”tasks ×•×™×›× ×™×¡ ××•×ª× ×œ task pool. 

×›××Ÿ ×™×© ×¤×” ××™××•×© ×“×•××” ×××•×“ ×œ[[Computer Science/Programming Concepts/Concurrency Programming/Thread Pool\|Thread Pool]] , ×” threads ×©×•×œ×¤×™× ××©×™××•×ª ××”task queue ×›×œ ×¢×•×“ ×”× ×™×›×•×œ×™×.

![Pasted image 20240309171008.png](/img/user/Assets/Pasted%20image%2020240309171008.png)
×¢×‘×•×¨ ×”×ª×•×›× ×™×ª ×”× ×´×œ ×”×¤×œ×˜ ×™×”×™×”

![Pasted image 20240309171020.png](/img/user/Assets/Pasted%20image%2020240309171020.png)

×‘×”×¨×¦×” ×”×–×• ×¨×•××™× ×©- thread2 ×”×¡×¤×™×§ ×œ×‘×¦×¢ 3 tasks, ×•×›×œ ×©××¨ ×”- threads ×¨×§ task ××—×“. ×–×” ×ª×œ×•×™ ×‘×ª×–××•×Ÿ ×©×œ threads ×•×‘××¨×•×›×‘×•×ª ×©×œ tasks ×× ×”× ×©×•× ×™×.

× ×™×ª×Ÿ ×’× ×œ×”×’×“×™×¨ explicit barriers ×œ tasks ×›×œ×•××¨, × ×™×ª×Ÿ ×œ×—×›×•×ª ×œ××¡×¤×¨ tasks ×©×™×¡×ª×™×™××• ×œ×¤× ×™ ×©××›× ×™×¡×™× tasks ×—×“×©×™×:

![Pasted image 20240309171244.png|300](/img/user/Assets/Pasted%20image%2020240309171244.png)


×× × ×¨×¦×” ×œ×××© ××ª ×–×” ×¢×œ ×”linked list ×©×œ× ×• × ×¨×¦×” ×œ×”×‘×™×Ÿ ××” ×”××’×‘×œ×•×ª ×©×œ× × ×™×ª×Ÿ ×œ×”×× ×¢ ××”× ×•××” ×× ×—× ×• ×™×›×•×œ×™× ×œ×¢×©×•×ª.

1) ×—×™×™×‘×™× ×œ×¨×•×¥ ×¢×œ ×›×œ ×”×¨×©×™××” ×‘××•×¤×Ÿ ××¡×•× ×›×¨×Ÿ ×›×œ×•××¨ thread 1 ××• ×¢× ×›×œ×™ ×¡× ×›×¨×•×Ÿ.
2) ×¦×¨×™×š ×œ×”×©×ª××© ×‘×œ×•×œ××ª while ×›×™ ×’×•×“×œ ×”×¨×©×™××” ×œ× ×™×“×•×¢.
3) ×›×œ process ×™×›×•×œ ×œ×”×™×•×ª ××§×‘×™×œ×™.

×× ×›×Ÿ ×”××•×“×œ ×™×™×¨××” ××”×¦×•×¨×”

![Pasted image 20240309171705.png|300](/img/user/Assets/Pasted%20image%2020240309171705.png)

×”×§×•×“ ×××•×“ ×¤×©×•×˜ ×•×™×¨××” ×›×š:
![Pasted image 20240309171223.png|300](/img/user/Assets/Pasted%20image%2020240309171223.png)

×‘××™×œ×™×- thread ××—×“ ××›× ×™×¡ ××ª ×”tasks , ×›×œ task ×”×•× ×”×¤×¢×•×œ×” process ×¢×œ ××™×‘×¨ ×›×œ×©×”×• ×‘×¨×©×™××”. ×©××¨ ×” threads ×©×•×œ×¤×™× ××ª ×”tasks ×•××‘×¦×¢×™× ××•×ª× ××§×‘×™×œ×™.

### Fibonacci
[[Computer Science/Algorithms/Fibonacci algorithm\|×¤×™×‘×•× ××¦×³×™ ×”×¤×¨×“ ×•××©×•×œ]] ×”×•× ××œ×’×•×¨×™×ª× ×©×¤×•×ª×¨ ××ª ×¤×™×‘×³ ×‘×–××Ÿ $O(\log n)$.
×× ×—× ×• ××›×™×¨×™× ×’× ××œ×’×•×¨×™×ª× ×¤×©×•×˜ ×™×•×ª×¨ ×©×¤×•×ª×¨ ×‘×¦×•×¨×” ×¨×™×§×•×¨×¡×™×‘×™×ª ×‘×–××Ÿ ×××•×“ ××™×˜×™

![Pasted image 20240309172333.png|300](/img/user/Assets/Pasted%20image%2020240309172333.png)

×× × ×¨×¦×” ×œ××§×‘×œ ××ª ×–×” × ×•×›×œ ×œ×—×©×•×‘ ×¢×œ ×œ×”×›× ×™×¡ ×›×œ ×§×¨×™××” ×¨×§×•×¨×¡×™×‘×™×ª ×œ task. 

![Pasted image 20240309172420.png|300](/img/user/Assets/Pasted%20image%2020240309172420.png)

×”×ª×•×›× ×™×ª ×”×–××ª ×××•×“ ×œ× ×™×¢×™×œ×” ×©×›×Ÿ ×× ×—× ×• ××©×§×™×¢×™× ×”××•×Ÿ ×–××Ÿ ×•××§×•× ×‘×™×¦×™×¨×ª $2^{n}$ tasks ×‘ queue. 

![Pasted image 20240309172525.png](/img/user/Assets/Pasted%20image%2020240309172525.png)

× ×•×›×œ ×œ×”×’×“×™×¨ ×§×•×“ ×©××‘×§×¨ ××ª ×›××•×ª ×”tasks ×•××•× ×¢ ××”task queue ×œ×”×›×™×œ ×›××•×ª ×’×“×•×œ×” ×™×•×ª×¨ ×©×œ ××©×™××•×ª × capacity ×©× ×’×“×™×¨ ××¨××©

![Pasted image 20240309172814.png|300](/img/user/Assets/Pasted%20image%2020240309172814.png)

![Pasted image 20240309172825.png](/img/user/Assets/Pasted%20image%2020240309172825.png)

×”×§×•×“ ×”×–×” ×‘×¢×¦× ××’×“×™×¨ ×©××—×¨×™ ×¢×•××§ ×¢×¥ ×¨×§×•×¨×¡×™×” ×©×œ 5 ×”×§×•×“ ×™×¢×‘×•×¨ ×œ×—×©×‘ ××ª ×©××¨ ×”×¢×•××§×™× ×‘×¦×•×¨×” ×¡×“×¨×ª×™×ª, ×›×œ ×¢×•××§ ×¢×¥ × ××•×š ××–×” ×™×¢×©×” ×‘×¦×•×¨×” ××§×‘×™×œ×™×ª.